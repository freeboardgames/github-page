(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[228],{1195:function(t,e,r){"use strict";var n=r(3203);e.Z=void 0;var s=n(r(9124)),i=r(4246),o=(0,s.default)((0,i.jsx)("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"}),"MoreVert");e.Z=o},1589:function(t,e,r){"use strict";var n=r(3203);e.Z=void 0;var s=n(r(9124)),i=r(4246),o=(0,s.default)((0,i.jsx)("path",{d:"M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"}),"Replay");e.Z=o},9329:function(t,e,r){"use strict";r.d(e,{K:function(){return In}});var n={};r.r(n),r.d(n,{Decoder:function(){return on},Encoder:function(){return sn},PacketType:function(){return nn},protocol:function(){return rn}});r(3261);var s=r(3979);let i=(t=21)=>{let e="",r=t;for(;r--;)e+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[64*Math.random()|0];return e};var o=r(4649);function a(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function c(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?a(Object(r),!0).forEach((function(e){(0,o.Z)(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function u(t){return"Minified Redux error #"+t+"; visit https://redux.js.org/Errors?code="+t+" for the full message or use the non-minified dev environment for full errors. "}var h="function"===typeof Symbol&&Symbol.observable||"@@observable",l=function(){return Math.random().toString(36).substring(7).split("").join(".")},p={INIT:"@@redux/INIT"+l(),REPLACE:"@@redux/REPLACE"+l(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+l()}};function f(t){if("object"!==typeof t||null===t)return!1;for(var e=t;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e}function d(t,e,r){var n;if("function"===typeof e&&"function"===typeof r||"function"===typeof r&&"function"===typeof arguments[3])throw new Error(u(0));if("function"===typeof e&&"undefined"===typeof r&&(r=e,e=void 0),"undefined"!==typeof r){if("function"!==typeof r)throw new Error(u(1));return r(d)(t,e)}if("function"!==typeof t)throw new Error(u(2));var s=t,i=e,o=[],a=o,c=!1;function l(){a===o&&(a=o.slice())}function y(){if(c)throw new Error(u(3));return i}function m(t){if("function"!==typeof t)throw new Error(u(4));if(c)throw new Error(u(5));var e=!0;return l(),a.push(t),function(){if(e){if(c)throw new Error(u(6));e=!1,l();var r=a.indexOf(t);a.splice(r,1),o=null}}}function g(t){if(!f(t))throw new Error(u(7));if("undefined"===typeof t.type)throw new Error(u(8));if(c)throw new Error(u(9));try{c=!0,i=s(i,t)}finally{c=!1}for(var e=o=a,r=0;r<e.length;r++){(0,e[r])()}return t}function v(t){if("function"!==typeof t)throw new Error(u(10));s=t,g({type:p.REPLACE})}function b(){var t,e=m;return(t={subscribe:function(t){if("object"!==typeof t||null===t)throw new Error(u(11));function r(){t.next&&t.next(y())}return r(),{unsubscribe:e(r)}}})[h]=function(){return this},t}return g({type:p.INIT}),(n={dispatch:g,subscribe:m,getState:y,replaceReducer:v})[h]=b,n}function y(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return 0===e.length?function(t){return t}:1===e.length?e[0]:e.reduce((function(t,e){return function(){return t(e.apply(void 0,arguments))}}))}function m(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return function(t){return function(){var r=t.apply(void 0,arguments),n=function(){throw new Error(u(15))},s={getState:r.getState,dispatch:function(){return n.apply(void 0,arguments)}},i=e.map((function(t){return t(s)}));return n=y.apply(void 0,i)(r.dispatch),c(c({},r),{},{dispatch:n})}}}function g(t){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];throw Error("[Immer] minified error nr: "+t+(r.length?" "+r.map((function(t){return"'"+t+"'"})).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function v(t){return!!t&&!!t[it]}function b(t){return!!t&&(function(t){if(!t||"object"!=typeof t)return!1;var e=Object.getPrototypeOf(t);if(null===e)return!0;var r=Object.hasOwnProperty.call(e,"constructor")&&e.constructor;return r===Object||"function"==typeof r&&Function.toString.call(r)===ot}(t)||Array.isArray(t)||!!t[st]||!!t.constructor[st]||S(t)||x(t))}function w(t,e,r){void 0===r&&(r=!1),0===E(t)?(r?Object.keys:at)(t).forEach((function(n){r&&"symbol"==typeof n||e(n,t[n],t)})):t.forEach((function(r,n){return e(n,r,t)}))}function E(t){var e=t[it];return e?e.i>3?e.i-4:e.i:Array.isArray(t)?1:S(t)?2:x(t)?3:0}function P(t,e){return 2===E(t)?t.has(e):Object.prototype.hasOwnProperty.call(t,e)}function _(t,e){return 2===E(t)?t.get(e):t[e]}function I(t,e,r){var n=E(t);2===n?t.set(e,r):3===n?(t.delete(e),t.add(r)):t[e]=r}function O(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}function S(t){return tt&&t instanceof Map}function x(t){return et&&t instanceof Set}function A(t){return t.o||t.t}function k(t){if(Array.isArray(t))return Array.prototype.slice.call(t);var e=ct(t);delete e[it];for(var r=at(e),n=0;n<r.length;n++){var s=r[n],i=e[s];!1===i.writable&&(i.writable=!0,i.configurable=!0),(i.get||i.set)&&(e[s]={configurable:!0,writable:!0,enumerable:i.enumerable,value:t[s]})}return Object.create(Object.getPrototypeOf(t),e)}function D(t,e){return void 0===e&&(e=!1),M(t)||v(t)||!b(t)||(E(t)>1&&(t.set=t.add=t.clear=t.delete=N),Object.freeze(t),e&&w(t,(function(t,e){return D(e,!0)}),!0)),t}function N(){g(2)}function M(t){return null==t||"object"!=typeof t||Object.isFrozen(t)}function C(t){var e=ut[t];return e||g(18,t),e}function T(){return X}function j(t,e){e&&(C("Patches"),t.u=[],t.s=[],t.v=e)}function B(t){R(t),t.p.forEach(U),t.p=null}function R(t){t===X&&(X=t.l)}function L(t){return X={p:[],l:X,h:t,m:!0,_:0}}function U(t){var e=t[it];0===e.i||1===e.i?e.j():e.O=!0}function G(t,e){e._=e.p.length;var r=e.p[0],n=void 0!==t&&t!==r;return e.h.g||C("ES5").S(e,t,n),n?(r[it].P&&(B(e),g(4)),b(t)&&(t=$(e,t),e.l||q(e,t)),e.u&&C("Patches").M(r[it].t,t,e.u,e.s)):t=$(e,r,[]),B(e),e.u&&e.v(e.u,e.s),t!==nt?t:void 0}function $(t,e,r){if(M(e))return e;var n=e[it];if(!n)return w(e,(function(s,i){return F(t,n,e,s,i,r)}),!0),e;if(n.A!==t)return e;if(!n.P)return q(t,n.t,!0),n.t;if(!n.I){n.I=!0,n.A._--;var s=4===n.i||5===n.i?n.o=k(n.k):n.o;w(3===n.i?new Set(s):s,(function(e,i){return F(t,n,s,e,i,r)})),q(t,s,!1),r&&t.u&&C("Patches").R(n,r,t.u,t.s)}return n.o}function F(t,e,r,n,s,i){if(v(s)){var o=$(t,s,i&&e&&3!==e.i&&!P(e.D,n)?i.concat(n):void 0);if(I(r,n,o),!v(o))return;t.m=!1}if(b(s)&&!M(s)){if(!t.h.F&&t._<1)return;$(t,s),e&&e.A.l||q(t,s)}}function q(t,e,r){void 0===r&&(r=!1),t.h.F&&t.m&&D(e,r)}function V(t,e){var r=t[it];return(r?A(r):t)[e]}function z(t,e){if(e in t)for(var r=Object.getPrototypeOf(t);r;){var n=Object.getOwnPropertyDescriptor(r,e);if(n)return n;r=Object.getPrototypeOf(r)}}function J(t){t.P||(t.P=!0,t.l&&J(t.l))}function K(t){t.o||(t.o=k(t.t))}function H(t,e,r){var n=S(e)?C("MapSet").N(e,r):x(e)?C("MapSet").T(e,r):t.g?function(t,e){var r=Array.isArray(t),n={i:r?1:0,A:e?e.A:T(),P:!1,I:!1,D:{},l:e,t:t,k:null,o:null,j:null,C:!1},s=n,i=ht;r&&(s=[n],i=lt);var o=Proxy.revocable(s,i),a=o.revoke,c=o.proxy;return n.k=c,n.j=a,c}(e,r):C("ES5").J(e,r);return(r?r.A:T()).p.push(n),n}function Y(t){return v(t)||g(22,t),function t(e){if(!b(e))return e;var r,n=e[it],s=E(e);if(n){if(!n.P&&(n.i<4||!C("ES5").K(n)))return n.t;n.I=!0,r=W(e,s),n.I=!1}else r=W(e,s);return w(r,(function(e,s){n&&_(n.t,e)===s||I(r,e,t(s))})),3===s?new Set(r):r}(t)}function W(t,e){switch(e){case 2:return new Map(t);case 3:return Array.from(t)}return k(t)}var Z,X,Q="undefined"!=typeof Symbol&&"symbol"==typeof Symbol("x"),tt="undefined"!=typeof Map,et="undefined"!=typeof Set,rt="undefined"!=typeof Proxy&&void 0!==Proxy.revocable&&"undefined"!=typeof Reflect,nt=Q?Symbol.for("immer-nothing"):((Z={})["immer-nothing"]=!0,Z),st=Q?Symbol.for("immer-draftable"):"__$immer_draftable",it=Q?Symbol.for("immer-state"):"__$immer_state",ot=("undefined"!=typeof Symbol&&Symbol.iterator,""+Object.prototype.constructor),at="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Object.getOwnPropertyNames,ct=Object.getOwnPropertyDescriptors||function(t){var e={};return at(t).forEach((function(r){e[r]=Object.getOwnPropertyDescriptor(t,r)})),e},ut={},ht={get:function(t,e){if(e===it)return t;var r=A(t);if(!P(r,e))return function(t,e,r){var n,s=z(e,r);return s?"value"in s?s.value:null===(n=s.get)||void 0===n?void 0:n.call(t.k):void 0}(t,r,e);var n=r[e];return t.I||!b(n)?n:n===V(t.t,e)?(K(t),t.o[e]=H(t.A.h,n,t)):n},has:function(t,e){return e in A(t)},ownKeys:function(t){return Reflect.ownKeys(A(t))},set:function(t,e,r){var n=z(A(t),e);if(null==n?void 0:n.set)return n.set.call(t.k,r),!0;if(!t.P){var s=V(A(t),e),i=null==s?void 0:s[it];if(i&&i.t===r)return t.o[e]=r,t.D[e]=!1,!0;if(O(r,s)&&(void 0!==r||P(t.t,e)))return!0;K(t),J(t)}return t.o[e]===r&&"number"!=typeof r&&(void 0!==r||e in t.o)||(t.o[e]=r,t.D[e]=!0,!0)},deleteProperty:function(t,e){return void 0!==V(t.t,e)||e in t.t?(t.D[e]=!1,K(t),J(t)):delete t.D[e],t.o&&delete t.o[e],!0},getOwnPropertyDescriptor:function(t,e){var r=A(t),n=Reflect.getOwnPropertyDescriptor(r,e);return n?{writable:!0,configurable:1!==t.i||"length"!==e,enumerable:n.enumerable,value:r[e]}:n},defineProperty:function(){g(11)},getPrototypeOf:function(t){return Object.getPrototypeOf(t.t)},setPrototypeOf:function(){g(12)}},lt={};w(ht,(function(t,e){lt[t]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}})),lt.deleteProperty=function(t,e){return lt.set.call(this,t,e,void 0)},lt.set=function(t,e,r){return ht.set.call(this,t[0],e,r,t[0])};var pt=function(){function t(t){var e=this;this.g=rt,this.F=!0,this.produce=function(t,r,n){if("function"==typeof t&&"function"!=typeof r){var s=r;r=t;var i=e;return function(t){var e=this;void 0===t&&(t=s);for(var n=arguments.length,o=Array(n>1?n-1:0),a=1;a<n;a++)o[a-1]=arguments[a];return i.produce(t,(function(t){var n;return(n=r).call.apply(n,[e,t].concat(o))}))}}var o;if("function"!=typeof r&&g(6),void 0!==n&&"function"!=typeof n&&g(7),b(t)){var a=L(e),c=H(e,t,void 0),u=!0;try{o=r(c),u=!1}finally{u?B(a):R(a)}return"undefined"!=typeof Promise&&o instanceof Promise?o.then((function(t){return j(a,n),G(t,a)}),(function(t){throw B(a),t})):(j(a,n),G(o,a))}if(!t||"object"!=typeof t){if(void 0===(o=r(t))&&(o=t),o===nt&&(o=void 0),e.F&&D(o,!0),n){var h=[],l=[];C("Patches").M(t,o,h,l),n(h,l)}return o}g(21,t)},this.produceWithPatches=function(t,r){if("function"==typeof t)return function(r){for(var n=arguments.length,s=Array(n>1?n-1:0),i=1;i<n;i++)s[i-1]=arguments[i];return e.produceWithPatches(r,(function(e){return t.apply(void 0,[e].concat(s))}))};var n,s,i=e.produce(t,r,(function(t,e){n=t,s=e}));return"undefined"!=typeof Promise&&i instanceof Promise?i.then((function(t){return[t,n,s]})):[i,n,s]},"boolean"==typeof(null==t?void 0:t.useProxies)&&this.setUseProxies(t.useProxies),"boolean"==typeof(null==t?void 0:t.autoFreeze)&&this.setAutoFreeze(t.autoFreeze)}var e=t.prototype;return e.createDraft=function(t){b(t)||g(8),v(t)&&(t=Y(t));var e=L(this),r=H(this,t,void 0);return r[it].C=!0,R(e),r},e.finishDraft=function(t,e){var r=(t&&t[it]).A;return j(r,e),G(void 0,r)},e.setAutoFreeze=function(t){this.F=t},e.setUseProxies=function(t){t&&!rt&&g(20),this.g=t},e.applyPatches=function(t,e){var r;for(r=e.length-1;r>=0;r--){var n=e[r];if(0===n.path.length&&"replace"===n.op){t=n.value;break}}r>-1&&(e=e.slice(r+1));var s=C("Patches").$;return v(t)?s(t,e):this.produce(t,(function(t){return s(t,e)}))},t}(),ft=new pt,dt=ft.produce,yt=(ft.produceWithPatches.bind(ft),ft.setAutoFreeze.bind(ft),ft.setUseProxies.bind(ft),ft.applyPatches.bind(ft),ft.createDraft.bind(ft),ft.finishDraft.bind(ft),dt);class mt{constructor(t){const e=function(){let t=4022871197;const e=function(e){const r=e.toString();for(let n=0;n<r.length;n++){t+=r.charCodeAt(n);let e=.02519603282416938*t;t=e>>>0,e-=t,e*=t,t=e>>>0,e-=t,t+=4294967296*e}return 2.3283064365386963e-10*(t>>>0)};return e}();this.c=1,this.s0=e(" "),this.s1=e(" "),this.s2=e(" "),this.s0-=e(t),this.s0<0&&(this.s0+=1),this.s1-=e(t),this.s1<0&&(this.s1+=1),this.s2-=e(t),this.s2<0&&(this.s2+=1)}next(){const t=2091639*this.s0+2.3283064365386963e-10*this.c;return this.s0=this.s1,this.s1=this.s2,this.s2=t-(this.c=Math.trunc(t))}}function gt(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function vt(t,e){const r=new mt(t),n=r.next.bind(r);return e&&gt(e,r),n.state=()=>gt(r,{}),n}class bt{constructor(t){this.state=t||{seed:"0"},this.used=!1}static seed(){return Date.now().toString(36).slice(-10)}isUsed(){return this.used}getState(){return this.state}_random(){this.used=!0;const t=this.state,e=vt(t.prngstate?"":t.seed,t.prngstate),r=e();return this.state={...t,prngstate:e.state()},r}api(){const t=this._random.bind(this),e={D4:4,D6:6,D8:8,D10:10,D12:12,D20:20},r={};for(const n in e){const s=e[n];r[n]=e=>void 0===e?Math.floor(t()*s)+1:Array.from({length:e}).map((()=>Math.floor(t()*s)+1))}return{...r,Die:function(e=6,r){return void 0===r?Math.floor(t()*e)+1:Array.from({length:r}).map((()=>Math.floor(t()*e)+1))},Number:()=>t(),Shuffle:e=>{const r=[...e];let n=e.length,s=0;const i=Array.from({length:n});for(;n;){const e=Math.trunc(n*t());i[s++]=r[e],r[e]=r[--n]}return i},_private:this}}}const wt={name:"random",noClient:({api:t})=>t._private.isUsed(),flush:({api:t})=>t._private.getState(),api:({data:t})=>new bt(t).api(),setup:({game:t})=>{let{seed:e}=t;return void 0===e&&(e=bt.seed()),{seed:e}},playerView:()=>{}},Et="MAKE_MOVE",Pt="GAME_EVENT",_t="REDO",It="RESET",Ot="SYNC",St="UNDO",xt="UPDATE",At="PATCH",kt="PLUGIN",Dt="STRIP_TRANSIENTS",Nt=(t,e,r,n)=>({type:Et,payload:{type:t,args:e,playerID:r,credentials:n}}),Mt=(t,e,r,n)=>({type:Pt,payload:{type:t,args:e,playerID:r,credentials:n}}),Ct=(t,e,r,n)=>({type:Pt,payload:{type:t,args:e,playerID:r,credentials:n},automatic:!0}),Tt=t=>({type:Ot,state:t.state,log:t.log,initialState:t.initialState,clientOnly:!0}),jt=(t,e,r,n)=>({type:At,prevStateID:t,stateID:e,patch:r,deltalog:n,clientOnly:!0}),Bt=(t,e)=>({type:xt,state:t,deltalog:e,clientOnly:!0}),Rt=t=>({type:It,state:t,clientOnly:!0}),Lt=(t,e)=>({type:St,payload:{type:null,args:null,playerID:t,credentials:e}}),Ut=(t,e)=>({type:_t,payload:{type:null,args:null,playerID:t,credentials:e}}),Gt=()=>({type:Dt});var $t=Object.freeze({__proto__:null,makeMove:Nt,gameEvent:Mt,automaticGameEvent:Ct,sync:Tt,patch:jt,update:Bt,reset:Rt,undo:Lt,redo:Ut,plugin:(t,e,r,n)=>({type:kt,payload:{type:t,args:e,playerID:r,credentials:n}}),stripTransients:Gt});const Ft="INVALID_MOVE",qt={name:"plugin-immer",fnWrap:t=>(e,r,...n)=>{let s=!1;const i=yt(e,(e=>{const i=t(e,r,...n);if(i!==Ft)return i;s=!0}));return s?Ft:i}};var Vt,zt;!function(t){t.MOVE="MOVE",t.GAME_ON_END="GAME_ON_END",t.PHASE_ON_BEGIN="PHASE_ON_BEGIN",t.PHASE_ON_END="PHASE_ON_END",t.TURN_ON_BEGIN="TURN_ON_BEGIN",t.TURN_ON_MOVE="TURN_ON_MOVE",t.TURN_ON_END="TURN_ON_END"}(Vt||(Vt={})),function(t){t.CalledOutsideHook="Events must be called from moves or the `onBegin`, `onEnd`, and `onMove` hooks.\nThis error probably means you called an event from other game code, like an `endIf` trigger or one of the `turn.order` methods.",t.EndTurnInOnEnd="`endTurn` is disallowed in `onEnd` hooks \u2014 the turn is already ending.",t.MaxTurnEndings="Maximum number of turn endings exceeded for this update.\nThis likely means game code is triggering an infinite loop.",t.PhaseEventInOnEnd="`setPhase` & `endPhase` are disallowed in a phase\u2019s `onEnd` hook \u2014 the phase is already ending.\nIf you\u2019re trying to dynamically choose the next phase when a phase ends, use the phase\u2019s `next` trigger.",t.StageEventInOnEnd="`setStage`, `endStage` & `setActivePlayers` are disallowed in `onEnd` hooks.",t.StageEventInPhaseBegin="`setStage`, `endStage` & `setActivePlayers` are disallowed in a phase\u2019s `onBegin` hook.\nUse `setActivePlayers` in a `turn.onBegin` hook or declare stages with `turn.activePlayers` instead.",t.StageEventInTurnBegin="`setStage` & `endStage` are disallowed in `turn.onBegin`.\nUse `setActivePlayers` or declare stages with `turn.activePlayers` instead."}(zt||(zt={}));class Jt{constructor(t,e,r){this.flow=t,this.playerID=r,this.dispatch=[],this.initialTurn=e.turn,this.updateTurnContext(e,void 0),this.maxEndedTurnsPerAction=100*e.numPlayers}api(){const t={_private:this};for(const e of this.flow.eventNames)t[e]=(...t)=>{this.dispatch.push({type:e,args:t,phase:this.currentPhase,turn:this.currentTurn,calledFrom:this.currentMethod,error:new Error("Events Plugin Error")})};return t}isUsed(){return this.dispatch.length>0}updateTurnContext(t,e){this.currentPhase=t.phase,this.currentTurn=t.turn,this.currentMethod=e}unsetCurrentMethod(){this.currentMethod=void 0}update(t){const e=t,r=({stack:t},r)=>({...e,plugins:{...e.plugins,events:{...e.plugins.events,data:{error:r+"\n"+t}}}});t:for(let n=0;n<this.dispatch.length;n++){const e=this.dispatch[n],s=e.turn!==t.ctx.turn;if(this.currentTurn-this.initialTurn>=this.maxEndedTurnsPerAction)return r(e.error,zt.MaxTurnEndings);if(void 0===e.calledFrom)return r(e.error,zt.CalledOutsideHook);if(t.ctx.gameover)break t;switch(e.type){case"endStage":case"setStage":case"setActivePlayers":switch(e.calledFrom){case Vt.TURN_ON_END:case Vt.PHASE_ON_END:return r(e.error,zt.StageEventInOnEnd);case Vt.PHASE_ON_BEGIN:return r(e.error,zt.StageEventInPhaseBegin);case Vt.TURN_ON_BEGIN:if("setActivePlayers"===e.type)break;return r(e.error,zt.StageEventInTurnBegin)}if(s)continue t;break;case"endTurn":if(e.calledFrom===Vt.TURN_ON_END||e.calledFrom===Vt.PHASE_ON_END)return r(e.error,zt.EndTurnInOnEnd);if(s)continue t;break;case"endPhase":case"setPhase":if(e.calledFrom===Vt.PHASE_ON_END)return r(e.error,zt.PhaseEventInOnEnd);if(e.phase!==t.ctx.phase)continue t}const i=Ct(e.type,e.args,this.playerID);t=this.flow.processEvent(t,i)}return t}}const Kt={name:"events",noClient:({api:t})=>t._private.isUsed(),isInvalid:({data:t})=>t.error||!1,fnWrap:(t,e)=>(r,n,...s)=>{const i=n.events;return i&&i._private.updateTurnContext(n,e),r=t(r,n,...s),i&&i._private.unsetCurrentMethod(),r},dangerouslyFlushRawState:({state:t,api:e})=>e._private.update(t),api:({game:t,ctx:e,playerID:r})=>new Jt(t.flow,e,r).api()};const Ht=()=>{};function Yt(t){Ht(`INFO: ${t}`)}function Wt(t){((...t)=>{console.error(...t)})("ERROR:",t)}const Zt=[qt,wt,{name:"log",flush:()=>({}),api:({data:t})=>({setMetadata:e=>{t.metadata=e}}),setup:()=>({})},{name:"plugin-serializable",fnWrap:t=>(e,r,...n)=>t(e,r,...n)}],Xt=[...Zt,Kt],Qt=t=>{const e={...t.ctx},r=t.plugins||{};return Object.entries(r).forEach((([t,{api:r}])=>{e[t]=r})),e},te=(t,e,r)=>[...Zt,...r,Kt].filter((t=>void 0!==t.fnWrap)).reduce(((t,{fnWrap:r})=>r(t,e)),t),ee=(t,e)=>([...Xt,...e.game.plugins].filter((t=>void 0!==t.api)).forEach((r=>{const n=r.name,s=t.plugins[n]||{data:{}},i=r.api({G:t.G,ctx:t.ctx,data:s.data,game:e.game,playerID:e.playerID});t={...t,plugins:{...t.plugins,[n]:{...s,api:i}}}})),t),re=(t,e)=>{const r=((t,e)=>([...Zt,...e.game.plugins,Kt].reverse().forEach((r=>{const n=r.name,s=t.plugins[n]||{data:{}};if(r.flush){const n=r.flush({G:t.G,ctx:t.ctx,game:e.game,api:s.api,data:s.data});t={...t,plugins:{...t.plugins,[r.name]:{data:n}}}}else if(r.dangerouslyFlushRawState){const i=(t=r.dangerouslyFlushRawState({state:t,game:e.game,api:s.api,data:s.data})).plugins[n].data;t={...t,plugins:{...t.plugins,[r.name]:{data:i}}}}})),t))(t,e),n=((t,e)=>{const r=[...Xt,...e.game.plugins].filter((t=>void 0!==t.isInvalid)).map((r=>{const{name:n}=r,s=t.plugins[n],i=r.isInvalid({G:t.G,ctx:t.ctx,game:e.game,data:s&&s.data});return!!i&&{plugin:n,message:i}})).find((t=>t));return r||!1})(r,e);if(!n)return[r];const{plugin:s,message:i}=n;return Wt(`${s} plugin declared action invalid:\n${i}`),[t,n]},ne=({G:t,ctx:e,plugins:r={}},{game:n,playerID:s})=>([...Xt,...n.plugins].forEach((({name:i,playerView:o})=>{if(!o)return;const{data:a}=r[i]||{data:{}},c=o({G:t,ctx:e,game:n,data:a,playerID:s});r={...r,[i]:{data:c}}})),r);function se(t,e=!1){t.moveLimit&&(e&&(t.minMoves=t.moveLimit),t.maxMoves=t.moveLimit,delete t.moveLimit)}function ie(t,e){let r={},n=[],s=null,i={},o={};if(Array.isArray(e)){const t={};e.forEach((e=>t[e]=ue.NULL)),r=t}else{if(se(e),e.next&&(s=e.next),e.revert&&(n=[...t._prevActivePlayers,{activePlayers:t.activePlayers,_activePlayersMinMoves:t._activePlayersMinMoves,_activePlayersMaxMoves:t._activePlayersMaxMoves,_activePlayersNumMoves:t._activePlayersNumMoves}]),void 0!==e.currentPlayer&&oe(r,i,o,t.currentPlayer,e.currentPlayer),void 0!==e.others)for(let n=0;n<t.playOrder.length;n++){const s=t.playOrder[n];s!==t.currentPlayer&&oe(r,i,o,s,e.others)}if(void 0!==e.all)for(let n=0;n<t.playOrder.length;n++){oe(r,i,o,t.playOrder[n],e.all)}if(e.value)for(const t in e.value)oe(r,i,o,t,e.value[t]);if(e.minMoves)for(const t in r)void 0===i[t]&&(i[t]=e.minMoves);if(e.maxMoves)for(const t in r)void 0===o[t]&&(o[t]=e.maxMoves)}0===Object.keys(r).length&&(r=null),0===Object.keys(i).length&&(i=null),0===Object.keys(o).length&&(o=null);const a={};for(const c in r)a[c]=0;return{...t,activePlayers:r,_activePlayersMinMoves:i,_activePlayersMaxMoves:o,_activePlayersNumMoves:a,_prevActivePlayers:n,_nextActivePlayers:s}}function oe(t,e,r,n,s){"object"===typeof s&&s!==ue.NULL||(s={stage:s}),void 0!==s.stage&&(se(s),t[n]=s.stage,s.minMoves&&(e[n]=s.minMoves),s.maxMoves&&(r[n]=s.maxMoves))}function ae(t,e){return t[e]+""}const ce={first:(t,e)=>0===e.turn?e.playOrderPos:(e.playOrderPos+1)%e.playOrder.length,next:(t,e)=>(e.playOrderPos+1)%e.playOrder.length},ue={NULL:null};ue.NULL,ue.NULL,ue.NULL,ue.NULL;function he({moves:t,phases:e,endIf:r,onEnd:n,turn:s,events:i,plugins:o}){void 0===t&&(t={}),void 0===i&&(i={}),void 0===o&&(o=[]),void 0===e&&(e={}),r||(r=()=>{}),n||(n=t=>t),s||(s={});const a={...e};""in a&&Wt("cannot specify phase with empty name"),a[""]={};const c={},u=new Set;let h=null;Object.keys(t).forEach((t=>u.add(t)));const l=(t,e)=>{const r=te(t,e,o);return t=>{const e=Qt(t);return r(t.G,e)}},p=t=>e=>{const r=Qt(e);return t(e.G,r)},f={onEnd:l(n,Vt.GAME_ON_END),endIf:p(r)};for(const T in a){const t=a[T];if(!0===t.start&&(h=T),void 0!==t.moves)for(const e of Object.keys(t.moves))c[T+"."+e]=t.moves[e],u.add(e);void 0===t.endIf&&(t.endIf=()=>{}),void 0===t.onBegin&&(t.onBegin=t=>t),void 0===t.onEnd&&(t.onEnd=t=>t),void 0===t.turn&&(t.turn=s),void 0===t.turn.order&&(t.turn.order=ce),void 0===t.turn.onBegin&&(t.turn.onBegin=t=>t),void 0===t.turn.onEnd&&(t.turn.onEnd=t=>t),void 0===t.turn.endIf&&(t.turn.endIf=()=>!1),void 0===t.turn.onMove&&(t.turn.onMove=t=>t),void 0===t.turn.stages&&(t.turn.stages={}),se(t.turn,!0);for(const e in t.turn.stages){const r=t.turn.stages[e].moves||{};for(const t of Object.keys(r)){c[T+"."+e+"."+t]=r[t],u.add(t)}}if(t.wrapped={onBegin:l(t.onBegin,Vt.PHASE_ON_BEGIN),onEnd:l(t.onEnd,Vt.PHASE_ON_END),endIf:p(t.endIf)},t.turn.wrapped={onMove:l(t.turn.onMove,Vt.TURN_ON_MOVE),onBegin:l(t.turn.onBegin,Vt.TURN_ON_BEGIN),onEnd:l(t.turn.onEnd,Vt.TURN_ON_END),endIf:p(t.turn.endIf)},"function"!==typeof t.next){const{next:e}=t;t.next=()=>e||null}t.wrapped.next=p(t.next)}function d(t){return t.phase?a[t.phase]:a[""]}function y(t){return t}function m(t,e){const r=new Set,n=new Set;for(let s=0;s<e.length;s++){const{fn:i,arg:o,...a}=e[s];if(i===A){n.clear();const e=t.ctx.phase;if(r.has(e)){const e={...t.ctx,phase:null};return{...t,ctx:e}}r.add(e)}const c=[];if(t=i(t,{...a,arg:o,next:c}),i===x)break;const u=I(t);if(u){e.push({fn:x,arg:u,turn:t.ctx.turn,phase:t.ctx.phase,automatic:!0});continue}const h=O(t);if(h)e.push({fn:A,arg:h,turn:t.ctx.turn,phase:t.ctx.phase,automatic:!0});else{if([y,P,_].includes(i)){const r=S(t);if(r){e.push({fn:k,arg:r,turn:t.ctx.turn,phase:t.ctx.phase,automatic:!0});continue}}e.push(...c)}}return t}function g(t,{next:e}){return e.push({fn:v}),t}function v(t,{next:e}){let{G:r,ctx:n}=t;return r=d(n).wrapped.onBegin(t),e.push({fn:b}),{...t,G:r,ctx:n}}function b(t,{currentPlayer:e}){let{ctx:r}=t;const n=d(r);e?(r={...r,currentPlayer:e},n.turn.activePlayers&&(r=ie(r,n.turn.activePlayers))):r=function(t,e){let{G:r,ctx:n}=t;const{numPlayers:s}=n,i=Qt(t),o=e.order;let a=[...Array.from({length:s})].map(((t,e)=>e+""));void 0!==o.playOrder&&(a=o.playOrder(r,i));const c=o.first(r,i),u=typeof c;"number"!==u&&Wt(`invalid value returned by turn.order.first \u2014 expected number got ${u} \u201c${c}\u201d.`);const h=ae(a,c);return n={...n,currentPlayer:h,playOrderPos:c,playOrder:a},n=ie(n,e.activePlayers||{}),n}(t,n.turn);const s=r.turn+1;r={...r,turn:s,numMoves:0,_prevActivePlayers:[]};const i=n.turn.wrapped.onBegin({...t,ctx:r});return{...t,G:i,ctx:r,_undo:[],_redo:[]}}function w(t,{arg:e,next:r,phase:n}){const s=d({phase:n});let{ctx:i}=t;if(e&&e.next){if(!(e.next in a))return Wt("invalid phase: "+e.next),t;i={...i,phase:e.next}}else i={...i,phase:s.wrapped.next(t)||null};return t={...t,ctx:i},r.push({fn:v}),t}function E(t,{arg:e,currentPlayer:r,next:n}){let{G:s,ctx:i}=t;const o=d(i),{endPhase:a,ctx:c}=function(t,e,r,n){const s=r.order;let{G:i,ctx:o}=t,a=o.playOrderPos,c=!1;if(n&&!0!==n)"object"!==typeof n&&Wt(`invalid argument to endTurn: ${n}`),Object.keys(n).forEach((t=>{switch(t){case"remove":e=ae(o.playOrder,a);break;case"next":a=o.playOrder.indexOf(n.next),e=n.next;break;default:Wt(`invalid argument to endTurn: ${t}`)}}));else{const r=Qt(t),n=s.next(i,r),u=typeof n;void 0!==n&&"number"!==u&&Wt(`invalid value returned by turn.order.next \u2014 expected number or undefined got ${u} \u201c${n}\u201d.`),void 0===n?c=!0:(a=n,e=ae(o.playOrder,a))}return o={...o,playOrderPos:a,currentPlayer:e},{endPhase:c,ctx:o}}(t,r,o.turn,e);return i=c,t={...t,G:s,ctx:i},a?n.push({fn:A,turn:i.turn,phase:i.phase}):n.push({fn:b,currentPlayer:i.currentPlayer}),t}function P(t,{arg:e,playerID:r}){if("string"!==typeof e&&e!==ue.NULL||(e={stage:e}),"object"!==typeof e)return t;se(e);let{ctx:n}=t,{activePlayers:s,_activePlayersMinMoves:i,_activePlayersMaxMoves:o,_activePlayersNumMoves:a}=n;return void 0!==e.stage&&(null===s&&(s={}),s[r]=e.stage,a[r]=0,e.minMoves&&(null===i&&(i={}),i[r]=e.minMoves),e.maxMoves&&(null===o&&(o={}),o[r]=e.maxMoves)),n={...n,activePlayers:s,_activePlayersMinMoves:i,_activePlayersMaxMoves:o,_activePlayersNumMoves:a},{...t,ctx:n}}function _(t,{arg:e}){return{...t,ctx:ie(t.ctx,e)}}function I(t){return f.endIf(t)}function O(t){return d(t.ctx).wrapped.endIf(t)}function S(t){const e=d(t.ctx),r=t.ctx.numMoves||0;return!!(e.turn.maxMoves&&r>=e.turn.maxMoves)||e.turn.wrapped.endIf(t)}function x(t,{arg:e,phase:r}){t=A(t,{phase:r}),void 0===e&&(e=!0),t={...t,ctx:{...t.ctx,gameover:e}};const n=f.onEnd(t);return{...t,G:n}}function A(t,{arg:e,next:r,turn:n,automatic:s}){t=k(t,{turn:n,force:!0,automatic:!0});const{phase:i,turn:o}=t.ctx;if(r&&r.push({fn:w,arg:e,phase:i}),null===i)return t;const a=d(t.ctx).wrapped.onEnd(t),c={...t.ctx,phase:null},u=Mt("endPhase",e),{_stateID:h}=t,l={action:u,_stateID:h,turn:o,phase:i};s&&(l.automatic=!0);const p=[...t.deltalog||[],l];return{...t,G:a,ctx:c,deltalog:p}}function k(t,{arg:e,next:r,turn:n,force:s,automatic:i,playerID:o}){if(n!==t.ctx.turn)return t;const{currentPlayer:a,numMoves:c,phase:u,turn:h}=t.ctx,l=d(t.ctx),p=c||0;if(!s&&l.turn.minMoves&&p<l.turn.minMoves)return Yt(`cannot end turn before making ${l.turn.minMoves} moves`),t;const f=l.turn.wrapped.onEnd(t);r&&r.push({fn:E,arg:e,currentPlayer:a});let y={...t.ctx,activePlayers:null};if(e&&e.remove){o=o||a;const e=y.playOrder.filter((t=>t!=o)),n=y.playOrderPos>e.length-1?0:y.playOrderPos;if(y={...y,playOrder:e,playOrderPos:n},0===e.length)return r.push({fn:A,turn:h,phase:u}),t}const m=Mt("endTurn",e),{_stateID:g}=t,v={action:m,_stateID:g,turn:h,phase:u};i&&(v.automatic=!0);const b=[...t.deltalog||[],v];return{...t,G:f,ctx:y,deltalog:b,_undo:[],_redo:[]}}function D(t,{arg:e,next:r,automatic:n,playerID:s}){s=s||t.ctx.currentPlayer;let{ctx:i,_stateID:o}=t,{activePlayers:a,_activePlayersNumMoves:c,_activePlayersMinMoves:u,_activePlayersMaxMoves:h,phase:l,turn:p}=i;const f=null!==a&&s in a,y=d(i);if(!e&&f){const t=y.turn.stages[a[s]];t&&t.next&&(e=t.next)}if(r&&r.push({fn:P,arg:e,playerID:s}),!f)return t;const m=c[s]||0;if(u&&u[s]&&m<u[s])return Yt(`cannot end stage before making ${u[s]} moves`),t;a={...a},delete a[s],u&&(u={...u},delete u[s]),h&&(h={...h},delete h[s]),i=function(t){let{activePlayers:e,_activePlayersMinMoves:r,_activePlayersMaxMoves:n,_activePlayersNumMoves:s,_prevActivePlayers:i,_nextActivePlayers:o}=t;if(e&&0===Object.keys(e).length)if(o)t=ie(t,o),({activePlayers:e,_activePlayersMinMoves:r,_activePlayersMaxMoves:n,_activePlayersNumMoves:s,_prevActivePlayers:i}=t);else if(i.length>0){const t=i.length-1;({activePlayers:e,_activePlayersMinMoves:r,_activePlayersMaxMoves:n,_activePlayersNumMoves:s}=i[t]),i=i.slice(0,t)}else e=null,r=null,n=null;return{...t,activePlayers:e,_activePlayersMinMoves:r,_activePlayersMaxMoves:n,_activePlayersNumMoves:s,_prevActivePlayers:i}}({...i,activePlayers:a,_activePlayersMinMoves:u,_activePlayersMaxMoves:h});const g={action:Mt("endStage",e),_stateID:o,turn:p,phase:l};n&&(g.automatic=!0);const v=[...t.deltalog||[],g];return{...t,ctx:i,deltalog:v}}function N(e,r,n){const s=d(e),i=s.turn.stages,{activePlayers:o}=e;if(o&&void 0!==o[n]&&o[n]!==ue.NULL&&void 0!==i[o[n]]&&void 0!==i[o[n]].moves){const t=i[o[n]].moves;if(r in t)return t[r]}else if(s.moves){if(r in s.moves)return s.moves[r]}else if(r in t)return t[r];return null}const M={endStage:function(t,e){return m(t,[{fn:D,playerID:e}])},setStage:function(t,e,r){return m(t,[{fn:D,arg:r,playerID:e}])},endTurn:function(t,e,r){return m(t,[{fn:k,turn:t.ctx.turn,phase:t.ctx.phase,arg:r}])},pass:function(t,e,r){return m(t,[{fn:k,turn:t.ctx.turn,phase:t.ctx.phase,force:!0,arg:r}])},endPhase:function(t){return m(t,[{fn:A,phase:t.ctx.phase,turn:t.ctx.turn}])},setPhase:function(t,e,r){return m(t,[{fn:A,phase:t.ctx.phase,turn:t.ctx.turn,arg:{next:r}}])},endGame:function(t,e,r){return m(t,[{fn:x,turn:t.ctx.turn,phase:t.ctx.phase,arg:r}])},setActivePlayers:function(t,e,r){return m(t,[{fn:_,arg:r}])}},C=[];return!1!==i.endTurn&&C.push("endTurn"),!1!==i.pass&&C.push("pass"),!1!==i.endPhase&&C.push("endPhase"),!1!==i.setPhase&&C.push("setPhase"),!1!==i.endGame&&C.push("endGame"),!1!==i.setActivePlayers&&C.push("setActivePlayers"),!1!==i.endStage&&C.push("endStage"),!1!==i.setStage&&C.push("setStage"),{ctx:t=>({numPlayers:t,turn:0,currentPlayer:"0",playOrder:[...Array.from({length:t})].map(((t,e)=>e+"")),playOrderPos:0,phase:h,activePlayers:null}),init:t=>m(t,[{fn:g}]),isPlayerActive:function(t,e,r){return e.activePlayers?r in e.activePlayers:e.currentPlayer===r},eventHandlers:M,eventNames:Object.keys(M),enabledEventNames:C,moveMap:c,moveNames:[...u.values()],processMove:function(t,e){const{playerID:r,type:n}=e,{currentPlayer:s,activePlayers:i,_activePlayersMaxMoves:o}=t.ctx,a=N(t.ctx,n,r),c=!a||"function"===typeof a||!0!==a.noLimit;let{numMoves:u,_activePlayersNumMoves:h}=t.ctx;c&&(r===s&&u++,i&&h[r]++),t={...t,ctx:{...t.ctx,numMoves:u,_activePlayersNumMoves:h}},o&&h[r]>=o[r]&&(t=D(t,{playerID:r,automatic:!0}));const l=d(t.ctx).turn.wrapped.onMove({...t,ctx:{...t.ctx,playerID:r}});return m(t={...t,G:l},[{fn:y}])},processEvent:function(t,e){const{type:r,playerID:n,args:s}=e.payload;return"function"!==typeof M[r]?t:M[r](t,n,...Array.isArray(s)?s:[s])},getMove:N}}function le(t){if(function(t){return void 0!==t.processMove}(t))return t;if(void 0===t.name&&(t.name="default"),void 0===t.deltaState&&(t.deltaState=!1),void 0===t.disableUndo&&(t.disableUndo=!1),void 0===t.setup&&(t.setup=()=>({})),void 0===t.moves&&(t.moves={}),void 0===t.playerView&&(t.playerView=t=>t),void 0===t.plugins&&(t.plugins=[]),t.plugins.forEach((t=>{if(void 0===t.name)throw new Error("Plugin missing name attribute");if(t.name.includes(" "))throw new Error(t.name+": Plugin name must not include spaces")})),t.name.includes(" "))throw new Error(t.name+": Game name must not include spaces");const e=he(t);return{...t,flow:e,moveNames:e.moveNames,pluginNames:t.plugins.map((t=>t.name)),processMove:(r,n)=>{let s=e.getMove(r.ctx,n.type,n.playerID);if(pe(s)&&(s=s.move),s instanceof Function){const e=te(s,Vt.MOVE,t.plugins),i={...Qt(r),playerID:n.playerID};let o=[];return void 0!==n.args&&(o=Array.isArray(n.args)?n.args:[n.args]),e(r.G,i,...o)}return Wt(`invalid move object: ${n.type}`),r.G}}}function pe(t){return t instanceof Object&&void 0!==t.move}var fe,de;!function(t){t.UnauthorizedAction="update/unauthorized_action",t.MatchNotFound="update/match_not_found",t.PatchFailed="update/patch_failed"}(fe||(fe={})),function(t){t.StaleStateId="action/stale_state_id",t.UnavailableMove="action/unavailable_move",t.InvalidMove="action/invalid_move",t.InactivePlayer="action/inactive_player",t.GameOver="action/gameover",t.ActionDisabled="action/action_disabled",t.ActionInvalid="action/action_invalid",t.PluginActionInvalid="action/plugin_invalid"}(de||(de={}));const ye=t=>null!==t.payload.playerID&&void 0!==t.payload.playerID;function me(t,e){if(e.game.disableUndo)return t;const r={G:t.G,ctx:t.ctx,plugins:t.plugins,playerID:e.action.payload.playerID||t.ctx.currentPlayer};return"MAKE_MOVE"===e.action.type&&(r.moveType=e.action.payload.type),{...t,_undo:[...t._undo,r],_redo:[]}}function ge(t,e,r){const n={action:e,_stateID:t._stateID,turn:t.ctx.turn,phase:t.ctx.phase},s=t.plugins.log.data.metadata;return void 0!==s&&(n.metadata=s),"object"===typeof r&&!0===r.redact&&(n.redact=!0),{...t,deltalog:[n]}}function ve(t,e,r){const[n,s]=re(t,r);return s?[n,we(e,de.PluginActionInvalid,s)]:[n]}function be(t){if(!t)return[null,void 0];const{transients:e,...r}=t;return[r,e]}function we(t,e,r){return{...t,transients:{error:{type:e,payload:r}}}}const Ee=t=>e=>r=>{const n=e(r);if(r.type===Dt)return n;{const[,e]=be(t.getState());return"undefined"!==typeof e?(t.dispatch(Gt()),{...n,transients:e}):n}};function Pe({game:t,isClient:e}){return t=le(t),(r=null,n)=>{let[i]=be(r);switch(n.type){case Dt:return i;case Pt:{if(i={...i,deltalog:[]},e)return i;if(void 0!==i.ctx.gameover)return Wt("cannot call event after game end"),we(i,de.GameOver);if(ye(n)&&!t.flow.isPlayerActive(i.G,i.ctx,n.payload.playerID))return Wt(`disallowed event: ${n.payload.type}`),we(i,de.InactivePlayer);i=ee(i,{game:t,isClient:!1,playerID:n.payload.playerID});let r,s=t.flow.processEvent(i,n);return[s,r]=ve(s,i,{game:t,isClient:!1}),r?r:(s=me(s,{game:t,action:n}),{...s,_stateID:i._stateID+1})}case Et:{const r=i={...i,deltalog:[]},s=t.flow.getMove(i.ctx,n.payload.type,n.payload.playerID||i.ctx.currentPlayer);if(null===s)return Wt(`disallowed move: ${n.payload.type}`),we(i,de.UnavailableMove);if(e&&!1===s.client)return i;if(void 0!==i.ctx.gameover)return Wt("cannot make move after game end"),we(i,de.GameOver);if(ye(n)&&!t.flow.isPlayerActive(i.G,i.ctx,n.payload.playerID))return Wt(`disallowed move: ${n.payload.type}`),we(i,de.InactivePlayer);i=ee(i,{game:t,isClient:e,playerID:n.payload.playerID});const o=t.processMove(i,n.payload);if(o===Ft)return Wt(`invalid move: ${n.payload.type} args: ${n.payload.args}`),we(i,de.InvalidMove);const a={...i,G:o};if(e&&((t,e)=>[...Xt,...e.game.plugins].filter((t=>void 0!==t.noClient)).map((r=>{const n=r.name,s=t.plugins[n];return!!s&&r.noClient({G:t.G,ctx:t.ctx,game:e.game,api:s.api,data:s.data})})).includes(!0))(a,{game:t}))return i;if(i=a,e){let e;return[i,e]=ve(i,r,{game:t,isClient:!0}),e||{...i,_stateID:i._stateID+1}}let c;return i=ge(i,n,s),i=t.flow.processMove(i,n.payload),[i,c]=ve(i,r,{game:t}),c?c:(i=me(i,{game:t,action:n}),{...i,_stateID:i._stateID+1})}case It:case xt:case Ot:return n.state;case St:{if(i={...i,deltalog:[]},t.disableUndo)return Wt("Undo is not enabled"),we(i,de.ActionDisabled);const{G:e,ctx:r,_undo:s,_redo:o,_stateID:a}=i;if(s.length<2)return Wt("No moves to undo"),we(i,de.ActionInvalid);const c=s[s.length-1],u=s[s.length-2];if(ye(n)&&n.payload.playerID!==c.playerID)return Wt("Cannot undo other players' moves"),we(i,de.ActionInvalid);if(c.moveType){if(!((t,e,r)=>!function(t){return void 0!==t.undoable}(r)||(r.undoable instanceof Function?r.undoable(t,e):r.undoable))(e,r,t.flow.getMove(u.ctx,c.moveType,c.playerID)))return Wt("Move cannot be undone"),we(i,de.ActionInvalid)}return i=ge(i,n),{...i,G:u.G,ctx:u.ctx,plugins:u.plugins,_stateID:a+1,_undo:s.slice(0,-1),_redo:[c,...o]}}case _t:{if(i={...i,deltalog:[]},t.disableUndo)return Wt("Redo is not enabled"),we(i,de.ActionDisabled);const{_undo:e,_redo:r,_stateID:s}=i;if(0===r.length)return Wt("No moves to redo"),we(i,de.ActionInvalid);const o=r[0];return ye(n)&&n.payload.playerID!==o.playerID?(Wt("Cannot redo other players' moves"),we(i,de.ActionInvalid)):(i=ge(i,n),{...i,G:o.G,ctx:o.ctx,plugins:o.plugins,_stateID:s+1,_undo:[...e,o],_redo:r.slice(1)})}case kt:return((t,e,r)=>(r.game.plugins.filter((t=>void 0!==t.action)).filter((t=>t.name===e.payload.type)).forEach((r=>{const n=r.name,s=t.plugins[n]||{data:{}},i=r.action(s.data,e.payload);t={...t,plugins:{...t.plugins,[n]:{...s,data:i}}}})),t))(i,n,{game:t});case At:{const t=i,e=JSON.parse(JSON.stringify(t)),r=(0,s.af)(e,n.patch);return r.some((t=>null!==t))?(Wt(`Patch ${JSON.stringify(n.patch)} apply failed`),we(t,fe.PatchFailed,r)):e}default:return i}}}function _e({game:t,numPlayers:e,setupData:r}){e||(e=2);let n={G:{},ctx:(t=le(t)).flow.ctx(e),plugins:{}};n=((t,e)=>([...Xt,...e.game.plugins].filter((t=>void 0!==t.setup)).forEach((r=>{const n=r.name,s=r.setup({G:t.G,ctx:t.ctx,game:e.game});t={...t,plugins:{...t.plugins,[n]:{data:s}}}})),t))(n,{game:t}),n=ee(n,{game:t,playerID:void 0});const s=Qt(n);n.G=t.setup(s,r);let i={...n,_undo:[],_redo:[],_stateID:0};return i=t.flow.init(i),[i]=re(i,{game:t}),t.disableUndo||(i._undo=[{G:i.G,ctx:i.ctx,plugins:i.plugins}]),i}class Ie{constructor({transportDataCallback:t,gameName:e,playerID:r,matchID:n,credentials:s,numPlayers:i}){this.connectionStatusCallback=()=>{},this.isConnected=!1,this.transportDataCallback=t,this.gameName=e||"default",this.playerID=r||null,this.matchID=n||"default",this.credentials=s,this.numPlayers=i||2}subscribeToConnectionStatus(t){this.connectionStatusCallback=t}setConnectionStatus(t){this.isConnected=t,this.connectionStatusCallback()}notifyClient(t){this.transportDataCallback(t)}}class Oe extends Ie{connect(){}disconnect(){}sendAction(){}sendChatMessage(){}requestSync(){}updateCredentials(){}updateMatchID(){}updatePlayerID(){}}const Se=t=>new Oe(t);const xe=new class{constructor(){this.debugPanel=null,this.currentClient=null,this.clients=new Map,this.subscribers=new Map}register(t){this.clients.set(t,t),this.mountDebug(t),this.notifySubscribers()}unregister(t){if(this.clients.delete(t),this.currentClient===t){this.unmountDebug();for(const[t]of this.clients){if(this.debugPanel)break;this.mountDebug(t)}}this.notifySubscribers()}subscribe(t){const e=Symbol();return this.subscribers.set(e,t),t(this.getState()),()=>{this.subscribers.delete(e)}}switchPlayerID(t){if(this.currentClient.multiplayer)for(const[e]of this.clients)if(e.playerID===t&&!1!==e.debugOpt&&e.multiplayer===this.currentClient.multiplayer)return void this.switchToClient(e);this.currentClient.updatePlayerID(t),this.notifySubscribers()}switchToClient(t){t!==this.currentClient&&(this.unmountDebug(),this.mountDebug(t),this.notifySubscribers())}notifySubscribers(){const t=this.getState();this.subscribers.forEach((e=>{e(t)}))}getState(){return{client:this.currentClient,debuggableClients:this.getDebuggableClients()}}getDebuggableClients(){return[...this.clients.values()].filter((t=>!1!==t.debugOpt))}mountDebug(t){if(!1===t.debugOpt||null!==this.debugPanel||"undefined"===typeof document)return;let e,r=document.body;t.debugOpt&&!0!==t.debugOpt&&(e=t.debugOpt.impl||e,r=t.debugOpt.target||r),e&&(this.currentClient=t,this.debugPanel=new e({target:r,props:{clientManager:this}}))}unmountDebug(){this.debugPanel.$destroy(),this.debugPanel=null,this.currentClient=null}};function Ae(t,e,r){if(!r&&(null===t||void 0===t)){t=e.getState().ctx.currentPlayer}return t}function ke(t,e,r,n,s,i){const o={};for(const a of e)o[a]=(...e)=>{const o=$t[t](a,e,Ae(n,r,i),s);r.dispatch(o)};return o}const De=ke.bind(null,"makeMove"),Ne=ke.bind(null,"gameEvent"),Me=ke.bind(null,"plugin");class Ce{constructor({game:t,debug:e,numPlayers:r,multiplayer:n,matchID:s,playerID:o,credentials:a,enhancer:c}){this.game=le(t),this.playerID=o,this.matchID=s||"default",this.credentials=a,this.multiplayer=n,this.debugOpt=e,this.manager=xe,this.gameStateOverride=null,this.subscribers={},this._running=!1,this.reducer=Pe({game:this.game,isClient:void 0!==n}),this.initialState=null,n||(this.initialState=_e({game:this.game,numPlayers:r})),this.reset=()=>{this.store.dispatch(Rt(this.initialState))},this.undo=()=>{const t=Lt(Ae(this.playerID,this.store,this.multiplayer),this.credentials);this.store.dispatch(t)},this.redo=()=>{const t=Ut(Ae(this.playerID,this.store,this.multiplayer),this.credentials);this.store.dispatch(t)},this.log=[];const u=m(Ee,(()=>t=>e=>{const r=t(e);return this.notifySubscribers(),r}),(t=>e=>r=>{const n=t.getState(),s=e(r);return"clientOnly"in r||r.type===Dt||this.transport.sendAction(n,r),s}),(t=>e=>r=>{const n=e(r),s=t.getState();switch(r.type){case Et:case Pt:case St:case _t:{const t=s.deltalog;this.log=[...this.log,...t];break}case It:this.log=[];break;case At:case xt:{let t=-1;this.log.length>0&&(t=this.log[this.log.length-1]._stateID);let e=r.deltalog||[];e=e.filter((e=>e._stateID>t)),this.log=[...this.log,...e];break}case Ot:this.initialState=r.initialState,this.log=r.log||[]}return n}));c=void 0!==c?y(u,c):u,this.store=d(this.reducer,this.initialState,c),n||(n=Se),this.transport=n({transportDataCallback:t=>this.receiveTransportData(t),gameKey:t,game:this.game,matchID:s,playerID:o,credentials:a,gameName:this.game.name,numPlayers:r}),this.createDispatchers(),this.chatMessages=[],this.sendChatMessage=t=>{this.transport.sendChatMessage(this.matchID,{id:i(7),sender:this.playerID,payload:t})}}receiveMatchData(t){this.matchData=t,this.notifySubscribers()}receiveChatMessage(t){this.chatMessages=[...this.chatMessages,t],this.notifySubscribers()}receiveTransportData(t){const[e]=t.args;if(e===this.matchID)switch(t.type){case"sync":{const[,e]=t.args,r=Tt(e);this.receiveMatchData(e.filteredMetadata),this.store.dispatch(r);break}case"update":{const[,e,r]=t.args,n=this.store.getState();if(e._stateID>=n._stateID){const t=Bt(e,r);this.store.dispatch(t)}break}case"patch":{const[,e,r,n,s]=t.args,i=this.store.getState()._stateID;if(e!==i)break;const o=jt(e,r,n,s);this.store.dispatch(o),this.store.getState()._stateID===i&&this.transport.requestSync();break}case"matchData":{const[,e]=t.args;this.receiveMatchData(e);break}case"chat":{const[,e]=t.args;this.receiveChatMessage(e);break}}}notifySubscribers(){Object.values(this.subscribers).forEach((t=>t(this.getState())))}overrideGameState(t){this.gameStateOverride=t,this.notifySubscribers()}start(){this.transport.connect(),this._running=!0,this.manager.register(this)}stop(){this.transport.disconnect(),this._running=!1,this.manager.unregister(this)}subscribe(t){const e=Object.keys(this.subscribers).length;return this.subscribers[e]=t,this.transport.subscribeToConnectionStatus((()=>this.notifySubscribers())),!this._running&&this.multiplayer||t(this.getState()),()=>{delete this.subscribers[e]}}getInitialState(){return this.initialState}getState(){let t=this.store.getState();if(null!==this.gameStateOverride&&(t=this.gameStateOverride),null===t)return t;let e=!0;const r=this.game.flow.isPlayerActive(t.G,t.ctx,this.playerID);return this.multiplayer&&!r&&(e=!1),this.multiplayer||null===this.playerID||void 0===this.playerID||r||(e=!1),void 0!==t.ctx.gameover&&(e=!1),this.multiplayer||(t={...t,G:this.game.playerView(t.G,t.ctx,this.playerID),plugins:ne(t,this)}),{...t,log:this.log,isActive:e,isConnected:this.transport.isConnected}}createDispatchers(){this.moves=De(this.game.moveNames,this.store,this.playerID,this.credentials,this.multiplayer),this.events=Ne(this.game.flow.enabledEventNames,this.store,this.playerID,this.credentials,this.multiplayer),this.plugins=Me(this.game.pluginNames,this.store,this.playerID,this.credentials,this.multiplayer)}updatePlayerID(t){this.playerID=t,this.createDispatchers(),this.transport.updatePlayerID(t),this.notifySubscribers()}updateMatchID(t){this.matchID=t,this.createDispatchers(),this.transport.updateMatchID(t),this.notifySubscribers()}updateCredentials(t){this.credentials=t,this.createDispatchers(),this.transport.updateCredentials(t),this.notifySubscribers()}}const{parse:Te,stringify:je}=JSON,{keys:Be}=Object;r(9382);class Re{constructor({enumerate:t,seed:e}){this.enumerateFn=t,this.seed=e,this.iterationCounter=0,this._opts={}}addOpt({key:t,range:e,initial:r}){this._opts[t]={range:e,value:r}}getOpt(t){return this._opts[t].value}setOpt(t,e){t in this._opts&&(this._opts[t].value=e)}opts(){return this._opts}enumerate(t,e,r){return this.enumerateFn(t,e,r).map((t=>"payload"in t?t:"move"in t?Nt(t.move,t.args,r):"event"in t?Mt(t.event,t.args,r):void 0))}random(t){let e;if(void 0!==this.seed){const t=vt(this.prngstate?"":this.seed,this.prngstate);e=t(),this.prngstate=t.state()}else e=Math.random();if(t){if(Array.isArray(t)){return t[Math.floor(e*t.length)]}return Math.floor(e*t)}return e}}class Le extends Re{constructor({enumerate:t,seed:e,objectives:r,game:n,iterations:s,playoutDepth:i,iterationCallback:o}){super({enumerate:t,seed:e}),void 0===r&&(r=()=>({})),this.objectives=r,this.iterationCallback=o||(()=>{}),this.reducer=Pe({game:n}),this.iterations=s,this.playoutDepth=i,this.addOpt({key:"async",initial:!1}),this.addOpt({key:"iterations",initial:"number"===typeof s?s:1e3,range:{min:1,max:2e3}}),this.addOpt({key:"playoutDepth",initial:"number"===typeof i?i:50,range:{min:1,max:100}})}createNode({state:t,parentAction:e,parent:r,playerID:n}){const{G:s,ctx:i}=t;let o=[],a=[];if(void 0!==n)o=this.enumerate(s,i,n),a=this.objectives(s,i,n);else if(i.activePlayers)for(const c in i.activePlayers)o.push(...this.enumerate(s,i,c)),a.push(this.objectives(s,i,c));else o=this.enumerate(s,i,i.currentPlayer),a=this.objectives(s,i,i.currentPlayer);return{state:t,parent:r,parentAction:e,actions:o,objectives:a,children:[],visits:0,value:0}}select(t){if(t.actions.length>0)return t;if(0===t.children.length)return t;let e=null,r=0;for(const n of t.children){const s=n.visits+Number.EPSILON,i=n.value/s+Math.sqrt(2*Math.log(t.visits)/s);(null==e||i>r)&&(r=i,e=n)}return this.select(e)}expand(t){const e=t.actions;if(0===e.length||void 0!==t.state.ctx.gameover)return t;const r=this.random(e.length),n=e[r];t.actions.splice(r,1);const s=this.reducer(t.state,n),i=this.createNode({state:s,parentAction:n,parent:t});return t.children.push(i),i}playout({state:t}){let e=this.getOpt("playoutDepth");"function"===typeof this.playoutDepth&&(e=this.playoutDepth(t.G,t.ctx));for(let r=0;r<e&&void 0===t.ctx.gameover;r++){const{G:e,ctx:r}=t;let n=r.currentPlayer;r.activePlayers&&(n=Object.keys(r.activePlayers)[0]);const s=this.enumerate(e,r,n),i=this.objectives(e,r,n),o=Object.keys(i).reduce(((t,n)=>{const s=i[n];return s.checker(e,r)?t+s.weight:t}),0);if(o>0)return{score:o};if(!s||0===s.length)return;const a=this.random(s.length);t=this.reducer(t,s[a])}return t.ctx.gameover}backpropagate(t,e={}){t.visits++,void 0!==e.score&&(t.value+=e.score),!0===e.draw&&(t.value+=.5),t.parentAction&&e.winner===t.parentAction.payload.playerID&&t.value++,t.parent&&this.backpropagate(t.parent,e)}play(t,e){const r=this.createNode({state:t,playerID:e});let n=this.getOpt("iterations");"function"===typeof this.iterations&&(n=this.iterations(t.G,t.ctx));const s=()=>{let t=null;for(const e of r.children)(null==t||e.visits>t.visits)&&(t=e);return{action:t&&t.parentAction,metadata:r}};return new Promise((t=>{const e=()=>{for(let t=0;t<25&&this.iterationCounter<n;t++){const t=this.select(r),e=this.expand(t),n=this.playout(e);this.backpropagate(e,n),this.iterationCounter++}this.iterationCallback({iterationCounter:this.iterationCounter,numIterations:n,metadata:r})};if(this.iterationCounter=0,this.getOpt("async")){const r=()=>{this.iterationCounter<n?(e(),setImmediate(r)):t(s())};r()}else{for(;this.iterationCounter<n;)e();t(s())}}))}}const Ue=(t,e)=>{if(!t||"string"!==typeof t)throw new Error(`Expected ${e} string, got "${t}".`)},Ge=t=>Ue(t,"game name"),$e=t=>Ue(t,"match ID"),Fe=(t,e)=>{if(!t)throw new Error(`Expected body, got \u201c${t}\u201d.`);for(const r in e){const n=e[r],s=Array.isArray(n)?n:[n],i=t[r];if(!s.includes(typeof i)){const t=s.join("|");throw new TypeError(`Expected body.${r} to be of type ${t}, got \u201c${i}\u201d.`)}}};class qe extends Error{constructor(t,e){super(t),this.details=e}}class Ve{constructor({server:t=""}={}){this.server=t.replace(/\/$/,"")}async request(t,e){const r=await fetch(this.server+t,e);if(!r.ok){let t;try{t=await r.clone().json()}catch{try{t=await r.text()}catch(Wt){t=Wt.message}}throw new qe(`HTTP status ${r.status}`,t)}return r.json()}async post(t,e){let r={method:"post",body:JSON.stringify(e.body),headers:{"Content-Type":"application/json"}};return e.init&&(r={...r,...e.init,headers:{...r.headers,...e.init.headers}}),this.request(t,r)}async listGames(t){return this.request("/games",t)}async listMatches(t,e,r){Ge(t);let n="";if(e){const t=[],{isGameover:r,updatedBefore:s,updatedAfter:i}=e;void 0!==r&&t.push(`isGameover=${r}`),s&&t.push(`updatedBefore=${s}`),i&&t.push(`updatedAfter=${i}`),t.length>0&&(n="?"+t.join("&"))}return this.request(`/games/${t}${n}`,r)}async getMatch(t,e,r){return Ge(t),$e(e),this.request(`/games/${t}/${e}`,r)}async createMatch(t,e,r){return Ge(t),Fe(e,{numPlayers:"number"}),this.post(`/games/${t}/create`,{body:e,init:r})}async joinMatch(t,e,r,n){return Ge(t),$e(e),Fe(r,{playerID:["string","undefined"],playerName:"string"}),this.post(`/games/${t}/${e}/join`,{body:r,init:n})}async leaveMatch(t,e,r,n){Ge(t),$e(e),Fe(r,{playerID:"string",credentials:"string"}),await this.post(`/games/${t}/${e}/leave`,{body:r,init:n})}async updatePlayer(t,e,r,n){Ge(t),$e(e),Fe(r,{playerID:"string",credentials:"string"}),await this.post(`/games/${t}/${e}/update`,{body:r,init:n})}async playAgain(t,e,r,n){return Ge(t),$e(e),Fe(r,{playerID:"string",credentials:"string"}),this.post(`/games/${t}/${e}/playAgain`,{body:r,init:n})}}var ze,Je=r(7378),Ke=r(3615),He=r.n(Ke),Ye=r(1877);function We(t){return t.type()===ze.SYNC}!function(t){t[t.SYNC=0]="SYNC",t[t.ASYNC=1]="ASYNC"}(ze||(ze={}));const Ze=({game:t,numPlayers:e,setupData:r,unlisted:n})=>{e&&"number"===typeof e||(e=2);const s=t.validateSetupData&&t.validateSetupData(r,e);if(void 0!==s)return{setupDataError:s};const i=(({game:t,unlisted:e,setupData:r,numPlayers:n})=>{const s={gameName:t.name,unlisted:!!e,players:{},createdAt:Date.now(),updatedAt:Date.now()};void 0!==r&&(s.setupData=r);for(let i=0;i<n;i++)s.players[i]={id:i};return s})({game:t,numPlayers:e,setupData:r,unlisted:n});return{metadata:i,initialState:_e({game:t,numPlayers:e,setupData:r})}},Xe=t=>Object.values(t.players).map((t=>{const{credentials:e,...r}=t;return r}));const Qe=(t,e,r)=>({...r,G:t.playerView(r.G,r.ctx,e),plugins:ne(r,{playerID:e,game:t}),deltalog:void 0,_undo:[],_redo:[]});function tr(t,e){return void 0===t?t:t.map((t=>{if(null!==e&&+e===+t.action.payload.playerID)return t;if(!0!==t.redact)return t;const r={...t.action.payload,args:null},n={...t,action:{...t.action,payload:r}},{redact:s,...i}=n;return i}))}const er=Object.create(null);er.open="0",er.close="1",er.ping="2",er.pong="3",er.message="4",er.upgrade="5",er.noop="6";const rr=Object.create(null);Object.keys(er).forEach((t=>{rr[er[t]]=t}));const nr={type:"error",data:"parser error"},sr="function"===typeof Blob||"undefined"!==typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),ir="function"===typeof ArrayBuffer,or=(t,e)=>{const r=new FileReader;return r.onload=function(){const t=r.result.split(",")[1];e("b"+t)},r.readAsDataURL(t)};var ar=({type:t,data:e},r,n)=>{return sr&&e instanceof Blob?r?n(e):or(e,n):ir&&(e instanceof ArrayBuffer||(s=e,"function"===typeof ArrayBuffer.isView?ArrayBuffer.isView(s):s&&s.buffer instanceof ArrayBuffer))?r?n(e):or(new Blob([e]),n):n(er[t]+(e||""));var s};const cr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ur="undefined"===typeof Uint8Array?[]:new Uint8Array(256);for(let Mn=0;Mn<cr.length;Mn++)ur[cr.charCodeAt(Mn)]=Mn;const hr="function"===typeof ArrayBuffer,lr=(t,e)=>{if(hr){const r=(t=>{let e,r,n,s,i,o=.75*t.length,a=t.length,c=0;"="===t[t.length-1]&&(o--,"="===t[t.length-2]&&o--);const u=new ArrayBuffer(o),h=new Uint8Array(u);for(e=0;e<a;e+=4)r=ur[t.charCodeAt(e)],n=ur[t.charCodeAt(e+1)],s=ur[t.charCodeAt(e+2)],i=ur[t.charCodeAt(e+3)],h[c++]=r<<2|n>>4,h[c++]=(15&n)<<4|s>>2,h[c++]=(3&s)<<6|63&i;return u})(t);return pr(r,e)}return{base64:!0,data:t}},pr=(t,e)=>"blob"===e&&t instanceof ArrayBuffer?new Blob([t]):t;var fr=(t,e)=>{if("string"!==typeof t)return{type:"message",data:pr(t,e)};const r=t.charAt(0);if("b"===r)return{type:"message",data:lr(t.substring(1),e)};return rr[r]?t.length>1?{type:rr[r],data:t.substring(1)}:{type:rr[r]}:nr};const dr=String.fromCharCode(30);function yr(t){if(t)return function(t){for(var e in yr.prototype)t[e]=yr.prototype[e];return t}(t)}yr.prototype.on=yr.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},yr.prototype.once=function(t,e){function r(){this.off(t,r),e.apply(this,arguments)}return r.fn=e,this.on(t,r),this},yr.prototype.off=yr.prototype.removeListener=yr.prototype.removeAllListeners=yr.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r,n=this._callbacks["$"+t];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var s=0;s<n.length;s++)if((r=n[s])===e||r.fn===e){n.splice(s,1);break}return 0===n.length&&delete this._callbacks["$"+t],this},yr.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),r=this._callbacks["$"+t],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(r){n=0;for(var s=(r=r.slice(0)).length;n<s;++n)r[n].apply(this,e)}return this},yr.prototype.emitReserved=yr.prototype.emit,yr.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},yr.prototype.hasListeners=function(t){return!!this.listeners(t).length};const mr="undefined"!==typeof self?self:"undefined"!==typeof window?window:Function("return this")();function gr(t,...e){return e.reduce(((e,r)=>(t.hasOwnProperty(r)&&(e[r]=t[r]),e)),{})}const vr=setTimeout,br=clearTimeout;function wr(t,e){e.useNativeTimers?(t.setTimeoutFn=vr.bind(mr),t.clearTimeoutFn=br.bind(mr)):(t.setTimeoutFn=setTimeout.bind(mr),t.clearTimeoutFn=clearTimeout.bind(mr))}class Er extends Error{constructor(t,e,r){super(t),this.description=e,this.context=r,this.type="TransportError"}}class Pr extends yr{constructor(t){super(),this.writable=!1,wr(this,t),this.opts=t,this.query=t.query,this.readyState="",this.socket=t.socket}onError(t,e,r){return super.emitReserved("error",new Er(t,e,r)),this}open(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(t){"open"===this.readyState&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){const e=fr(t,this.socket.binaryType);this.onPacket(e)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}}const _r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),Ir={};let Or,Sr=0,xr=0;function Ar(t){let e="";do{e=_r[t%64]+e,t=Math.floor(t/64)}while(t>0);return e}function kr(){const t=Ar(+new Date);return t!==Or?(Sr=0,Or=t):t+"."+Ar(Sr++)}for(;xr<64;xr++)Ir[_r[xr]]=xr;function Dr(t){let e="";for(let r in t)t.hasOwnProperty(r)&&(e.length&&(e+="&"),e+=encodeURIComponent(r)+"="+encodeURIComponent(t[r]));return e}let Nr=!1;try{Nr="undefined"!==typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(Nn){}const Mr=Nr;function Cr(t){const e=t.xdomain;try{if("undefined"!==typeof XMLHttpRequest&&(!e||Mr))return new XMLHttpRequest}catch(r){}if(!e)try{return new(mr[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(r){}}function Tr(){}const jr=null!=new Cr({xdomain:!1}).responseType;class Br extends yr{constructor(t,e){super(),wr(this,e),this.opts=e,this.method=e.method||"GET",this.uri=t,this.async=!1!==e.async,this.data=void 0!==e.data?e.data:null,this.create()}create(){const t=gr(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this.opts.xd,t.xscheme=!!this.opts.xs;const e=this.xhr=new Cr(t);try{e.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){e.setDisableHeaderCheck&&e.setDisableHeaderCheck(!0);for(let t in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(t)&&e.setRequestHeader(t,this.opts.extraHeaders[t])}}catch(r){}if("POST"===this.method)try{e.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(r){}try{e.setRequestHeader("Accept","*/*")}catch(r){}"withCredentials"in e&&(e.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(e.timeout=this.opts.requestTimeout),e.onreadystatechange=()=>{4===e.readyState&&(200===e.status||1223===e.status?this.onLoad():this.setTimeoutFn((()=>{this.onError("number"===typeof e.status?e.status:0)}),0))},e.send(this.data)}catch(r){return void this.setTimeoutFn((()=>{this.onError(r)}),0)}"undefined"!==typeof document&&(this.index=Br.requestsCount++,Br.requests[this.index]=this)}onError(t){this.emitReserved("error",t,this.xhr),this.cleanup(!0)}cleanup(t){if("undefined"!==typeof this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=Tr,t)try{this.xhr.abort()}catch(e){}"undefined"!==typeof document&&delete Br.requests[this.index],this.xhr=null}}onLoad(){const t=this.xhr.responseText;null!==t&&(this.emitReserved("data",t),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}if(Br.requestsCount=0,Br.requests={},"undefined"!==typeof document)if("function"===typeof attachEvent)attachEvent("onunload",Rr);else if("function"===typeof addEventListener){addEventListener("onpagehide"in mr?"pagehide":"unload",Rr,!1)}function Rr(){for(let t in Br.requests)Br.requests.hasOwnProperty(t)&&Br.requests[t].abort()}const Lr="function"===typeof Promise&&"function"===typeof Promise.resolve?t=>Promise.resolve().then(t):(t,e)=>e(t,0),Ur=mr.WebSocket||mr.MozWebSocket;r(2241).Buffer;const Gr="undefined"!==typeof navigator&&"string"===typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();const $r={websocket:class extends Pr{constructor(t){super(t),this.supportsBinary=!t.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const t=this.uri(),e=this.opts.protocols,r=Gr?{}:gr(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=Gr?new Ur(t,e,r):e?new Ur(t,e):new Ur(t)}catch(Nn){return this.emitReserved("error",Nn)}this.ws.binaryType=this.socket.binaryType||"arraybuffer",this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let e=0;e<t.length;e++){const r=t[e],n=e===t.length-1;ar(r,this.supportsBinary,(t=>{try{this.ws.send(t)}catch(e){}n&&Lr((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){"undefined"!==typeof this.ws&&(this.ws.close(),this.ws=null)}uri(){let t=this.query||{};const e=this.opts.secure?"wss":"ws";let r="";this.opts.port&&("wss"===e&&443!==Number(this.opts.port)||"ws"===e&&80!==Number(this.opts.port))&&(r=":"+this.opts.port),this.opts.timestampRequests&&(t[this.opts.timestampParam]=kr()),this.supportsBinary||(t.b64=1);const n=Dr(t);return e+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(n.length?"?"+n:"")}check(){return!!Ur}},polling:class extends Pr{constructor(t){if(super(t),this.polling=!1,"undefined"!==typeof location){const e="https:"===location.protocol;let r=location.port;r||(r=e?"443":"80"),this.xd="undefined"!==typeof location&&t.hostname!==location.hostname||r!==t.port,this.xs=t.secure!==e}const e=t&&t.forceBase64;this.supportsBinary=jr&&!e}get name(){return"polling"}doOpen(){this.poll()}pause(t){this.readyState="pausing";const e=()=>{this.readyState="paused",t()};if(this.polling||!this.writable){let t=0;this.polling&&(t++,this.once("pollComplete",(function(){--t||e()}))),this.writable||(t++,this.once("drain",(function(){--t||e()})))}else e()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){((t,e)=>{const r=t.split(dr),n=[];for(let s=0;s<r.length;s++){const t=fr(r[s],e);if(n.push(t),"error"===t.type)break}return n})(t,this.socket.binaryType).forEach((t=>{if("opening"===this.readyState&&"open"===t.type&&this.onOpen(),"close"===t.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(t)})),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){const t=()=>{this.write([{type:"close"}])};"open"===this.readyState?t():this.once("open",t)}write(t){this.writable=!1,((t,e)=>{const r=t.length,n=new Array(r);let s=0;t.forEach(((t,i)=>{ar(t,!1,(t=>{n[i]=t,++s===r&&e(n.join(dr))}))}))})(t,(t=>{this.doWrite(t,(()=>{this.writable=!0,this.emitReserved("drain")}))}))}uri(){let t=this.query||{};const e=this.opts.secure?"https":"http";let r="";!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=kr()),this.supportsBinary||t.sid||(t.b64=1),this.opts.port&&("https"===e&&443!==Number(this.opts.port)||"http"===e&&80!==Number(this.opts.port))&&(r=":"+this.opts.port);const n=Dr(t);return e+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(n.length?"?"+n:"")}request(t={}){return Object.assign(t,{xd:this.xd,xs:this.xs},this.opts),new Br(this.uri(),t)}doWrite(t,e){const r=this.request({method:"POST",data:t});r.on("success",e),r.on("error",((t,e)=>{this.onError("xhr post error",t,e)}))}doPoll(){const t=this.request();t.on("data",this.onData.bind(this)),t.on("error",((t,e)=>{this.onError("xhr poll error",t,e)})),this.pollXhr=t}}},Fr=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,qr=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Vr(t){const e=t,r=t.indexOf("["),n=t.indexOf("]");-1!=r&&-1!=n&&(t=t.substring(0,r)+t.substring(r,n).replace(/:/g,";")+t.substring(n,t.length));let s=Fr.exec(t||""),i={},o=14;for(;o--;)i[qr[o]]=s[o]||"";return-1!=r&&-1!=n&&(i.source=e,i.host=i.host.substring(1,i.host.length-1).replace(/;/g,":"),i.authority=i.authority.replace("[","").replace("]","").replace(/;/g,":"),i.ipv6uri=!0),i.pathNames=function(t,e){const r=/\/{2,9}/g,n=e.replace(r,"/").split("/");"/"!=e.substr(0,1)&&0!==e.length||n.splice(0,1);"/"==e.substr(e.length-1,1)&&n.splice(n.length-1,1);return n}(0,i.path),i.queryKey=function(t,e){const r={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(t,e,n){e&&(r[e]=n)})),r}(0,i.query),i}class zr extends yr{constructor(t,e={}){super(),t&&"object"===typeof t&&(e=t,t=null),t?(t=Vr(t),e.hostname=t.host,e.secure="https"===t.protocol||"wss"===t.protocol,e.port=t.port,t.query&&(e.query=t.query)):e.host&&(e.hostname=Vr(e.host).host),wr(this,e),this.secure=null!=e.secure?e.secure:"undefined"!==typeof location&&"https:"===location.protocol,e.hostname&&!e.port&&(e.port=this.secure?"443":"80"),this.hostname=e.hostname||("undefined"!==typeof location?location.hostname:"localhost"),this.port=e.port||("undefined"!==typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=e.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},e),this.opts.path=this.opts.path.replace(/\/$/,"")+"/","string"===typeof this.opts.query&&(this.opts.query=function(t){let e={},r=t.split("&");for(let n=0,s=r.length;n<s;n++){let t=r[n].split("=");e[decodeURIComponent(t[0])]=decodeURIComponent(t[1])}return e}(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"===typeof addEventListener&&(this.opts.closeOnBeforeunload&&addEventListener("beforeunload",(()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())}),!1),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(t){const e=Object.assign({},this.opts.query);e.EIO=4,e.transport=t,this.id&&(e.sid=this.id);const r=Object.assign({},this.opts.transportOptions[t],this.opts,{query:e,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new $r[t](r)}open(){let t;if(this.opts.rememberUpgrade&&zr.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))t="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn((()=>{this.emitReserved("error","No transports available")}),0);t=this.transports[0]}this.readyState="opening";try{t=this.createTransport(t)}catch(e){return this.transports.shift(),void this.open()}t.open(),this.setTransport(t)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(t=>this.onClose("transport close",t)))}probe(t){let e=this.createTransport(t),r=!1;zr.priorWebsocketSuccess=!1;const n=()=>{r||(e.send([{type:"ping",data:"probe"}]),e.once("packet",(t=>{if(!r)if("pong"===t.type&&"probe"===t.data){if(this.upgrading=!0,this.emitReserved("upgrading",e),!e)return;zr.priorWebsocketSuccess="websocket"===e.name,this.transport.pause((()=>{r||"closed"!==this.readyState&&(u(),this.setTransport(e),e.send([{type:"upgrade"}]),this.emitReserved("upgrade",e),e=null,this.upgrading=!1,this.flush())}))}else{const t=new Error("probe error");t.transport=e.name,this.emitReserved("upgradeError",t)}})))};function s(){r||(r=!0,u(),e.close(),e=null)}const i=t=>{const r=new Error("probe error: "+t);r.transport=e.name,s(),this.emitReserved("upgradeError",r)};function o(){i("transport closed")}function a(){i("socket closed")}function c(t){e&&t.name!==e.name&&s()}const u=()=>{e.removeListener("open",n),e.removeListener("error",i),e.removeListener("close",o),this.off("close",a),this.off("upgrading",c)};e.once("open",n),e.once("error",i),e.once("close",o),this.once("close",a),this.once("upgrading",c),e.open()}onOpen(){if(this.readyState="open",zr.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade&&this.transport.pause){let t=0;const e=this.upgrades.length;for(;t<e;t++)this.probe(this.upgrades[t])}}onPacket(t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const e=new Error("server error");e.code=t.data,this.onError(e);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data)}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.maxPayload=t.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn((()=>{this.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this.getWritablePackets();this.transport.send(t),this.prevBufferLen=t.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let r=0;r<this.writeBuffer.length;r++){const n=this.writeBuffer[r].data;if(n&&(t+="string"===typeof(e=n)?function(t){let e=0,r=0;for(let n=0,s=t.length;n<s;n++)e=t.charCodeAt(n),e<128?r+=1:e<2048?r+=2:e<55296||e>=57344?r+=3:(n++,r+=4);return r}(e):Math.ceil(1.33*(e.byteLength||e.size))),r>0&&t>this.maxPayload)return this.writeBuffer.slice(0,r);t+=2}var e;return this.writeBuffer}write(t,e,r){return this.sendPacket("message",t,e,r),this}send(t,e,r){return this.sendPacket("message",t,e,r),this}sendPacket(t,e,r,n){if("function"===typeof e&&(n=e,e=void 0),"function"===typeof r&&(n=r,r=null),"closing"===this.readyState||"closed"===this.readyState)return;(r=r||{}).compress=!1!==r.compress;const s={type:t,data:e,options:r};this.emitReserved("packetCreate",s),this.writeBuffer.push(s),n&&this.once("flush",n),this.flush()}close(){const t=()=>{this.onClose("forced close"),this.transport.close()},e=()=>{this.off("upgrade",e),this.off("upgradeError",e),t()},r=()=>{this.once("upgrade",e),this.once("upgradeError",e)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(()=>{this.upgrading?r():t()})):this.upgrading?r():t()),this}onError(t){zr.priorWebsocketSuccess=!1,this.emitReserved("error",t),this.onClose("transport error",t)}onClose(t,e){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"===typeof removeEventListener&&removeEventListener("offline",this.offlineEventListener,!1),this.readyState="closed",this.id=null,this.emitReserved("close",t,e),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(t){const e=[];let r=0;const n=t.length;for(;r<n;r++)~this.transports.indexOf(t[r])&&e.push(t[r]);return e}}zr.protocol=4;zr.protocol;const Jr="function"===typeof ArrayBuffer,Kr=Object.prototype.toString,Hr="function"===typeof Blob||"undefined"!==typeof Blob&&"[object BlobConstructor]"===Kr.call(Blob),Yr="function"===typeof File||"undefined"!==typeof File&&"[object FileConstructor]"===Kr.call(File);function Wr(t){return Jr&&(t instanceof ArrayBuffer||(t=>"function"===typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer)(t))||Hr&&t instanceof Blob||Yr&&t instanceof File}function Zr(t,e){if(!t||"object"!==typeof t)return!1;if(Array.isArray(t)){for(let e=0,r=t.length;e<r;e++)if(Zr(t[e]))return!0;return!1}if(Wr(t))return!0;if(t.toJSON&&"function"===typeof t.toJSON&&1===arguments.length)return Zr(t.toJSON(),!0);for(const r in t)if(Object.prototype.hasOwnProperty.call(t,r)&&Zr(t[r]))return!0;return!1}function Xr(t){const e=[],r=t.data,n=t;return n.data=Qr(r,e),n.attachments=e.length,{packet:n,buffers:e}}function Qr(t,e){if(!t)return t;if(Wr(t)){const r={_placeholder:!0,num:e.length};return e.push(t),r}if(Array.isArray(t)){const r=new Array(t.length);for(let n=0;n<t.length;n++)r[n]=Qr(t[n],e);return r}if("object"===typeof t&&!(t instanceof Date)){const r={};for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=Qr(t[n],e));return r}return t}function tn(t,e){return t.data=en(t.data,e),t.attachments=void 0,t}function en(t,e){if(!t)return t;if(t&&!0===t._placeholder){if("number"===typeof t.num&&t.num>=0&&t.num<e.length)return e[t.num];throw new Error("illegal attachments")}if(Array.isArray(t))for(let r=0;r<t.length;r++)t[r]=en(t[r],e);else if("object"===typeof t)for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(t[r]=en(t[r],e));return t}const rn=5;var nn;!function(t){t[t.CONNECT=0]="CONNECT",t[t.DISCONNECT=1]="DISCONNECT",t[t.EVENT=2]="EVENT",t[t.ACK=3]="ACK",t[t.CONNECT_ERROR=4]="CONNECT_ERROR",t[t.BINARY_EVENT=5]="BINARY_EVENT",t[t.BINARY_ACK=6]="BINARY_ACK"}(nn||(nn={}));class sn{constructor(t){this.replacer=t}encode(t){return t.type!==nn.EVENT&&t.type!==nn.ACK||!Zr(t)?[this.encodeAsString(t)]:(t.type=t.type===nn.EVENT?nn.BINARY_EVENT:nn.BINARY_ACK,this.encodeAsBinary(t))}encodeAsString(t){let e=""+t.type;return t.type!==nn.BINARY_EVENT&&t.type!==nn.BINARY_ACK||(e+=t.attachments+"-"),t.nsp&&"/"!==t.nsp&&(e+=t.nsp+","),null!=t.id&&(e+=t.id),null!=t.data&&(e+=JSON.stringify(t.data,this.replacer)),e}encodeAsBinary(t){const e=Xr(t),r=this.encodeAsString(e.packet),n=e.buffers;return n.unshift(r),n}}class on extends yr{constructor(t){super(),this.reviver=t}add(t){let e;if("string"===typeof t){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");e=this.decodeString(t),e.type===nn.BINARY_EVENT||e.type===nn.BINARY_ACK?(this.reconstructor=new an(e),0===e.attachments&&super.emitReserved("decoded",e)):super.emitReserved("decoded",e)}else{if(!Wr(t)&&!t.base64)throw new Error("Unknown type: "+t);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");e=this.reconstructor.takeBinaryData(t),e&&(this.reconstructor=null,super.emitReserved("decoded",e))}}decodeString(t){let e=0;const r={type:Number(t.charAt(0))};if(void 0===nn[r.type])throw new Error("unknown packet type "+r.type);if(r.type===nn.BINARY_EVENT||r.type===nn.BINARY_ACK){const n=e+1;for(;"-"!==t.charAt(++e)&&e!=t.length;);const s=t.substring(n,e);if(s!=Number(s)||"-"!==t.charAt(e))throw new Error("Illegal attachments");r.attachments=Number(s)}if("/"===t.charAt(e+1)){const n=e+1;for(;++e;){if(","===t.charAt(e))break;if(e===t.length)break}r.nsp=t.substring(n,e)}else r.nsp="/";const n=t.charAt(e+1);if(""!==n&&Number(n)==n){const n=e+1;for(;++e;){const r=t.charAt(e);if(null==r||Number(r)!=r){--e;break}if(e===t.length)break}r.id=Number(t.substring(n,e+1))}if(t.charAt(++e)){const n=this.tryParse(t.substr(e));if(!on.isPayloadValid(r.type,n))throw new Error("invalid payload");r.data=n}return r}tryParse(t){try{return JSON.parse(t,this.reviver)}catch(e){return!1}}static isPayloadValid(t,e){switch(t){case nn.CONNECT:return"object"===typeof e;case nn.DISCONNECT:return void 0===e;case nn.CONNECT_ERROR:return"string"===typeof e||"object"===typeof e;case nn.EVENT:case nn.BINARY_EVENT:return Array.isArray(e)&&e.length>0;case nn.ACK:case nn.BINARY_ACK:return Array.isArray(e)}}destroy(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}class an{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const t=tn(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function cn(t,e,r){return t.on(e,r),function(){t.off(e,r)}}const un=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class hn extends yr{constructor(t,e,r){super(),this.connected=!1,this.receiveBuffer=[],this.sendBuffer=[],this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=e,r&&r.auth&&(this.auth=r.auth),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const t=this.io;this.subs=[cn(t,"open",this.onopen.bind(this)),cn(t,"packet",this.onpacket.bind(this)),cn(t,"error",this.onerror.bind(this)),cn(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...e){if(un.hasOwnProperty(t))throw new Error('"'+t+'" is a reserved event name');e.unshift(t);const r={type:nn.EVENT,data:e,options:{}};if(r.options.compress=!1!==this.flags.compress,"function"===typeof e[e.length-1]){const t=this.ids++,n=e.pop();this._registerAckCallback(t,n),r.id=t}const n=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!n||!this.connected)||(this.connected?(this.notifyOutgoingListeners(r),this.packet(r)):this.sendBuffer.push(r)),this.flags={},this}_registerAckCallback(t,e){const r=this.flags.timeout;if(void 0===r)return void(this.acks[t]=e);const n=this.io.setTimeoutFn((()=>{delete this.acks[t];for(let e=0;e<this.sendBuffer.length;e++)this.sendBuffer[e].id===t&&this.sendBuffer.splice(e,1);e.call(this,new Error("operation has timed out"))}),r);this.acks[t]=(...t)=>{this.io.clearTimeoutFn(n),e.apply(this,[null,...t])}}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){"function"==typeof this.auth?this.auth((t=>{this.packet({type:nn.CONNECT,data:t})})):this.packet({type:nn.CONNECT,data:this.auth})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,e){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,e)}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case nn.CONNECT:if(t.data&&t.data.sid){const e=t.data.sid;this.onconnect(e)}else this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case nn.EVENT:case nn.BINARY_EVENT:this.onevent(t);break;case nn.ACK:case nn.BINARY_ACK:this.onack(t);break;case nn.DISCONNECT:this.ondisconnect();break;case nn.CONNECT_ERROR:this.destroy();const e=new Error(t.data.message);e.data=t.data.data,this.emitReserved("connect_error",e)}}onevent(t){const e=t.data||[];null!=t.id&&e.push(this.ack(t.id)),this.connected?this.emitEvent(e):this.receiveBuffer.push(Object.freeze(e))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const e=this._anyListeners.slice();for(const r of e)r.apply(this,t)}super.emit.apply(this,t)}ack(t){const e=this;let r=!1;return function(...n){r||(r=!0,e.packet({type:nn.ACK,id:t,data:n}))}}onack(t){const e=this.acks[t.id];"function"===typeof e&&(e.apply(this,t.data),delete this.acks[t.id])}onconnect(t){this.id=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach((t=>this.emitEvent(t))),this.receiveBuffer=[],this.sendBuffer.forEach((t=>{this.notifyOutgoingListeners(t),this.packet(t)})),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach((t=>t())),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:nn.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){const e=this._anyListeners;for(let r=0;r<e.length;r++)if(t===e[r])return e.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){const e=this._anyOutgoingListeners;for(let r=0;r<e.length;r++)if(t===e[r])return e.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const e=this._anyOutgoingListeners.slice();for(const r of e)r.apply(this,t.data)}}}function ln(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}ln.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),r=Math.floor(e*this.jitter*t);t=0==(1&Math.floor(10*e))?t-r:t+r}return 0|Math.min(t,this.max)},ln.prototype.reset=function(){this.attempts=0},ln.prototype.setMin=function(t){this.ms=t},ln.prototype.setMax=function(t){this.max=t},ln.prototype.setJitter=function(t){this.jitter=t};class pn extends yr{constructor(t,e){var r;super(),this.nsps={},this.subs=[],t&&"object"===typeof t&&(e=t,t=void 0),(e=e||{}).path=e.path||"/socket.io",this.opts=e,wr(this,e),this.reconnection(!1!==e.reconnection),this.reconnectionAttempts(e.reconnectionAttempts||1/0),this.reconnectionDelay(e.reconnectionDelay||1e3),this.reconnectionDelayMax(e.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(r=e.randomizationFactor)&&void 0!==r?r:.5),this.backoff=new ln({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==e.timeout?2e4:e.timeout),this._readyState="closed",this.uri=t;const s=e.parser||n;this.encoder=new s.Encoder,this.decoder=new s.Decoder,this._autoConnect=!1!==e.autoConnect,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,this):this._reconnection}reconnectionAttempts(t){return void 0===t?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var e;return void 0===t?this._reconnectionDelay:(this._reconnectionDelay=t,null===(e=this.backoff)||void 0===e||e.setMin(t),this)}randomizationFactor(t){var e;return void 0===t?this._randomizationFactor:(this._randomizationFactor=t,null===(e=this.backoff)||void 0===e||e.setJitter(t),this)}reconnectionDelayMax(t){var e;return void 0===t?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,null===(e=this.backoff)||void 0===e||e.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new zr(this.uri,this.opts);const e=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const n=cn(e,"open",(function(){r.onopen(),t&&t()})),s=cn(e,"error",(e=>{r.cleanup(),r._readyState="closed",this.emitReserved("error",e),t?t(e):r.maybeReconnectOnOpen()}));if(!1!==this._timeout){const t=this._timeout;0===t&&n();const r=this.setTimeoutFn((()=>{n(),e.close(),e.emit("error",new Error("timeout"))}),t);this.opts.autoUnref&&r.unref(),this.subs.push((function(){clearTimeout(r)}))}return this.subs.push(n),this.subs.push(s),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const t=this.engine;this.subs.push(cn(t,"ping",this.onping.bind(this)),cn(t,"data",this.ondata.bind(this)),cn(t,"error",this.onerror.bind(this)),cn(t,"close",this.onclose.bind(this)),cn(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){this.decoder.add(t)}ondecoded(t){this.emitReserved("packet",t)}onerror(t){this.emitReserved("error",t)}socket(t,e){let r=this.nsps[t];return r||(r=new hn(this,t,e),this.nsps[t]=r),r}_destroy(t){const e=Object.keys(this.nsps);for(const r of e){if(this.nsps[r].active)return}this._close()}_packet(t){const e=this.encoder.encode(t);for(let r=0;r<e.length;r++)this.engine.write(e[r],t.options)}cleanup(){this.subs.forEach((t=>t())),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(t,e){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,e),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const e=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn((()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),t.skipReconnect||t.open((e=>{e?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",e)):t.onreconnect()})))}),e);this.opts.autoUnref&&r.unref(),this.subs.push((function(){clearTimeout(r)}))}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}const fn={};function dn(t,e){"object"===typeof t&&(e=t,t=void 0);const r=function(t,e="",r){let n=t;r=r||"undefined"!==typeof location&&location,null==t&&(t=r.protocol+"//"+r.host),"string"===typeof t&&("/"===t.charAt(0)&&(t="/"===t.charAt(1)?r.protocol+t:r.host+t),/^(https?|wss?):\/\//.test(t)||(t="undefined"!==typeof r?r.protocol+"//"+t:"https://"+t),n=Vr(t)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";const s=-1!==n.host.indexOf(":")?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+s+":"+n.port+e,n.href=n.protocol+"://"+s+(r&&r.port===n.port?"":":"+n.port),n}(t,(e=e||{}).path||"/socket.io"),n=r.source,s=r.id,i=r.path,o=fn[s]&&i in fn[s].nsps;let a;return e.forceNew||e["force new connection"]||!1===e.multiplex||o?a=new pn(n,e):(fn[s]||(fn[s]=new pn(n,e)),a=fn[s]),r.query&&!e.query&&(e.query=r.queryKey),a.socket(r.path,e)}Object.assign(dn,{Manager:pn,Socket:hn,io:dn,connect:dn});class yn extends class{type(){return ze.SYNC}connect(){}createMatch(t,e){if(this.createGame)return console.warn("The database connector does not implement a createMatch method.","\nUsing the deprecated createGame method instead."),this.createGame(t,e);console.error("The database connector does not implement a createMatch method.")}listMatches(t){if(this.listGames)return console.warn("The database connector does not implement a listMatches method.","\nUsing the deprecated listGames method instead."),this.listGames(t);console.error("The database connector does not implement a listMatches method.")}}{constructor(){super(),this.state=new Map,this.initial=new Map,this.metadata=new Map,this.log=new Map}createMatch(t,e){this.initial.set(t,e.initialState),this.setState(t,e.initialState),this.setMetadata(t,e.metadata)}setMetadata(t,e){this.metadata.set(t,e)}setState(t,e,r){if(r&&r.length>0){const e=this.log.get(t)||[];this.log.set(t,[...e,...r])}this.state.set(t,e)}fetch(t,e){const r={};return e.state&&(r.state=this.state.get(t)),e.metadata&&(r.metadata=this.metadata.get(t)),e.log&&(r.log=this.log.get(t)||[]),e.initialState&&(r.initialState=this.initial.get(t)),r}wipe(t){this.state.delete(t),this.metadata.delete(t)}listMatches(t){return[...this.metadata.entries()].filter((([,e])=>{if(!t)return!0;if(void 0!==t.gameName&&e.gameName!==t.gameName)return!1;if(void 0!==t.where){if(void 0!==t.where.isGameover){if(void 0!==e.gameover!==t.where.isGameover)return!1}if(void 0!==t.where.updatedBefore&&e.updatedAt>=t.where.updatedBefore)return!1;if(void 0!==t.where.updatedAfter&&e.updatedAt<=t.where.updatedAfter)return!1}return!0})).map((([t])=>t))}}class mn extends Map{constructor(t){super(),this.key=t;(JSON.parse(localStorage.getItem(this.key))||[]).forEach((t=>this.set(...t)))}sync(){const t=[...this.entries()];localStorage.setItem(this.key,JSON.stringify(t))}set(t,e){return super.set(t,e),this.sync(),this}delete(t){const e=super.delete(t);return this.sync(),e}}class gn extends yn{constructor(t="bgio"){super();const e=e=>new mn(`${t}_${e}`);this.state=e("state"),this.initial=e("initial"),this.metadata=e("metadata"),this.log=e("log")}}class vn extends class{constructor(t,e,r,n){this.game=le(t),this.storageAPI=e,this.transportAPI=r,this.subscribeCallback=()=>{},this.auth=n}subscribe(t){this.subscribeCallback=t}async onUpdate(t,e,r,n){if(!t||!t.payload)return{error:"missing action or action payload"};let s;if(We(this.storageAPI)?({metadata:s}=this.storageAPI.fetch(r,{metadata:!0})):({metadata:s}=await this.storageAPI.fetch(r,{metadata:!0})),this.auth){if(!(await this.auth.authenticateCredentials({playerID:n,credentials:t.payload.credentials,metadata:s})))return{error:"unauthorized action"}}const i=(t=>{const{credentials:e,...r}=t.payload;return{...t,payload:r}})(t),o=r;let a;if(We(this.storageAPI)?({state:a}=this.storageAPI.fetch(o,{state:!0})):({state:a}=await this.storageAPI.fetch(o,{state:!0})),void 0===a)return Wt(`game not found, matchID=[${o}]`),{error:"game not found"};if(void 0!==a.ctx.gameover)return void Wt(`game over - matchID=[${o}] - playerID=[${n}] - action[${i.payload.type}]`);const c=d(Pe({game:this.game}),a,m(Ee));if(i.type==St||i.type==_t){const t=null!==a.ctx.activePlayers,e=a.ctx.currentPlayer===n;if(!t&&!e||t&&(void 0===a.ctx.activePlayers[n]||Object.keys(a.ctx.activePlayers).length>1))return void Wt(`playerID=[${n}] cannot undo / redo right now`)}if(!this.game.flow.isPlayerActive(a.G,a.ctx,n))return void Wt(`player not active - playerID=[${n}] - action[${i.payload.type}]`);const u=i.type==Et?this.game.flow.getMove(a.ctx,i.payload.type,n):null;if(i.type==Et&&!u)return void Wt(`move not processed - canPlayerMakeMove=false - playerID=[${n}] - action[${i.payload.type}]`);if(a._stateID!==e&&!(u&&pe(u)&&u.ignoreStaleStateID))return void Wt(`invalid stateID, was=[${e}], expected=[${a._stateID}] - playerID=[${n}] - action[${i.payload.type}]`);const h=c.getState();c.dispatch(i),a=c.getState(),this.subscribeCallback({state:a,action:i,matchID:r}),this.game.deltaState?this.transportAPI.sendAll({type:"patch",args:[r,e,h,a]}):this.transportAPI.sendAll({type:"update",args:[r,a]});const{deltalog:l,...p}=a;let f;if(!s||void 0!==s.gameover&&null!==s.gameover||(f={...s,updatedAt:Date.now()},void 0!==a.ctx.gameover&&(f.gameover=a.ctx.gameover)),We(this.storageAPI))this.storageAPI.setState(o,p,l),f&&this.storageAPI.setMetadata(o,f);else{const t=[this.storageAPI.setState(o,p,l)];f&&t.push(this.storageAPI.setMetadata(o,f)),await Promise.all(t)}}async onSync(t,e,r,n=2){const s=t,i={state:!0,metadata:!0,log:!0,initialState:!0},o=We(this.storageAPI)?this.storageAPI.fetch(s,i):await this.storageAPI.fetch(s,i);let{state:a,initialState:c,log:u,metadata:h}=o;if(this.auth&&void 0!==e&&null!==e){if(!(await this.auth.authenticateCredentials({playerID:e,credentials:r,metadata:h})))return{error:"unauthorized"}}if(void 0===a){const e=Ze({game:this.game,unlisted:!0,numPlayers:n,setupData:void 0});if("setupDataError"in e)return{error:"game requires setupData"};c=a=e.initialState,h=e.metadata,this.subscribeCallback({state:a,matchID:t}),We(this.storageAPI)?this.storageAPI.createMatch(s,{initialState:c,metadata:h}):await this.storageAPI.createMatch(s,{initialState:c,metadata:h})}const l={state:a,log:u,filteredMetadata:h?Xe(h):void 0,initialState:c};this.transportAPI.send({playerID:e,type:"sync",args:[t,l]})}async onConnectionChange(t,e,r,n){const s=t;if(void 0===e||null===e)return;let i;if(We(this.storageAPI)?({metadata:i}=this.storageAPI.fetch(s,{metadata:!0})):({metadata:i}=await this.storageAPI.fetch(s,{metadata:!0})),void 0===i)return Wt(`metadata not found for matchID=[${s}]`),{error:"metadata not found"};if(void 0===i.players[e])return Wt(`Player not in the match, matchID=[${s}] playerID=[${e}]`),{error:"player not in the match"};if(this.auth){if(!(await this.auth.authenticateCredentials({playerID:e,credentials:r,metadata:i})))return{error:"unauthorized"}}i.players[e].isConnected=n;const o=Xe(i);this.transportAPI.sendAll({type:"matchData",args:[t,o]}),We(this.storageAPI)?this.storageAPI.setMetadata(s,i):await this.storageAPI.setMetadata(s,i)}async onChatMessage(t,e,r){const n=t;if(this.auth){const{metadata:t}=await this.storageAPI.fetch(n,{metadata:!0});if(!e||"string"!==typeof e.sender)return{error:"unauthorized"};if(!(await this.auth.authenticateCredentials({playerID:e.sender,credentials:r,metadata:t})))return{error:"unauthorized"}}this.transportAPI.sendAll({type:"chat",args:[t,e]})}}{constructor({game:t,bots:e,storageKey:r,persist:n}){const i={},o={};if(t&&t.ai&&e)for(const s in e){const r=e[s];o[s]=new r({game:t,enumerate:t.ai.enumerate,seed:t.seed})}const a=({playerID:t,...e})=>{const r=i[t];void 0!==r&&r(c(t,e))},c=(t=>(e,r)=>{switch(r.type){case"patch":{const[n,i,o,a]=r.args,c=tr(a.deltalog,e),u=Qe(t,e,a),h=a._stateID,l=Qe(t,e,o);return{type:"patch",args:[n,i,h,(0,s.rh)(l,u),c]}}case"update":{const[n,s]=r.args,i=tr(s.deltalog,e);return{type:"update",args:[n,Qe(t,e,s),i]}}case"sync":{const[n,s]=r.args,i=Qe(t,e,s.state),o=tr(s.log,e);return{type:"sync",args:[n,{...s,state:i,log:o}]}}default:return r}})(t),u={send:a,sendAll:t=>{for(const e in i)a({playerID:e,...t})}};super(t,n?new gn(r):new yn,u),this.connect=(t,e)=>{i[t]=e},this.subscribe((({state:t,matchID:r})=>{if(!e)return;const n=function(t,e){if(void 0!==t.ctx.gameover)return null;if(t.ctx.activePlayers){for(const r of Object.keys(e))if(r in t.ctx.activePlayers)return r}else if(t.ctx.currentPlayer in e)return t.ctx.currentPlayer;return null}(t,o);null!==n&&setTimeout((async()=>{const e=await o[n].play(t,n);await this.onUpdate(e.action,t._stateID,r,e.action.payload.playerID)}),100)}))}}class bn extends Ie{constructor({master:t,...e}){super(e),this.master=t}sendChatMessage(t,e){const r=[t,e,this.credentials];this.master.onChatMessage(...r)}sendAction(t,e){this.master.onUpdate(e,t._stateID,this.matchID,this.playerID)}requestSync(){this.master.onSync(this.matchID,this.playerID,this.credentials,this.numPlayers)}connect(){this.setConnectionStatus(!0),this.master.connect(this.playerID,(t=>this.notifyClient(t))),this.requestSync()}disconnect(){this.setConnectionStatus(!1)}updateMatchID(t){this.matchID=t,this.connect()}updatePlayerID(t){this.playerID=t,this.connect()}updateCredentials(t){this.credentials=t,this.connect()}}const wn=new Map;const En=dn;class Pn extends Ie{constructor({socket:t,socketOpts:e,server:r,...n}){super(n),this.server=r,this.socket=t,this.socketOpts=e}sendAction(t,e){const r=[e,t._stateID,this.matchID,this.playerID];this.socket.emit("update",...r)}sendChatMessage(t,e){const r=[t,e,this.credentials];this.socket.emit("chat",...r)}connect(){if(!this.socket)if(this.server){let t=this.server;-1==t.search(/^https?:\/\//)&&(t="http://"+this.server),"/"!=t.slice(-1)&&(t+="/"),this.socket=En(t+this.gameName,this.socketOpts)}else this.socket=En("/"+this.gameName,this.socketOpts);this.socket.on("patch",((t,e,r,n,s)=>{this.notifyClient({type:"patch",args:[t,e,r,n,s]})})),this.socket.on("update",((t,e,r)=>{this.notifyClient({type:"update",args:[t,e,r]})})),this.socket.on("sync",((t,e)=>{this.notifyClient({type:"sync",args:[t,e]})})),this.socket.on("matchData",((t,e)=>{this.notifyClient({type:"matchData",args:[t,e]})})),this.socket.on("chat",((t,e)=>{this.notifyClient({type:"chat",args:[t,e]})})),this.socket.on("connect",(()=>{this.requestSync(),this.setConnectionStatus(!0)})),this.socket.on("disconnect",(()=>{this.setConnectionStatus(!1)}))}disconnect(){this.socket.close(),this.socket=null,this.setConnectionStatus(!1)}requestSync(){if(this.socket){const t=[this.matchID,this.playerID,this.credentials,this.numPlayers];this.socket.emit("sync",...t)}}updateMatchID(t){this.matchID=t,this.requestSync()}updatePlayerID(t){this.playerID=t,this.requestSync()}updateCredentials(t){this.credentials=t,this.requestSync()}}function _n({server:t,socketOpts:e}={}){return r=>new Pn({server:t,socketOpts:e,...r})}function In(t){var e;const{game:r,numPlayers:n,board:s,multiplayer:i,enhancer:o}=t;let{loading:a,debug:c}=t;if(void 0===a){a=()=>Je.createElement("div",{className:"bgio-loading"},"connecting...")}return e=class extends Je.Component{constructor(t){super(t),void 0===c&&(c=t.debug),this.client=function(t){return new Ce(t)}({game:r,debug:c,numPlayers:n,multiplayer:i,matchID:t.matchID,playerID:t.playerID,credentials:t.credentials,enhancer:o})}componentDidMount(){this.unsubscribe=this.client.subscribe((()=>this.forceUpdate())),this.client.start()}componentWillUnmount(){this.client.stop(),this.unsubscribe()}componentDidUpdate(t){this.props.matchID!=t.matchID&&this.client.updateMatchID(this.props.matchID),this.props.playerID!=t.playerID&&this.client.updatePlayerID(this.props.playerID),this.props.credentials!=t.credentials&&this.client.updateCredentials(this.props.credentials)}render(){const t=this.client.getState();if(null===t)return Je.createElement(a);let e=null;return s&&(e=Je.createElement(s,{...t,...this.props,isMultiplayer:!!i,moves:this.client.moves,events:this.client.events,matchID:this.client.matchID,playerID:this.client.playerID,reset:this.client.reset,undo:this.client.undo,redo:this.client.redo,log:this.client.log,matchData:this.client.matchData,sendChatMessage:this.client.sendChatMessage,chatMessages:this.client.chatMessages})),Je.createElement("div",{className:"bgio-client"},e)}},e.propTypes={matchID:He().string,playerID:He().string,credentials:He().string,debug:He().any},e.defaultProps={matchID:"default",playerID:null,credentials:null,debug:!0},e}class On{constructor({server:t,gameComponents:e,playerName:r,playerCredentials:n}){this.client=new Ve({server:t}),this.gameComponents=e,this.playerName=r||"Visitor",this.playerCredentials=n,this.matches=[]}async refresh(){try{this.matches=[];const t=await this.client.listGames();for(const e of t){if(!this._getGameComponents(e))continue;const{matches:t}=await this.client.listMatches(e);this.matches.push(...t)}}catch(Wt){throw new Error("failed to retrieve list of matches ("+Wt+")")}}_getMatchInstance(t){for(const e of this.matches)if(e.matchID===t)return e}_getGameComponents(t){for(const e of this.gameComponents)if(e.game.name===t)return e}_findPlayer(t){for(const e of this.matches)if(e.players.some((e=>e.name===t)))return e}async join(t,e,r){try{let n=this._findPlayer(this.playerName);if(n)throw new Error("player has already joined "+n.matchID);if(n=this._getMatchInstance(e),!n)throw new Error("game instance "+e+" not found");const s=await this.client.joinMatch(t,e,{playerID:r,playerName:this.playerName});n.players[Number.parseInt(r)].name=this.playerName,this.playerCredentials=s.playerCredentials}catch(Wt){throw new Error("failed to join match "+e+" ("+Wt+")")}}async leave(t,e){try{const r=this._getMatchInstance(e);if(!r)throw new Error("match instance not found");for(const n of r.players)if(n.name===this.playerName)return await this.client.leaveMatch(t,e,{playerID:n.id.toString(),credentials:this.playerCredentials}),delete n.name,void delete this.playerCredentials;throw new Error("player not found in match")}catch(Wt){throw new Error("failed to leave match "+e+" ("+Wt+")")}}async disconnect(){const t=this._findPlayer(this.playerName);t&&await this.leave(t.gameName,t.matchID),this.matches=[],this.playerName="Visitor"}async create(t,e){try{const r=this._getGameComponents(t);if(!r)throw new Error("game not found");if(e<r.game.minPlayers||e>r.game.maxPlayers)throw new Error("invalid number of players "+e);await this.client.createMatch(t,{numPlayers:e})}catch(Wt){throw new Error("failed to create match for "+t+" ("+Wt+")")}}}class Sn extends Je.Component{constructor(){super(...arguments),this.state={playerName:this.props.playerName,nameErrorMsg:""},this.onClickEnter=()=>{""!==this.state.playerName&&this.props.onEnter(this.state.playerName)},this.onKeyPress=t=>{"Enter"===t.key&&this.onClickEnter()},this.onChangePlayerName=t=>{const e=t.target.value.trim();this.setState({playerName:e,nameErrorMsg:e.length>0?"":"empty player name"})}}render(){return Je.createElement("div",null,Je.createElement("p",{className:"phase-title"},"Choose a player name:"),Je.createElement("input",{type:"text",value:this.state.playerName,onChange:this.onChangePlayerName,onKeyPress:this.onKeyPress}),Je.createElement("span",{className:"buttons"},Je.createElement("button",{className:"buttons",onClick:this.onClickEnter},"Enter")),Je.createElement("br",null),Je.createElement("span",{className:"error-msg"},this.state.nameErrorMsg,Je.createElement("br",null)))}}Sn.defaultProps={playerName:""};class xn extends Je.Component{constructor(){super(...arguments),this._createSeat=t=>t.name||"[free]",this._createButtonJoin=(t,e)=>Je.createElement("button",{key:"button-join-"+t.matchID,onClick:()=>this.props.onClickJoin(t.gameName,t.matchID,""+e)},"Join"),this._createButtonLeave=t=>Je.createElement("button",{key:"button-leave-"+t.matchID,onClick:()=>this.props.onClickLeave(t.gameName,t.matchID)},"Leave"),this._createButtonPlay=(t,e)=>Je.createElement("button",{key:"button-play-"+t.matchID,onClick:()=>this.props.onClickPlay(t.gameName,{matchID:t.matchID,playerID:""+e,numPlayers:t.players.length})},"Play"),this._createButtonSpectate=t=>Je.createElement("button",{key:"button-spectate-"+t.matchID,onClick:()=>this.props.onClickPlay(t.gameName,{matchID:t.matchID,numPlayers:t.players.length})},"Spectate"),this._createInstanceButtons=t=>{const e=t.players.find((t=>t.name===this.props.playerName)),r=t.players.find((t=>!t.name));return e&&r?this._createButtonLeave(t):r?this._createButtonJoin(t,r.id):e?Je.createElement("div",null,[this._createButtonPlay(t,e.id),this._createButtonLeave(t)]):this._createButtonSpectate(t)}}render(){const t=this.props.match;let e="OPEN";return t.players.some((t=>!t.name))||(e="RUNNING"),Je.createElement("tr",{key:"line-"+t.matchID},Je.createElement("td",{key:"cell-name-"+t.matchID},t.gameName),Je.createElement("td",{key:"cell-status-"+t.matchID},e),Je.createElement("td",{key:"cell-seats-"+t.matchID},t.players.map((t=>this._createSeat(t))).join(", ")),Je.createElement("td",{key:"cell-buttons-"+t.matchID},this._createInstanceButtons(t)))}}class An extends Je.Component{constructor(t){super(t),this.state={selectedGame:0,numPlayers:2},this._createGameNameOption=(t,e)=>Je.createElement("option",{key:"name-option-"+e,value:e},t.game.name),this._createNumPlayersOption=t=>Je.createElement("option",{key:"num-option-"+t,value:t},t),this._createNumPlayersRange=t=>Array.from({length:t.maxPlayers+1}).map(((t,e)=>e)).slice(t.minPlayers),this.onChangeNumPlayers=t=>{this.setState({numPlayers:Number.parseInt(t.target.value)})},this.onChangeSelectedGame=t=>{const e=Number.parseInt(t.target.value);this.setState({selectedGame:e,numPlayers:this.props.games[e].game.minPlayers})},this.onClickCreate=()=>{this.props.createMatch(this.props.games[this.state.selectedGame].game.name,this.state.numPlayers)};for(const e of t.games){const t=e.game;t.minPlayers||(t.minPlayers=1),t.maxPlayers||(t.maxPlayers=4),console.assert(t.maxPlayers>=t.minPlayers)}this.state={selectedGame:0,numPlayers:t.games[0].game.minPlayers}}render(){return Je.createElement("div",null,Je.createElement("select",{value:this.state.selectedGame,onChange:t=>this.onChangeSelectedGame(t)},this.props.games.map(((t,e)=>this._createGameNameOption(t,e)))),Je.createElement("span",null,"Players:"),Je.createElement("select",{value:this.state.numPlayers,onChange:this.onChangeNumPlayers},this._createNumPlayersRange(this.props.games[this.state.selectedGame].game).map((t=>this._createNumPlayersOption(t)))),Je.createElement("span",{className:"buttons"},Je.createElement("button",{onClick:this.onClickCreate},"Create")))}}var kn;!function(t){t.ENTER="enter",t.PLAY="play",t.LIST="list"}(kn||(kn={}));class Dn extends Je.Component{constructor(t){super(t),this.state={phase:kn.ENTER,playerName:"Visitor",runningMatch:null,errorMsg:"",credentialStore:{}},this._createConnection=t=>{const e=this.state.playerName;var r;this.connection=(r={server:t.lobbyServer,gameComponents:t.gameComponents,playerName:e,playerCredentials:this.state.credentialStore[e]},new On(r))},this._updateCredentials=(t,e)=>{this.setState((r=>{const n=Object.assign({},r.credentialStore);return n[t]=e,{credentialStore:n}}))},this._updateConnection=async()=>{await this.connection.refresh(),this.forceUpdate()},this._enterLobby=t=>{this._startRefreshInterval(),this.setState({playerName:t,phase:kn.LIST})},this._exitLobby=async()=>{this._clearRefreshInterval(),await this.connection.disconnect(),this.setState({phase:kn.ENTER,errorMsg:""})},this._createMatch=async(t,e)=>{try{await this.connection.create(t,e),await this.connection.refresh(),this.setState({})}catch(Wt){this.setState({errorMsg:Wt.message})}},this._joinMatch=async(t,e,r)=>{try{await this.connection.join(t,e,r),await this.connection.refresh(),this._updateCredentials(this.connection.playerName,this.connection.playerCredentials)}catch(Wt){this.setState({errorMsg:Wt.message})}},this._leaveMatch=async(t,e)=>{try{await this.connection.leave(t,e),await this.connection.refresh(),this._updateCredentials(this.connection.playerName,this.connection.playerCredentials)}catch(Wt){this.setState({errorMsg:Wt.message})}},this._startMatch=(t,e)=>{const r=this.connection._getGameComponents(t);if(!r)return void this.setState({errorMsg:"game "+t+" not supported"});let n;if(e.numPlayers>1&&(n=this.props.gameServer?_n({server:this.props.gameServer}):_n()),1==e.numPlayers){const t=r.game.maxPlayers,e={};for(let r=1;r<t;r++)e[r+""]=Le;n=function({bots:t,persist:e,storageKey:r}={}){return n=>{const{gameKey:s,game:i}=n;let o;const a=wn.get(s);return a&&a.bots===t&&a.storageKey===r&&a.persist===e&&(o=a.master),o||(o=new vn({game:i,bots:t,persist:e,storageKey:r}),wn.set(s,{master:o,bots:t,persist:e,storageKey:r})),new bn({master:o,...n})}}({bots:e})}const s={app:this.props.clientFactory({game:r.game,board:r.board,debug:this.props.debug,multiplayer:n}),matchID:e.matchID,playerID:e.numPlayers>1?e.playerID:"0",credentials:this.connection.playerCredentials};this._clearRefreshInterval(),this.setState({phase:kn.PLAY,runningMatch:s})},this._exitMatch=()=>{this._startRefreshInterval(),this.setState({phase:kn.LIST,runningMatch:null})},this._getPhaseVisibility=t=>this.state.phase!==t?"hidden":"phase",this.renderMatches=(t,e)=>t.map((t=>{const{matchID:r,gameName:n,players:s}=t;return Je.createElement(xn,{key:"instance-"+r,match:{matchID:r,gameName:n,players:Object.values(s)},playerName:e,onClickJoin:this._joinMatch,onClickLeave:this._leaveMatch,onClickPlay:this._startMatch})})),this._createConnection(this.props)}componentDidMount(){const t=Ye.ZP.load("lobbyState")||{};t.phase&&t.phase===kn.PLAY&&(t.phase=kn.LIST),t.phase&&t.phase!==kn.ENTER&&this._startRefreshInterval(),this.setState({phase:t.phase||kn.ENTER,playerName:t.playerName||"Visitor",credentialStore:t.credentialStore||{}})}componentDidUpdate(t,e){const r=this.state.playerName,n=this.state.credentialStore[r];if(e.phase!==this.state.phase||e.credentialStore[r]!==n||e.playerName!==r){this._createConnection(this.props),this._updateConnection();const t={phase:this.state.phase,playerName:r,credentialStore:this.state.credentialStore};Ye.ZP.save("lobbyState",t,{path:"/"})}t.refreshInterval!==this.props.refreshInterval&&this._startRefreshInterval()}componentWillUnmount(){this._clearRefreshInterval()}_startRefreshInterval(){this._clearRefreshInterval(),this._currentInterval=setInterval(this._updateConnection,this.props.refreshInterval)}_clearRefreshInterval(){clearInterval(this._currentInterval)}render(){const{gameComponents:t,renderer:e}=this.props,{errorMsg:r,playerName:n,phase:s,runningMatch:i}=this.state;return e?e({errorMsg:r,gameComponents:t,matches:this.connection.matches,phase:s,playerName:n,runningMatch:i,handleEnterLobby:this._enterLobby,handleExitLobby:this._exitLobby,handleCreateMatch:this._createMatch,handleJoinMatch:this._joinMatch,handleLeaveMatch:this._leaveMatch,handleExitMatch:this._exitMatch,handleRefreshMatches:this._updateConnection,handleStartMatch:this._startMatch}):Je.createElement("div",{id:"lobby-view",style:{padding:50}},Je.createElement("div",{className:this._getPhaseVisibility(kn.ENTER)},Je.createElement(Sn,{key:n,playerName:n,onEnter:this._enterLobby})),Je.createElement("div",{className:this._getPhaseVisibility(kn.LIST)},Je.createElement("p",null,"Welcome, ",n),Je.createElement("div",{className:"phase-title",id:"match-creation"},Je.createElement("span",null,"Create a match:"),Je.createElement(An,{games:t,createMatch:this._createMatch})),Je.createElement("p",{className:"phase-title"},"Join a match:"),Je.createElement("div",{id:"instances"},Je.createElement("table",null,Je.createElement("tbody",null,this.renderMatches(this.connection.matches,n))),Je.createElement("span",{className:"error-msg"},r,Je.createElement("br",null))),Je.createElement("p",{className:"phase-title"},"Matches that become empty are automatically deleted.")),Je.createElement("div",{className:this._getPhaseVisibility(kn.PLAY)},i&&Je.createElement(i.app,{matchID:i.matchID,playerID:i.playerID,credentials:i.credentials}),Je.createElement("div",{className:"buttons",id:"match-exit"},Je.createElement("button",{onClick:this._exitMatch},"Exit match"))),Je.createElement("div",{className:"buttons",id:"lobby-exit"},Je.createElement("button",{onClick:this._exitLobby},"Exit lobby")))}}Dn.propTypes={gameComponents:He().array.isRequired,lobbyServer:He().string,gameServer:He().string,debug:He().bool,clientFactory:He().func,refreshInterval:He().number},Dn.defaultProps={debug:!1,clientFactory:In,refreshInterval:2e3}},4275:function(t,e){"use strict";e.E=function(){var t=[],e=t;function r(){e===t&&(e=t.slice())}return{listen:function(t){if("function"!==typeof t)throw new Error("Expected listener to be a function.");var n=!0;return r(),e.push(t),function(){if(n){n=!1,r();var s=e.indexOf(t);e.splice(s,1)}}},emit:function(){for(var r=t=e,n=0;n<r.length;n++)r[n].apply(r,arguments)}}}},4366:function(t){"use strict";var e=Object.prototype.hasOwnProperty;function r(t,e){return t===e?0!==t||0!==e||1/t===1/e:t!==t&&e!==e}t.exports=function(t,n){if(r(t,n))return!0;if("object"!==typeof t||null===t||"object"!==typeof n||null===n)return!1;var s=Object.keys(t),i=Object.keys(n);if(s.length!==i.length)return!1;for(var o=0;o<s.length;o++)if(!e.call(n,s[o])||!r(t[s[o]],n[s[o]]))return!1;return!0}},3261:function(t){var e,r,n=Function.prototype,s=Object.prototype,i=n.toString,o=s.hasOwnProperty,a=i.call(Object),c=s.toString,u=(e=Object.getPrototypeOf,r=Object,function(t){return e(r(t))});t.exports=function(t){if(!function(t){return!!t&&"object"==typeof t}(t)||"[object Object]"!=c.call(t)||function(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(r){}return e}(t))return!1;var e=u(t);if(null===e)return!0;var r=o.call(e,"constructor")&&e.constructor;return"function"==typeof r&&r instanceof r&&i.call(r)==a}},6493:function(t){"use strict";var e=Object.assign.bind(Object);t.exports=e,t.exports.default=t.exports},4284:function(t,e,r){"use strict";var n,s;t.exports=(null==(n=r.g.process)?void 0:n.env)&&"object"===typeof(null==(s=r.g.process)?void 0:s.env)?r.g.process:r(6118)},2241:function(t){!function(){var e={449:function(t,e){"use strict";e.byteLength=function(t){var e=c(t),r=e[0],n=e[1];return 3*(r+n)/4-n},e.toByteArray=function(t){var e,r,i=c(t),o=i[0],a=i[1],u=new s(function(t,e,r){return 3*(e+r)/4-r}(0,o,a)),h=0,l=a>0?o-4:o;for(r=0;r<l;r+=4)e=n[t.charCodeAt(r)]<<18|n[t.charCodeAt(r+1)]<<12|n[t.charCodeAt(r+2)]<<6|n[t.charCodeAt(r+3)],u[h++]=e>>16&255,u[h++]=e>>8&255,u[h++]=255&e;2===a&&(e=n[t.charCodeAt(r)]<<2|n[t.charCodeAt(r+1)]>>4,u[h++]=255&e);1===a&&(e=n[t.charCodeAt(r)]<<10|n[t.charCodeAt(r+1)]<<4|n[t.charCodeAt(r+2)]>>2,u[h++]=e>>8&255,u[h++]=255&e);return u},e.fromByteArray=function(t){for(var e,n=t.length,s=n%3,i=[],o=16383,a=0,c=n-s;a<c;a+=o)i.push(h(t,a,a+o>c?c:a+o));1===s?(e=t[n-1],i.push(r[e>>2]+r[e<<4&63]+"==")):2===s&&(e=(t[n-2]<<8)+t[n-1],i.push(r[e>>10]+r[e>>4&63]+r[e<<2&63]+"="));return i.join("")};for(var r=[],n=[],s="undefined"!==typeof Uint8Array?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,a=i.length;o<a;++o)r[o]=i[o],n[i.charCodeAt(o)]=o;function c(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");return-1===r&&(r=e),[r,r===e?0:4-r%4]}function u(t){return r[t>>18&63]+r[t>>12&63]+r[t>>6&63]+r[63&t]}function h(t,e,r){for(var n,s=[],i=e;i<r;i+=3)n=(t[i]<<16&16711680)+(t[i+1]<<8&65280)+(255&t[i+2]),s.push(u(n));return s.join("")}n["-".charCodeAt(0)]=62,n["_".charCodeAt(0)]=63},877:function(t,e,r){"use strict";var n=r(449),s=r(543),i="function"===typeof Symbol&&"function"===typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=c,e.SlowBuffer=function(t){+t!=t&&(t=0);return c.alloc(+t)},e.INSPECT_MAX_BYTES=50;var o=2147483647;function a(t){if(t>o)throw new RangeError('The value "'+t+'" is invalid for option "size"');var e=new Uint8Array(t);return Object.setPrototypeOf(e,c.prototype),e}function c(t,e,r){if("number"===typeof t){if("string"===typeof e)throw new TypeError('The "string" argument must be of type string. Received type number');return l(t)}return u(t,e,r)}function u(t,e,r){if("string"===typeof t)return function(t,e){"string"===typeof e&&""!==e||(e="utf8");if(!c.isEncoding(e))throw new TypeError("Unknown encoding: "+e);var r=0|y(t,e),n=a(r),s=n.write(t,e);s!==r&&(n=n.slice(0,s));return n}(t,e);if(ArrayBuffer.isView(t))return p(t);if(null==t)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(F(t,ArrayBuffer)||t&&F(t.buffer,ArrayBuffer))return f(t,e,r);if("undefined"!==typeof SharedArrayBuffer&&(F(t,SharedArrayBuffer)||t&&F(t.buffer,SharedArrayBuffer)))return f(t,e,r);if("number"===typeof t)throw new TypeError('The "value" argument must not be of type number. Received type number');var n=t.valueOf&&t.valueOf();if(null!=n&&n!==t)return c.from(n,e,r);var s=function(t){if(c.isBuffer(t)){var e=0|d(t.length),r=a(e);return 0===r.length||t.copy(r,0,0,e),r}if(void 0!==t.length)return"number"!==typeof t.length||q(t.length)?a(0):p(t);if("Buffer"===t.type&&Array.isArray(t.data))return p(t.data)}(t);if(s)return s;if("undefined"!==typeof Symbol&&null!=Symbol.toPrimitive&&"function"===typeof t[Symbol.toPrimitive])return c.from(t[Symbol.toPrimitive]("string"),e,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function h(t){if("number"!==typeof t)throw new TypeError('"size" argument must be of type number');if(t<0)throw new RangeError('The value "'+t+'" is invalid for option "size"')}function l(t){return h(t),a(t<0?0:0|d(t))}function p(t){for(var e=t.length<0?0:0|d(t.length),r=a(e),n=0;n<e;n+=1)r[n]=255&t[n];return r}function f(t,e,r){if(e<0||t.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(r||0))throw new RangeError('"length" is outside of buffer bounds');var n;return n=void 0===e&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,e):new Uint8Array(t,e,r),Object.setPrototypeOf(n,c.prototype),n}function d(t){if(t>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return 0|t}function y(t,e){if(c.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||F(t,ArrayBuffer))return t.byteLength;if("string"!==typeof t)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);var r=t.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;for(var s=!1;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return U(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return G(t).length;default:if(s)return n?-1:U(t).length;e=(""+e).toLowerCase(),s=!0}}function m(t,e,r){var n=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return N(this,e,r);case"utf8":case"utf-8":return x(this,e,r);case"ascii":return k(this,e,r);case"latin1":case"binary":return D(this,e,r);case"base64":return S(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return M(this,e,r);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}function g(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function v(t,e,r,n,s){if(0===t.length)return-1;if("string"===typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),q(r=+r)&&(r=s?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(s)return-1;r=t.length-1}else if(r<0){if(!s)return-1;r=0}if("string"===typeof e&&(e=c.from(e,n)),c.isBuffer(e))return 0===e.length?-1:b(t,e,r,n,s);if("number"===typeof e)return e&=255,"function"===typeof Uint8Array.prototype.indexOf?s?Uint8Array.prototype.indexOf.call(t,e,r):Uint8Array.prototype.lastIndexOf.call(t,e,r):b(t,[e],r,n,s);throw new TypeError("val must be string, number or Buffer")}function b(t,e,r,n,s){var i,o=1,a=t.length,c=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return-1;o=2,a/=2,c/=2,r/=2}function u(t,e){return 1===o?t[e]:t.readUInt16BE(e*o)}if(s){var h=-1;for(i=r;i<a;i++)if(u(t,i)===u(e,-1===h?0:i-h)){if(-1===h&&(h=i),i-h+1===c)return h*o}else-1!==h&&(i-=i-h),h=-1}else for(r+c>a&&(r=a-c),i=r;i>=0;i--){for(var l=!0,p=0;p<c;p++)if(u(t,i+p)!==u(e,p)){l=!1;break}if(l)return i}return-1}function w(t,e,r,n){r=Number(r)||0;var s=t.length-r;n?(n=Number(n))>s&&(n=s):n=s;var i=e.length;n>i/2&&(n=i/2);for(var o=0;o<n;++o){var a=parseInt(e.substr(2*o,2),16);if(q(a))return o;t[r+o]=a}return o}function E(t,e,r,n){return $(U(e,t.length-r),t,r,n)}function P(t,e,r,n){return $(function(t){for(var e=[],r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}(e),t,r,n)}function _(t,e,r,n){return P(t,e,r,n)}function I(t,e,r,n){return $(G(e),t,r,n)}function O(t,e,r,n){return $(function(t,e){for(var r,n,s,i=[],o=0;o<t.length&&!((e-=2)<0);++o)n=(r=t.charCodeAt(o))>>8,s=r%256,i.push(s),i.push(n);return i}(e,t.length-r),t,r,n)}function S(t,e,r){return 0===e&&r===t.length?n.fromByteArray(t):n.fromByteArray(t.slice(e,r))}function x(t,e,r){r=Math.min(t.length,r);for(var n=[],s=e;s<r;){var i,o,a,c,u=t[s],h=null,l=u>239?4:u>223?3:u>191?2:1;if(s+l<=r)switch(l){case 1:u<128&&(h=u);break;case 2:128===(192&(i=t[s+1]))&&(c=(31&u)<<6|63&i)>127&&(h=c);break;case 3:i=t[s+1],o=t[s+2],128===(192&i)&&128===(192&o)&&(c=(15&u)<<12|(63&i)<<6|63&o)>2047&&(c<55296||c>57343)&&(h=c);break;case 4:i=t[s+1],o=t[s+2],a=t[s+3],128===(192&i)&&128===(192&o)&&128===(192&a)&&(c=(15&u)<<18|(63&i)<<12|(63&o)<<6|63&a)>65535&&c<1114112&&(h=c)}null===h?(h=65533,l=1):h>65535&&(h-=65536,n.push(h>>>10&1023|55296),h=56320|1023&h),n.push(h),s+=l}return A(n)}e.kMaxLength=o,c.TYPED_ARRAY_SUPPORT=function(){try{var t=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(t,e),42===t.foo()}catch(t){return!1}}(),c.TYPED_ARRAY_SUPPORT||"undefined"===typeof console||"function"!==typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(c.prototype,"parent",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.buffer}}),Object.defineProperty(c.prototype,"offset",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.byteOffset}}),c.poolSize=8192,c.from=function(t,e,r){return u(t,e,r)},Object.setPrototypeOf(c.prototype,Uint8Array.prototype),Object.setPrototypeOf(c,Uint8Array),c.alloc=function(t,e,r){return function(t,e,r){return h(t),t<=0?a(t):void 0!==e?"string"===typeof r?a(t).fill(e,r):a(t).fill(e):a(t)}(t,e,r)},c.allocUnsafe=function(t){return l(t)},c.allocUnsafeSlow=function(t){return l(t)},c.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==c.prototype},c.compare=function(t,e){if(F(t,Uint8Array)&&(t=c.from(t,t.offset,t.byteLength)),F(e,Uint8Array)&&(e=c.from(e,e.offset,e.byteLength)),!c.isBuffer(t)||!c.isBuffer(e))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===e)return 0;for(var r=t.length,n=e.length,s=0,i=Math.min(r,n);s<i;++s)if(t[s]!==e[s]){r=t[s],n=e[s];break}return r<n?-1:n<r?1:0},c.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(t,e){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return c.alloc(0);var r;if(void 0===e)for(e=0,r=0;r<t.length;++r)e+=t[r].length;var n=c.allocUnsafe(e),s=0;for(r=0;r<t.length;++r){var i=t[r];if(F(i,Uint8Array)&&(i=c.from(i)),!c.isBuffer(i))throw new TypeError('"list" argument must be an Array of Buffers');i.copy(n,s),s+=i.length}return n},c.byteLength=y,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var t=this.length;if(t%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)g(this,e,e+1);return this},c.prototype.swap32=function(){var t=this.length;if(t%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)g(this,e,e+3),g(this,e+1,e+2);return this},c.prototype.swap64=function(){var t=this.length;if(t%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)g(this,e,e+7),g(this,e+1,e+6),g(this,e+2,e+5),g(this,e+3,e+4);return this},c.prototype.toString=function(){var t=this.length;return 0===t?"":0===arguments.length?x(this,0,t):m.apply(this,arguments)},c.prototype.toLocaleString=c.prototype.toString,c.prototype.equals=function(t){if(!c.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===c.compare(this,t)},c.prototype.inspect=function(){var t="",r=e.INSPECT_MAX_BYTES;return t=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(t+=" ... "),"<Buffer "+t+">"},i&&(c.prototype[i]=c.prototype.inspect),c.prototype.compare=function(t,e,r,n,s){if(F(t,Uint8Array)&&(t=c.from(t,t.offset,t.byteLength)),!c.isBuffer(t))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(void 0===e&&(e=0),void 0===r&&(r=t?t.length:0),void 0===n&&(n=0),void 0===s&&(s=this.length),e<0||r>t.length||n<0||s>this.length)throw new RangeError("out of range index");if(n>=s&&e>=r)return 0;if(n>=s)return-1;if(e>=r)return 1;if(this===t)return 0;for(var i=(s>>>=0)-(n>>>=0),o=(r>>>=0)-(e>>>=0),a=Math.min(i,o),u=this.slice(n,s),h=t.slice(e,r),l=0;l<a;++l)if(u[l]!==h[l]){i=u[l],o=h[l];break}return i<o?-1:o<i?1:0},c.prototype.includes=function(t,e,r){return-1!==this.indexOf(t,e,r)},c.prototype.indexOf=function(t,e,r){return v(this,t,e,r,!0)},c.prototype.lastIndexOf=function(t,e,r){return v(this,t,e,r,!1)},c.prototype.write=function(t,e,r,n){if(void 0===e)n="utf8",r=this.length,e=0;else if(void 0===r&&"string"===typeof e)n=e,r=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var s=this.length-e;if((void 0===r||r>s)&&(r=s),t.length>0&&(r<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var i=!1;;)switch(n){case"hex":return w(this,t,e,r);case"utf8":case"utf-8":return E(this,t,e,r);case"ascii":return P(this,t,e,r);case"latin1":case"binary":return _(this,t,e,r);case"base64":return I(this,t,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return O(this,t,e,r);default:if(i)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),i=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function A(t){var e=t.length;if(e<=4096)return String.fromCharCode.apply(String,t);for(var r="",n=0;n<e;)r+=String.fromCharCode.apply(String,t.slice(n,n+=4096));return r}function k(t,e,r){var n="";r=Math.min(t.length,r);for(var s=e;s<r;++s)n+=String.fromCharCode(127&t[s]);return n}function D(t,e,r){var n="";r=Math.min(t.length,r);for(var s=e;s<r;++s)n+=String.fromCharCode(t[s]);return n}function N(t,e,r){var n=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>n)&&(r=n);for(var s="",i=e;i<r;++i)s+=V[t[i]];return s}function M(t,e,r){for(var n=t.slice(e,r),s="",i=0;i<n.length;i+=2)s+=String.fromCharCode(n[i]+256*n[i+1]);return s}function C(t,e,r){if(t%1!==0||t<0)throw new RangeError("offset is not uint");if(t+e>r)throw new RangeError("Trying to access beyond buffer length")}function T(t,e,r,n,s,i){if(!c.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>s||e<i)throw new RangeError('"value" argument is out of bounds');if(r+n>t.length)throw new RangeError("Index out of range")}function j(t,e,r,n,s,i){if(r+n>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function B(t,e,r,n,i){return e=+e,r>>>=0,i||j(t,0,r,4),s.write(t,e,r,n,23,4),r+4}function R(t,e,r,n,i){return e=+e,r>>>=0,i||j(t,0,r,8),s.write(t,e,r,n,52,8),r+8}c.prototype.slice=function(t,e){var r=this.length;(t=~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),(e=void 0===e?r:~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t);var n=this.subarray(t,e);return Object.setPrototypeOf(n,c.prototype),n},c.prototype.readUIntLE=function(t,e,r){t>>>=0,e>>>=0,r||C(t,e,this.length);for(var n=this[t],s=1,i=0;++i<e&&(s*=256);)n+=this[t+i]*s;return n},c.prototype.readUIntBE=function(t,e,r){t>>>=0,e>>>=0,r||C(t,e,this.length);for(var n=this[t+--e],s=1;e>0&&(s*=256);)n+=this[t+--e]*s;return n},c.prototype.readUInt8=function(t,e){return t>>>=0,e||C(t,1,this.length),this[t]},c.prototype.readUInt16LE=function(t,e){return t>>>=0,e||C(t,2,this.length),this[t]|this[t+1]<<8},c.prototype.readUInt16BE=function(t,e){return t>>>=0,e||C(t,2,this.length),this[t]<<8|this[t+1]},c.prototype.readUInt32LE=function(t,e){return t>>>=0,e||C(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},c.prototype.readUInt32BE=function(t,e){return t>>>=0,e||C(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},c.prototype.readIntLE=function(t,e,r){t>>>=0,e>>>=0,r||C(t,e,this.length);for(var n=this[t],s=1,i=0;++i<e&&(s*=256);)n+=this[t+i]*s;return n>=(s*=128)&&(n-=Math.pow(2,8*e)),n},c.prototype.readIntBE=function(t,e,r){t>>>=0,e>>>=0,r||C(t,e,this.length);for(var n=e,s=1,i=this[t+--n];n>0&&(s*=256);)i+=this[t+--n]*s;return i>=(s*=128)&&(i-=Math.pow(2,8*e)),i},c.prototype.readInt8=function(t,e){return t>>>=0,e||C(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},c.prototype.readInt16LE=function(t,e){t>>>=0,e||C(t,2,this.length);var r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},c.prototype.readInt16BE=function(t,e){t>>>=0,e||C(t,2,this.length);var r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},c.prototype.readInt32LE=function(t,e){return t>>>=0,e||C(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},c.prototype.readInt32BE=function(t,e){return t>>>=0,e||C(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},c.prototype.readFloatLE=function(t,e){return t>>>=0,e||C(t,4,this.length),s.read(this,t,!0,23,4)},c.prototype.readFloatBE=function(t,e){return t>>>=0,e||C(t,4,this.length),s.read(this,t,!1,23,4)},c.prototype.readDoubleLE=function(t,e){return t>>>=0,e||C(t,8,this.length),s.read(this,t,!0,52,8)},c.prototype.readDoubleBE=function(t,e){return t>>>=0,e||C(t,8,this.length),s.read(this,t,!1,52,8)},c.prototype.writeUIntLE=function(t,e,r,n){(t=+t,e>>>=0,r>>>=0,n)||T(this,t,e,r,Math.pow(2,8*r)-1,0);var s=1,i=0;for(this[e]=255&t;++i<r&&(s*=256);)this[e+i]=t/s&255;return e+r},c.prototype.writeUIntBE=function(t,e,r,n){(t=+t,e>>>=0,r>>>=0,n)||T(this,t,e,r,Math.pow(2,8*r)-1,0);var s=r-1,i=1;for(this[e+s]=255&t;--s>=0&&(i*=256);)this[e+s]=t/i&255;return e+r},c.prototype.writeUInt8=function(t,e,r){return t=+t,e>>>=0,r||T(this,t,e,1,255,0),this[e]=255&t,e+1},c.prototype.writeUInt16LE=function(t,e,r){return t=+t,e>>>=0,r||T(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},c.prototype.writeUInt16BE=function(t,e,r){return t=+t,e>>>=0,r||T(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},c.prototype.writeUInt32LE=function(t,e,r){return t=+t,e>>>=0,r||T(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},c.prototype.writeUInt32BE=function(t,e,r){return t=+t,e>>>=0,r||T(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},c.prototype.writeIntLE=function(t,e,r,n){if(t=+t,e>>>=0,!n){var s=Math.pow(2,8*r-1);T(this,t,e,r,s-1,-s)}var i=0,o=1,a=0;for(this[e]=255&t;++i<r&&(o*=256);)t<0&&0===a&&0!==this[e+i-1]&&(a=1),this[e+i]=(t/o>>0)-a&255;return e+r},c.prototype.writeIntBE=function(t,e,r,n){if(t=+t,e>>>=0,!n){var s=Math.pow(2,8*r-1);T(this,t,e,r,s-1,-s)}var i=r-1,o=1,a=0;for(this[e+i]=255&t;--i>=0&&(o*=256);)t<0&&0===a&&0!==this[e+i+1]&&(a=1),this[e+i]=(t/o>>0)-a&255;return e+r},c.prototype.writeInt8=function(t,e,r){return t=+t,e>>>=0,r||T(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},c.prototype.writeInt16LE=function(t,e,r){return t=+t,e>>>=0,r||T(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},c.prototype.writeInt16BE=function(t,e,r){return t=+t,e>>>=0,r||T(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},c.prototype.writeInt32LE=function(t,e,r){return t=+t,e>>>=0,r||T(this,t,e,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},c.prototype.writeInt32BE=function(t,e,r){return t=+t,e>>>=0,r||T(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},c.prototype.writeFloatLE=function(t,e,r){return B(this,t,e,!0,r)},c.prototype.writeFloatBE=function(t,e,r){return B(this,t,e,!1,r)},c.prototype.writeDoubleLE=function(t,e,r){return R(this,t,e,!0,r)},c.prototype.writeDoubleBE=function(t,e,r){return R(this,t,e,!1,r)},c.prototype.copy=function(t,e,r,n){if(!c.isBuffer(t))throw new TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),e>=t.length&&(e=t.length),e||(e=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-r&&(n=t.length-e+r);var s=n-r;if(this===t&&"function"===typeof Uint8Array.prototype.copyWithin)this.copyWithin(e,r,n);else if(this===t&&r<e&&e<n)for(var i=s-1;i>=0;--i)t[i+e]=this[i+r];else Uint8Array.prototype.set.call(t,this.subarray(r,n),e);return s},c.prototype.fill=function(t,e,r,n){if("string"===typeof t){if("string"===typeof e?(n=e,e=0,r=this.length):"string"===typeof r&&(n=r,r=this.length),void 0!==n&&"string"!==typeof n)throw new TypeError("encoding must be a string");if("string"===typeof n&&!c.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===t.length){var s=t.charCodeAt(0);("utf8"===n&&s<128||"latin1"===n)&&(t=s)}}else"number"===typeof t?t&=255:"boolean"===typeof t&&(t=Number(t));if(e<0||this.length<e||this.length<r)throw new RangeError("Out of range index");if(r<=e)return this;var i;if(e>>>=0,r=void 0===r?this.length:r>>>0,t||(t=0),"number"===typeof t)for(i=e;i<r;++i)this[i]=t;else{var o=c.isBuffer(t)?t:c.from(t,n),a=o.length;if(0===a)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(i=0;i<r-e;++i)this[i+e]=o[i%a]}return this};var L=/[^+/0-9A-Za-z-_]/g;function U(t,e){var r;e=e||1/0;for(var n=t.length,s=null,i=[],o=0;o<n;++o){if((r=t.charCodeAt(o))>55295&&r<57344){if(!s){if(r>56319){(e-=3)>-1&&i.push(239,191,189);continue}if(o+1===n){(e-=3)>-1&&i.push(239,191,189);continue}s=r;continue}if(r<56320){(e-=3)>-1&&i.push(239,191,189),s=r;continue}r=65536+(s-55296<<10|r-56320)}else s&&(e-=3)>-1&&i.push(239,191,189);if(s=null,r<128){if((e-=1)<0)break;i.push(r)}else if(r<2048){if((e-=2)<0)break;i.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;i.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;i.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return i}function G(t){return n.toByteArray(function(t){if((t=(t=t.split("=")[0]).trim().replace(L,"")).length<2)return"";for(;t.length%4!==0;)t+="=";return t}(t))}function $(t,e,r,n){for(var s=0;s<n&&!(s+r>=e.length||s>=t.length);++s)e[s+r]=t[s];return s}function F(t,e){return t instanceof e||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===e.name}function q(t){return t!==t}var V=function(){for(var t="0123456789abcdef",e=new Array(256),r=0;r<16;++r)for(var n=16*r,s=0;s<16;++s)e[n+s]=t[r]+t[s];return e}()},543:function(t,e){e.read=function(t,e,r,n,s){var i,o,a=8*s-n-1,c=(1<<a)-1,u=c>>1,h=-7,l=r?s-1:0,p=r?-1:1,f=t[e+l];for(l+=p,i=f&(1<<-h)-1,f>>=-h,h+=a;h>0;i=256*i+t[e+l],l+=p,h-=8);for(o=i&(1<<-h)-1,i>>=-h,h+=n;h>0;o=256*o+t[e+l],l+=p,h-=8);if(0===i)i=1-u;else{if(i===c)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,n),i-=u}return(f?-1:1)*o*Math.pow(2,i-n)},e.write=function(t,e,r,n,s,i){var o,a,c,u=8*i-s-1,h=(1<<u)-1,l=h>>1,p=23===s?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:i-1,d=n?1:-1,y=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=h):(o=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-o))<1&&(o--,c*=2),(e+=o+l>=1?p/c:p*Math.pow(2,1-l))*c>=2&&(o++,c/=2),o+l>=h?(a=0,o=h):o+l>=1?(a=(e*c-1)*Math.pow(2,s),o+=l):(a=e*Math.pow(2,l-1)*Math.pow(2,s),o=0));s>=8;t[r+f]=255&a,f+=d,a/=256,s-=8);for(o=o<<s|a,u+=s;u>0;t[r+f]=255&o,f+=d,o/=256,u-=8);t[r+f-d]|=128*y}}},r={};function n(t){var s=r[t];if(void 0!==s)return s.exports;var i=r[t]={exports:{}},o=!0;try{e[t](i,i.exports,n),o=!1}finally{o&&delete r[t]}return i.exports}n.ab="//";var s=n(877);t.exports=s}()},6118:function(t){!function(){var e={308:function(t){var e,r,n=t.exports={};function s(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function o(t){if(e===setTimeout)return setTimeout(t,0);if((e===s||!e)&&setTimeout)return e=setTimeout,setTimeout(t,0);try{return e(t,0)}catch(n){try{return e.call(null,t,0)}catch(n){return e.call(this,t,0)}}}!function(){try{e="function"===typeof setTimeout?setTimeout:s}catch(t){e=s}try{r="function"===typeof clearTimeout?clearTimeout:i}catch(t){r=i}}();var a,c=[],u=!1,h=-1;function l(){u&&a&&(u=!1,a.length?c=a.concat(c):h=-1,c.length&&p())}function p(){if(!u){var t=o(l);u=!0;for(var e=c.length;e;){for(a=c,c=[];++h<e;)a&&a[h].run();h=-1,e=c.length}a=null,u=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===i||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function f(t,e){this.fun=t,this.array=e}function d(){}n.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];c.push(new f(t,e)),1!==c.length||u||o(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=d,n.addListener=d,n.once=d,n.off=d,n.removeListener=d,n.removeAllListeners=d,n.emit=d,n.prependListener=d,n.prependOnceListener=d,n.listeners=function(t){return[]},n.binding=function(t){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(t){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}}},r={};function n(t){var s=r[t];if(void 0!==s)return s.exports;var i=r[t]={exports:{}},o=!0;try{e[t](i,i.exports,n),o=!1}finally{o&&delete r[t]}return i.exports}n.ab="//";var s=n(308);t.exports=s}()},9382:function(t,e,r){var n=r(4284);!function(){var e={66:function(){!function(t,e){"use strict";if(!t.setImmediate){var r,s=1,i={},o=!1,a=t.document,c=Object.getPrototypeOf&&Object.getPrototypeOf(t);c=c&&c.setTimeout?c:t,"[object process]"==={}.toString.call(t.process)?r=function(t){n.nextTick((function(){l(t)}))}:function(){if(t.postMessage&&!t.importScripts){var e=!0,r=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=r,e}}()?function(){var e="setImmediate$"+Math.random()+"$",n=function(r){r.source===t&&"string"===typeof r.data&&0===r.data.indexOf(e)&&l(+r.data.slice(e.length))};t.addEventListener?t.addEventListener("message",n,!1):t.attachEvent("onmessage",n),r=function(r){t.postMessage(e+r,"*")}}():t.MessageChannel?function(){var t=new MessageChannel;t.port1.onmessage=function(t){l(t.data)},r=function(e){t.port2.postMessage(e)}}():a&&"onreadystatechange"in a.createElement("script")?function(){var t=a.documentElement;r=function(e){var r=a.createElement("script");r.onreadystatechange=function(){l(e),r.onreadystatechange=null,t.removeChild(r),r=null},t.appendChild(r)}}():r=function(t){setTimeout(l,0,t)},c.setImmediate=function(t){"function"!==typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),n=0;n<e.length;n++)e[n]=arguments[n+1];var o={callback:t,args:e};return i[s]=o,r(s),s++},c.clearImmediate=u}function u(t){delete i[t]}function h(t){var e=t.callback,r=t.args;switch(r.length){case 0:e();break;case 1:e(r[0]);break;case 2:e(r[0],r[1]);break;case 3:e(r[0],r[1],r[2]);break;default:e.apply(undefined,r)}}function l(t){if(o)setTimeout(l,0,t);else{var e=i[t];if(e){o=!0;try{h(e)}finally{u(t),o=!1}}}}}("undefined"===typeof self?"undefined"===typeof r.g?this:r.g:self)}};"undefined"!==typeof __nccwpck_require__&&(__nccwpck_require__.ab="//");e[66](),t.exports={}}()},1877:function(t,e,r){"use strict";var n=r(4284);var s="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};var i=a(r(8292)),o=a(r(6493));function a(t){return t&&t.__esModule?t:{default:t}}var c="undefined"===typeof document||"undefined"!==typeof n&&n.env&&!1,u={},h=void 0;function l(){return h&&!h.headersSent}function p(t,e){var r=c?u:i.default.parse(document.cookie),n=r&&r[t];if("undefined"===typeof e&&(e=!n||"{"!==n[0]&&"["!==n[0]),!e)try{n=JSON.parse(n)}catch(s){}return n}function f(t){var e=c?u:i.default.parse(document.cookie);if("undefined"===typeof t&&(t=!e||"{"!==e[0]&&"["!==e[0]),!t)try{e=JSON.parse(e)}catch(r){}return e}function d(t){var e=c?u:i.default.parse(document.cookie);return e?t?Object.keys(e).reduce((function(r,n){if(!t.test(n))return r;var s={};return s[n]=e[n],(0,o.default)({},r,s)}),{}):e:{}}function y(t,e,r){u[t]=e,"object"===("undefined"===typeof e?"undefined":s(e))&&(u[t]=JSON.stringify(e)),c||(document.cookie=i.default.serialize(t,u[t],r)),l()&&h.cookie&&h.cookie(t,e,r)}function m(t,e){delete u[t],e="undefined"===typeof e?{}:"string"===typeof e?{path:e}:(0,o.default)({},e),"undefined"!==typeof document&&(e.expires=new Date(1970,1,1,0,0,1),e.maxAge=0,document.cookie=i.default.serialize(t,"",e)),l()&&h.clearCookie&&h.clearCookie(t,e)}function g(t){u=t?i.default.parse(t):{}}function v(t,e){return t.cookie?u=t.cookie:t.cookies?u=t.cookies:t.headers&&t.headers.cookie?g(t.headers.cookie):u={},h=e,function(){h=null,u={}}}e.ZP={setRawCookie:g,load:p,loadAll:f,select:d,save:y,remove:m,plugToRequest:v}},8292:function(t,e){"use strict";e.parse=function(t,e){if("string"!==typeof t)throw new TypeError("argument str must be a string");for(var n={},i=e||{},a=t.split(s),c=i.decode||r,u=0;u<a.length;u++){var h=a[u],l=h.indexOf("=");if(!(l<0)){var p=h.substr(0,l).trim(),f=h.substr(++l,h.length).trim();'"'==f[0]&&(f=f.slice(1,-1)),void 0==n[p]&&(n[p]=o(f,c))}}return n},e.serialize=function(t,e,r){var s=r||{},o=s.encode||n;if("function"!==typeof o)throw new TypeError("option encode is invalid");if(!i.test(t))throw new TypeError("argument name is invalid");var a=o(e);if(a&&!i.test(a))throw new TypeError("argument val is invalid");var c=t+"="+a;if(null!=s.maxAge){var u=s.maxAge-0;if(isNaN(u))throw new Error("maxAge should be a Number");c+="; Max-Age="+Math.floor(u)}if(s.domain){if(!i.test(s.domain))throw new TypeError("option domain is invalid");c+="; Domain="+s.domain}if(s.path){if(!i.test(s.path))throw new TypeError("option path is invalid");c+="; Path="+s.path}if(s.expires){if("function"!==typeof s.expires.toUTCString)throw new TypeError("option expires is invalid");c+="; Expires="+s.expires.toUTCString()}s.httpOnly&&(c+="; HttpOnly");s.secure&&(c+="; Secure");if(s.sameSite){switch("string"===typeof s.sameSite?s.sameSite.toLowerCase():s.sameSite){case!0:c+="; SameSite=Strict";break;case"lax":c+="; SameSite=Lax";break;case"strict":c+="; SameSite=Strict";break;default:throw new TypeError("option sameSite is invalid")}}return c};var r=decodeURIComponent,n=encodeURIComponent,s=/; */,i=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function o(t,e){try{return e(t)}catch(r){return t}}},4153:function(t,e,r){"use strict";r.d(e,{qC:function(){return f},hC:function(){return l}});var n=r(7378),s=(r(4366),r(3219));function i(){var t=this.constructor.getDerivedStateFromProps(this.props,this.state);null!==t&&void 0!==t&&this.setState(t)}function o(t){this.setState(function(e){var r=this.constructor.getDerivedStateFromProps(t,e);return null!==r&&void 0!==r?r:null}.bind(this))}function a(t,e){try{var r=this.props,n=this.state;this.props=t,this.state=e,this.__reactInternalSnapshotFlag=!0,this.__reactInternalSnapshot=this.getSnapshotBeforeUpdate(r,n)}finally{this.props=r,this.state=n}}i.__suppressDeprecationWarning=!0,o.__suppressDeprecationWarning=!0,a.__suppressDeprecationWarning=!0;r(9599);var c=r(4275),u=r(4632),h=function(t,e){return function(r){return r[t]=e,r}},l=function(t){return h("displayName",t)};Object.keys,n.Component;var p,f=function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return e.reduce((function(t,e){return function(){return t(e.apply(void 0,arguments))}}),(function(t){return t}))},d={fromESObservable:null,toESObservable:null},y={fromESObservable:function(t){return"function"===typeof d.fromESObservable?d.fromESObservable(t):t},toESObservable:function(t){return"function"===typeof d.toESObservable?d.toESObservable(t):t}};p=y},9599:function(t){"use strict";var e={childContextTypes:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},r={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},n=Object.defineProperty,s=Object.getOwnPropertyNames,i=Object.getOwnPropertySymbols,o=Object.getOwnPropertyDescriptor,a=Object.getPrototypeOf,c=a&&a(Object);t.exports=function t(u,h,l){if("string"!==typeof h){if(c){var p=a(h);p&&p!==c&&t(u,p,l)}var f=s(h);i&&(f=f.concat(i(h)));for(var d=0;d<f.length;++d){var y=f[d];if(!e[y]&&!r[y]&&(!l||!l[y])){var m=o(h,y);try{n(u,y,m)}catch(g){}}}return u}return u}},9040:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.diffAny=e.diffObjects=e.diffArrays=e.intersection=e.subtract=e.isDestructive=void 0;var n=r(99);function s(t,e){var r={};for(var s in t)n.hasOwnProperty.call(t,s)&&void 0!==t[s]&&(r[s]=1);for(var i in e)n.hasOwnProperty.call(e,i)&&void 0!==e[i]&&delete r[i];return Object.keys(r)}function i(t){for(var e=t.length,r={},s=0;s<e;s++){var i=t[s];for(var o in i)n.hasOwnProperty.call(i,o)&&void 0!==i[o]&&(r[o]=(r[o]||0)+1)}for(var o in r)r[o]<e&&delete r[o];return Object.keys(r)}function o(t,e){return{operations:t.operations.concat(e),cost:t.cost+1}}function a(t,e,r,n){void 0===n&&(n=u);var s={"0,0":{operations:[],cost:0}};var i=isNaN(t.length)||t.length<=0?0:t.length,a=isNaN(e.length)||e.length<=0?0:e.length,c=function i(a,c){var u=a+","+c,h=s[u];if(void 0===h){if(a>0&&c>0&&!n(t[a-1],e[c-1],r.add(String(a-1))).length)h=i(a-1,c-1);else{var l=[];if(a>0){var p=i(a-1,c),f={op:"remove",index:a-1};l.push(o(p,f))}if(c>0){var d=i(a,c-1),y={op:"add",index:a-1,value:e[c-1]};l.push(o(d,y))}if(a>0&&c>0){var m=i(a-1,c-1),g={op:"replace",index:a-1,original:t[a-1],value:e[c-1]};l.push(o(m,g))}h=l.sort((function(t,e){return t.cost-e.cost}))[0]}s[u]=h}return h}(i,a).operations;return c.reduce((function(t,e){var s=t[0],o=t[1];if(function(t){return"add"===t.op}(e)){var a=e.index+1+o,c=a<i+o?String(a):"-",u={op:e.op,path:r.add(c).toString(),value:e.value};return[s.concat(u),o+1]}if(function(t){return"remove"===t.op}(e)){u={op:e.op,path:r.add(String(e.index+o)).toString()};return[s.concat(u),o-1]}var h=r.add(String(e.index+o)),l=n(e.original,e.value,h);return[s.concat.apply(s,l),o]}),[[],0])[0]}function c(t,e,r,n){void 0===n&&(n=u);var o=[];return s(t,e).forEach((function(t){o.push({op:"remove",path:r.add(t).toString()})})),s(e,t).forEach((function(t){o.push({op:"add",path:r.add(t).toString(),value:e[t]})})),i([t,e]).forEach((function(s){o.push.apply(o,n(t[s],e[s],r.add(s)))})),o}function u(t,e,r,s){if(void 0===s&&(s=u),t===e)return[];var i=n.objectType(t),o=n.objectType(e);return"array"==i&&"array"==o?a(t,e,r,s):"object"==i&&"object"==o?c(t,e,r,s):[{op:"replace",path:r.toString(),value:e}]}e.isDestructive=function(t){var e=t.op;return"remove"===e||"replace"===e||"copy"===e||"move"===e},e.subtract=s,e.intersection=i,e.diffArrays=a,e.diffObjects=c,e.diffAny=u},3979:function(t,e,r){"use strict";e.rh=e.af=void 0;var n=r(2399),s=r(5064),i=r(9040);function o(t,e){var r=n.Pointer.fromJSON(e).evaluate(t);if(void 0!==r)return{op:"test",path:e,value:r.value}}e.af=function(t,e){return e.map((function(e){return s.apply(t,e)}))},e.rh=function(t,e,r){var s=new n.Pointer;return(r?function(t){return function e(r,n,s){var o=t(r,n,s);return Array.isArray(o)?o:i.diffAny(r,n,s,e)}}(r):i.diffAny)(t,e,s)}},5064:function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!==typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.apply=e.InvalidOperationError=e.test=e.copy=e.move=e.replace=e.remove=e.add=e.TestError=e.MissingError=void 0;var s=r(2399),i=r(99),o=r(9040),a=function(t){function e(e){var r=t.call(this,"Value required at path: "+e)||this;return r.path=e,r.name="MissingError",r}return n(e,t),e}(Error);e.MissingError=a;var c=function(t){function e(e,r){var n=t.call(this,"Test failed: "+e+" != "+r)||this;return n.actual=e,n.expected=r,n.name="TestError",n}return n(e,t),e}(Error);function u(t,e,r){if(Array.isArray(t))if("-"==e)t.push(r);else{var n=parseInt(e,10);t.splice(n,0,r)}else t[e]=r}function h(t,e){if(Array.isArray(t)){var r=parseInt(e,10);t.splice(r,1)}else delete t[e]}function l(t,e){var r=s.Pointer.fromJSON(e.path).evaluate(t);return void 0===r.parent?new a(e.path):(u(r.parent,r.key,i.clone(e.value)),null)}function p(t,e){var r=s.Pointer.fromJSON(e.path).evaluate(t);return void 0===r.value?new a(e.path):(h(r.parent,r.key),null)}function f(t,e){var r=s.Pointer.fromJSON(e.path).evaluate(t);if(null===r.parent)return new a(e.path);if(Array.isArray(r.parent)){if(parseInt(r.key,10)>=r.parent.length)return new a(e.path)}else if(void 0===r.value)return new a(e.path);return r.parent[r.key]=e.value,null}function d(t,e){var r=s.Pointer.fromJSON(e.from).evaluate(t);if(void 0===r.value)return new a(e.from);var n=s.Pointer.fromJSON(e.path).evaluate(t);return void 0===n.parent?new a(e.path):(h(r.parent,r.key),u(n.parent,n.key,r.value),null)}function y(t,e){var r=s.Pointer.fromJSON(e.from).evaluate(t);if(void 0===r.value)return new a(e.from);var n=s.Pointer.fromJSON(e.path).evaluate(t);return void 0===n.parent?new a(e.path):(u(n.parent,n.key,i.clone(r.value)),null)}function m(t,e){var r=s.Pointer.fromJSON(e.path).evaluate(t);return o.diffAny(r.value,e.value,new s.Pointer).length?new c(r.value,e.value):null}e.TestError=c,e.add=l,e.remove=p,e.replace=f,e.move=d,e.copy=y,e.test=m;var g=function(t){function e(e){var r=t.call(this,"Invalid operation: "+e.op)||this;return r.operation=e,r.name="InvalidOperationError",r}return n(e,t),e}(Error);e.InvalidOperationError=g,e.apply=function(t,e){switch(e.op){case"add":return l(t,e);case"remove":return p(t,e);case"replace":return f(t,e);case"move":return d(t,e);case"copy":return y(t,e);case"test":return m(t,e)}return new g(e)}},2399:function(t,e){"use strict";function r(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function n(t){return t.replace(/~/g,"~0").replace(/\//g,"~1")}Object.defineProperty(e,"__esModule",{value:!0}),e.Pointer=void 0;var s=function(){function t(t){void 0===t&&(t=[""]),this.tokens=t}return t.fromJSON=function(e){var n=e.split("/").map(r);if(""!==n[0])throw new Error("Invalid JSON Pointer: "+e);return new t(n)},t.prototype.toString=function(){return this.tokens.map(n).join("/")},t.prototype.evaluate=function(t){for(var e=null,r="",n=t,s=1,i=this.tokens.length;s<i;s++)e=n,"__proto__"!=(r=this.tokens[s])&&"constructor"!=r&&"prototype"!=r&&(n=(e||{})[r]);return{parent:e,key:r,value:n}},t.prototype.get=function(t){return this.evaluate(t).value},t.prototype.set=function(t,e){for(var r=t,n=1,s=this.tokens.length-1,i=this.tokens[n];n<s;n++)r=(r||{})[i];r&&(r[this.tokens[this.tokens.length-1]]=e)},t.prototype.push=function(t){this.tokens.push(t)},t.prototype.add=function(e){return new t(this.tokens.concat(String(e)))},t}();e.Pointer=s},99:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.clone=e.objectType=e.hasOwnProperty=void 0,e.hasOwnProperty=Object.prototype.hasOwnProperty,e.objectType=function(t){return void 0===t?"undefined":null===t?"null":Array.isArray(t)?"array":typeof t},e.clone=function t(r){if(null==(n=r)||"object"!=typeof n)return r;var n;if(r.constructor==Array){for(var s=r.length,i=new Array(s),o=0;o<s;o++)i[o]=t(r[o]);return i}if(r.constructor==Date)return new Date(+r);var a={};for(var c in r)e.hasOwnProperty.call(r,c)&&(a[c]=t(r[c]));return a}},4632:function(t,e,r){"use strict";r.d(e,{Z:function(){return n}}),t=r.hmd(t);var n=function(t){var e,r=t.Symbol;return"function"===typeof r?r.observable?e=r.observable:(e=r("observable"),r.observable=e):e="@@observable",e}("undefined"!==typeof self?self:"undefined"!==typeof window?window:"undefined"!==typeof r.g?r.g:t)},6131:function(t,e,r){"use strict";function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function s(t){return function(t){if(Array.isArray(t))return n(t)}(t)||function(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"===typeof t)return n(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}r.d(e,{Z:function(){return s}})}}]);