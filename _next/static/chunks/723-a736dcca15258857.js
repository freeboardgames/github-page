(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[723],{1195:function(t,e,r){"use strict";var n=r(3203);e.Z=void 0;var i=n(r(9124)),s=r(4246),o=(0,i.default)((0,s.jsx)("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"}),"MoreVert");e.Z=o},1589:function(t,e,r){"use strict";var n=r(3203);e.Z=void 0;var i=n(r(9124)),s=r(4246),o=(0,i.default)((0,s.jsx)("path",{d:"M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"}),"Replay");e.Z=o},5039:function(t,e,r){"use strict";r.d(e,{Z:function(){return A}});var n=r(808),i=r(5773),s=r(7378),o=r(8944),a=r(2267),c=r(43),l=r(9090),u=r(9834),h=r(4769),p=r(4124),f=r(6749);function d(t){return(0,f.Z)("MuiCircularProgress",t)}(0,p.Z)("MuiCircularProgress",["root","determinate","indeterminate","colorPrimary","colorSecondary","svg","circle","circleDeterminate","circleIndeterminate","circleDisableShrink"]);var y=r(4246);let m=["className","color","disableShrink","size","style","thickness","value","variant"],g=t=>t,v,b,w,E,O=(0,c.F4)(v||(v=g`
  0% {
    transform: rotate(0deg);
  }

  100% {
    transform: rotate(360deg);
  }
`)),P=(0,c.F4)(b||(b=g`
  0% {
    stroke-dasharray: 1px, 200px;
    stroke-dashoffset: 0;
  }

  50% {
    stroke-dasharray: 100px, 200px;
    stroke-dashoffset: -15px;
  }

  100% {
    stroke-dasharray: 100px, 200px;
    stroke-dashoffset: -125px;
  }
`)),x=t=>{let{classes:e,variant:r,color:n,disableShrink:i}=t,s={root:["root",r,`color${(0,l.Z)(n)}`],svg:["svg"],circle:["circle",`circle${(0,l.Z)(r)}`,i&&"circleDisableShrink"]};return(0,a.Z)(s,d,e)},I=(0,h.ZP)("span",{name:"MuiCircularProgress",slot:"Root",overridesResolver(t,e){let{ownerState:r}=t;return[e.root,e[r.variant],e[`color${(0,l.Z)(r.color)}`]]}})(({ownerState:t,theme:e})=>(0,i.Z)({display:"inline-block"},"determinate"===t.variant&&{transition:e.transitions.create("transform")},"inherit"!==t.color&&{color:(e.vars||e).palette[t.color].main}),({ownerState:t})=>"indeterminate"===t.variant&&(0,c.iv)(w||(w=g`
      animation: ${0} 1.4s linear infinite;
    `),O)),S=(0,h.ZP)("svg",{name:"MuiCircularProgress",slot:"Svg",overridesResolver:(t,e)=>e.svg})({display:"block"}),_=(0,h.ZP)("circle",{name:"MuiCircularProgress",slot:"Circle",overridesResolver(t,e){let{ownerState:r}=t;return[e.circle,e[`circle${(0,l.Z)(r.variant)}`],r.disableShrink&&e.circleDisableShrink]}})(({ownerState:t,theme:e})=>(0,i.Z)({stroke:"currentColor"},"determinate"===t.variant&&{transition:e.transitions.create("stroke-dashoffset")},"indeterminate"===t.variant&&{strokeDasharray:"80px, 200px",strokeDashoffset:0}),({ownerState:t})=>"indeterminate"===t.variant&&!t.disableShrink&&(0,c.iv)(E||(E=g`
      animation: ${0} 1.4s ease-in-out infinite;
    `),P)),k=s.forwardRef(function(t,e){let r=(0,u.Z)({props:t,name:"MuiCircularProgress"}),{className:s,color:a="primary",disableShrink:c=!1,size:l=40,style:h,thickness:p=3.6,value:f=0,variant:d="indeterminate"}=r,g=(0,n.Z)(r,m),v=(0,i.Z)({},r,{color:a,disableShrink:c,size:l,thickness:p,value:f,variant:d}),b=x(v),w={},E={},O={};if("determinate"===d){let P=2*Math.PI*((44-p)/2);w.strokeDasharray=P.toFixed(3),O["aria-valuenow"]=Math.round(f),w.strokeDashoffset=`${((100-f)/100*P).toFixed(3)}px`,E.transform="rotate(-90deg)"}return(0,y.jsx)(I,(0,i.Z)({className:(0,o.Z)(b.root,s),style:(0,i.Z)({width:l,height:l},E,h),ownerState:v,ref:e,role:"progressbar"},O,g,{children:(0,y.jsx)(S,{className:b.svg,ownerState:v,viewBox:"22 22 44 44",children:(0,y.jsx)(_,{className:b.circle,style:w,ownerState:v,cx:44,cy:44,r:(44-p)/2,fill:"none",strokeWidth:p})})}))});var A=k},6365:function(t,e,r){"use strict";r.d(e,{L:function(){return s}});var n=r(4124),i=r(6749);function s(t){return(0,i.Z)("MuiListItemText",t)}let o=(0,n.Z)("MuiListItemText",["root","multiline","dense","inset","primary","secondary"]);e.Z=o},505:function(t,e,r){"use strict";r.d(e,{Z:function(){return k}});var n=r(808),i=r(5773),s=r(7378),o=r(8944),a=r(2267),c=r(7818),l=r(4769),u=r(9834),h=r(4350),p=r(1827),f=r(6609),d=r(128),y=r(4124);let m=(0,y.Z)("MuiDivider",["root","absolute","fullWidth","inset","middle","flexItem","light","vertical","withChildren","withChildrenVertical","textAlignRight","textAlignLeft","wrapper","wrapperVertical"]),g=(0,y.Z)("MuiListItemIcon",["root","alignItemsFlexStart"]);var v=r(6365),b=r(6749);function w(t){return(0,b.Z)("MuiMenuItem",t)}let E=(0,y.Z)("MuiMenuItem",["root","focusVisible","dense","disabled","divider","gutters","selected"]);var O=r(4246);let P=["autoFocus","component","dense","divider","disableGutters","focusVisibleClassName","role","tabIndex","className"],x=(t,e)=>{let{ownerState:r}=t;return[e.root,r.dense&&e.dense,r.divider&&e.divider,!r.disableGutters&&e.gutters]},I=t=>{let{disabled:e,dense:r,divider:n,disableGutters:s,selected:o,classes:c}=t,l=(0,a.Z)({root:["root",r&&"dense",e&&"disabled",!s&&"gutters",n&&"divider",o&&"selected"]},w,c);return(0,i.Z)({},c,l)},S=(0,l.ZP)(p.Z,{shouldForwardProp:t=>(0,l.FO)(t)||"classes"===t,name:"MuiMenuItem",slot:"Root",overridesResolver:x})(({theme:t,ownerState:e})=>(0,i.Z)({},t.typography.body1,{display:"flex",justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",minHeight:48,paddingTop:6,paddingBottom:6,boxSizing:"border-box",whiteSpace:"nowrap"},!e.disableGutters&&{paddingLeft:16,paddingRight:16},e.divider&&{borderBottom:`1px solid ${(t.vars||t).palette.divider}`,backgroundClip:"padding-box"},{"&:hover":{textDecoration:"none",backgroundColor:(t.vars||t).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${E.selected}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:(0,c.Fq)(t.palette.primary.main,t.palette.action.selectedOpacity),[`&.${E.focusVisible}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.focusOpacity}))`:(0,c.Fq)(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.focusOpacity)}},[`&.${E.selected}:hover`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.hoverOpacity}))`:(0,c.Fq)(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:(0,c.Fq)(t.palette.primary.main,t.palette.action.selectedOpacity)}},[`&.${E.focusVisible}`]:{backgroundColor:(t.vars||t).palette.action.focus},[`&.${E.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity},[`& + .${m.root}`]:{marginTop:t.spacing(1),marginBottom:t.spacing(1)},[`& + .${m.inset}`]:{marginLeft:52},[`& .${v.Z.root}`]:{marginTop:0,marginBottom:0},[`& .${v.Z.inset}`]:{paddingLeft:36},[`& .${g.root}`]:{minWidth:36}},!e.dense&&{[t.breakpoints.up("sm")]:{minHeight:"auto"}},e.dense&&(0,i.Z)({minHeight:32,paddingTop:4,paddingBottom:4},t.typography.body2,{[`& .${g.root} svg`]:{fontSize:"1.25rem"}}))),_=s.forwardRef(function(t,e){let r;let a=(0,u.Z)({props:t,name:"MuiMenuItem"}),{autoFocus:c=!1,component:l="li",dense:p=!1,divider:y=!1,disableGutters:m=!1,focusVisibleClassName:g,role:v="menuitem",tabIndex:b,className:w}=a,E=(0,n.Z)(a,P),x=s.useContext(h.Z),_={dense:p||x.dense||!1,disableGutters:m},k=s.useRef(null);(0,f.Z)(()=>{c&&k.current&&k.current.focus()},[c]);let A=(0,i.Z)({},a,{dense:_.dense,divider:y,disableGutters:m}),C=I(a),N=(0,d.Z)(k,e);return a.disabled||(r=void 0!==b?b:-1),(0,O.jsx)(h.Z.Provider,{value:_,children:(0,O.jsx)(S,(0,i.Z)({ref:N,role:v,tabIndex:r,component:l,focusVisibleClassName:(0,o.Z)(C.focusVisible,g),className:(0,o.Z)(C.root,w)},E,{ownerState:A,classes:C}))})});var k=_},1831:function(t,e,r){"use strict";r.d(e,{M:function(){return a}});var n=r(5488),i=r(4460),s=r(8754);r(9382);class o{constructor({enumerate:t,seed:e}){this.enumerateFn=t,this.seed=e,this.iterationCounter=0,this._opts={}}addOpt({key:t,range:e,initial:r}){this._opts[t]={range:e,value:r}}getOpt(t){return this._opts[t].value}setOpt(t,e){t in this._opts&&(this._opts[t].value=e)}opts(){return this._opts}enumerate(t,e,r){let i=this.enumerateFn(t,e,r);return i.map(t=>"payload"in t?t:"move"in t?(0,n.B)(t.move,t.args,r):"event"in t?(0,n.g)(t.event,t.args,r):void 0)}random(t){let e;if(void 0!==this.seed){let r=this.prngstate?"":this.seed,n=(0,i.a)(r,this.prngstate);e=n(),this.prngstate=n.state()}else e=Math.random();if(t){if(!Array.isArray(t))return Math.floor(e*t);{let s=Math.floor(e*t.length);return t[s]}}return e}}class a extends o{constructor({enumerate:t,seed:e,objectives:r,game:n,iterations:i,playoutDepth:o,iterationCallback:a}){super({enumerate:t,seed:e}),void 0===r&&(r=()=>({})),this.objectives=r,this.iterationCallback=a||(()=>{}),this.reducer=(0,s.C)({game:n}),this.iterations=i,this.playoutDepth=o,this.addOpt({key:"async",initial:!1}),this.addOpt({key:"iterations",initial:"number"==typeof i?i:1e3,range:{min:1,max:2e3}}),this.addOpt({key:"playoutDepth",initial:"number"==typeof o?o:50,range:{min:1,max:100}})}createNode({state:t,parentAction:e,parent:r,playerID:n}){let{G:i,ctx:s}=t,o=[],a=[];if(void 0!==n)o=this.enumerate(i,s,n),a=this.objectives(i,s,n);else if(s.activePlayers)for(let c in s.activePlayers)o.push(...this.enumerate(i,s,c)),a.push(this.objectives(i,s,c));else o=this.enumerate(i,s,s.currentPlayer),a=this.objectives(i,s,s.currentPlayer);return{state:t,parent:r,parentAction:e,actions:o,objectives:a,children:[],visits:0,value:0}}select(t){if(t.actions.length>0||0===t.children.length)return t;let e=null,r=0;for(let n of t.children){let i=n.visits+Number.EPSILON,s=n.value/i+Math.sqrt(2*Math.log(t.visits)/i);(null==e||s>r)&&(r=s,e=n)}return this.select(e)}expand(t){let e=t.actions;if(0===e.length||void 0!==t.state.ctx.gameover)return t;let r=this.random(e.length),n=e[r];t.actions.splice(r,1);let i=this.reducer(t.state,n),s=this.createNode({state:i,parentAction:n,parent:t});return t.children.push(s),s}playout({state:t}){let e=this.getOpt("playoutDepth");"function"==typeof this.playoutDepth&&(e=this.playoutDepth(t.G,t.ctx));for(let r=0;r<e&&void 0===t.ctx.gameover;r++){let{G:n,ctx:i}=t,s=i.currentPlayer;i.activePlayers&&(s=Object.keys(i.activePlayers)[0]);let o=this.enumerate(n,i,s),a=this.objectives(n,i,s),c=Object.keys(a).reduce((t,e)=>{let r=a[e];return r.checker(n,i)?t+r.weight:t},0);if(c>0)return{score:c};if(!o||0===o.length)return;let l=this.random(o.length),u=this.reducer(t,o[l]);t=u}return t.ctx.gameover}backpropagate(t,e={}){t.visits++,void 0!==e.score&&(t.value+=e.score),!0===e.draw&&(t.value+=.5),t.parentAction&&e.winner===t.parentAction.payload.playerID&&t.value++,t.parent&&this.backpropagate(t.parent,e)}play(t,e){let r=this.createNode({state:t,playerID:e}),n=this.getOpt("iterations");"function"==typeof this.iterations&&(n=this.iterations(t.G,t.ctx));let i=()=>{let t=null;for(let e of r.children)(null==t||e.visits>t.visits)&&(t=e);let n=t&&t.parentAction;return{action:n,metadata:r}};return new Promise(t=>{let e=()=>{for(let t=0;t<25&&this.iterationCounter<n;t++){let e=this.select(r),i=this.expand(e),s=this.playout(i);this.backpropagate(i,s),this.iterationCounter++}this.iterationCallback({iterationCounter:this.iterationCounter,numIterations:n,metadata:r})};if(this.iterationCounter=0,this.getOpt("async")){let s=()=>{this.iterationCounter<n?(e(),setImmediate(s)):t(i())};s()}else{for(;this.iterationCounter<n;)e();t(i())}})}}},3243:function(t,e,r){"use strict";r.d(e,{I:function(){return s}});var n=r(5488),i=r(8754);function s({game:t,numPlayers:e,setupData:r}){t=(0,i.P)(t),e||(e=2);let s=t.flow.ctx(e),o={G:{},ctx:s,plugins:{}};o=(0,n.t)(o,{game:t}),o=(0,n.E)(o,{game:t,playerID:void 0});let a=(0,n.a)(o);o.G=t.setup({...a,ctx:o.ctx},r);let c={...o,_undo:[],_redo:[],_stateID:0};return c=t.flow.init(c),[c]=(0,n.q)(c,{game:t}),t.disableUndo||(c._undo=[{G:c.G,ctx:c.ctx,plugins:c.plugins}]),c}},4460:function(t,e,r){"use strict";r.d(e,{R:function(){return a},a:function(){return s}});class n{constructor(t){let e=function(){let t=4022871197,e=function(e){let r=e.toString();for(let n=0;n<r.length;n++){let i=.02519603282416938*(t+=r.charCodeAt(n));t=i>>>0,i-=t,i*=t,t=i>>>0,i-=t,t+=4294967296*i}return(t>>>0)*23283064365386963e-26};return e}();this.c=1,this.s0=e(" "),this.s1=e(" "),this.s2=e(" "),this.s0-=e(t),this.s0<0&&(this.s0+=1),this.s1-=e(t),this.s1<0&&(this.s1+=1),this.s2-=e(t),this.s2<0&&(this.s2+=1)}next(){let t=2091639*this.s0+23283064365386963e-26*this.c;return this.s0=this.s1,this.s1=this.s2,this.s2=t-(this.c=Math.trunc(t))}}function i(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function s(t,e){let r=new n(t),s=r.next.bind(r);return e&&i(e,r),s.state=()=>i(r,{}),s}class o{constructor(t){this.state=t||{seed:"0"},this.used=!1}static seed(){return Date.now().toString(36).slice(-10)}isUsed(){return this.used}getState(){return this.state}_random(){this.used=!0;let t=this.state,e=t.prngstate?"":t.seed,r=s(e,t.prngstate),n=r();return this.state={...t,prngstate:r.state()},n}api(){let t=this._random.bind(this),e={D4:4,D6:6,D8:8,D10:10,D12:12,D20:20},r={};for(let n in e){let i=e[n];r[n]=e=>void 0===e?Math.floor(t()*i)+1:Array.from({length:e}).map(()=>Math.floor(t()*i)+1)}return{...r,Die:function(e=6,r){return void 0===r?Math.floor(t()*e)+1:Array.from({length:r}).map(()=>Math.floor(t()*e)+1)},Number:()=>t(),Shuffle(e){let r=[...e],n=e.length,i=0,s=Array.from({length:n});for(;n;){let o=Math.trunc(n*t());s[i++]=r[o],r[o]=r[--n]}return s},_private:this}}}let a={name:"random",noClient:({api:t})=>t._private.isUsed(),flush:({api:t})=>t._private.getState(),api({data:t}){let e=new o(t);return e.api()},setup({game:t}){let{seed:e}=t;return void 0===e&&(e=o.seed()),{seed:e}},playerView:()=>void 0}},4715:function(t,e,r){"use strict";r.d(e,{K:function(){return L}}),r(3261),r(3979);let n=(t=21)=>{let e="",r=t;for(;r--;)e+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[64*Math.random()|0];return e};var i,s,o=r(5240),a=r(5488),c=r(8754),l=r(3243),u=r(4958);class h extends u.T{connect(){}disconnect(){}sendAction(){}sendChatMessage(){}requestSync(){}updateCredentials(){}updateMatchID(){}updatePlayerID(){}}let p=t=>new h(t),f=new class{constructor(){this.debugPanel=null,this.currentClient=null,this.clients=new Map,this.subscribers=new Map}register(t){this.clients.set(t,t),this.mountDebug(t),this.notifySubscribers()}unregister(t){if(this.clients.delete(t),this.currentClient===t)for(let[e]of(this.unmountDebug(),this.clients)){if(this.debugPanel)break;this.mountDebug(e)}this.notifySubscribers()}subscribe(t){let e=Symbol();return this.subscribers.set(e,t),t(this.getState()),()=>{this.subscribers.delete(e)}}switchPlayerID(t){if(this.currentClient.multiplayer){for(let[e]of this.clients)if(e.playerID===t&&!1!==e.debugOpt&&e.multiplayer===this.currentClient.multiplayer){this.switchToClient(e);return}}this.currentClient.updatePlayerID(t),this.notifySubscribers()}switchToClient(t){t!==this.currentClient&&(this.unmountDebug(),this.mountDebug(t),this.notifySubscribers())}notifySubscribers(){let t=this.getState();this.subscribers.forEach(e=>{e(t)})}getState(){return{client:this.currentClient,debuggableClients:this.getDebuggableClients()}}getDebuggableClients(){return[...this.clients.values()].filter(t=>!1!==t.debugOpt)}mountDebug(t){let e;if(!1===t.debugOpt||null!==this.debugPanel||"undefined"==typeof document)return;let r=document.body;t.debugOpt&&!0!==t.debugOpt&&(e=t.debugOpt.impl||e,r=t.debugOpt.target||r),e&&(this.currentClient=t,this.debugPanel=new e({target:r,props:{clientManager:this}}))}unmountDebug(){this.debugPanel.$destroy(),this.debugPanel=null,this.currentClient=null}};function d(t,e,r){if(!r&&null==t){let n=e.getState();t=n.ctx.currentPlayer}return t}function y(t,e,r,n,i,s){let o={};for(let c of e)o[c]=(...e)=>{let o=a.A[t](c,e,d(n,r,s),i);r.dispatch(o)};return o}let m=y.bind(null,"makeMove"),g=y.bind(null,"gameEvent"),v=y.bind(null,"plugin");class b{constructor({game:t,debug:e,numPlayers:r,multiplayer:i,matchID:s,playerID:u,credentials:h,enhancer:y}){this.game=(0,c.P)(t),this.playerID=u,this.matchID=s||"default",this.credentials=h,this.multiplayer=i,this.debugOpt=e,this.manager=f,this.gameStateOverride=null,this.subscribers={},this._running=!1,this.reducer=(0,c.C)({game:this.game,isClient:void 0!==i}),this.initialState=null,i||(this.initialState=(0,l.I)({game:this.game,numPlayers:r})),this.reset=()=>{this.store.dispatch((0,a.u)(this.initialState))},this.undo=()=>{let t=(0,a.v)(d(this.playerID,this.store,this.multiplayer),this.credentials);this.store.dispatch(t)},this.redo=()=>{let t=(0,a.w)(d(this.playerID,this.store,this.multiplayer),this.credentials);this.store.dispatch(t)},this.log=[];let m=t=>e=>r=>{let n=e(r),i=t.getState();switch(r.type){case a.M:case a.o:case a.j:case a.R:{let s=i.deltalog;this.log=[...this.log,...s];break}case a.m:this.log=[];break;case a.P:case a.l:{let o=-1;this.log.length>0&&(o=this.log[this.log.length-1]._stateID);let c=r.deltalog||[];c=c.filter(t=>t._stateID>o),this.log=[...this.log,...c];break}case a.k:this.initialState=r.initialState,this.log=r.log||[]}return n},g=t=>e=>r=>{let n=t.getState(),i=e(r);return"clientOnly"in r||r.type===a.p||this.transport.sendAction(n,r),i},v=()=>t=>e=>{let r=t(e);return this.notifySubscribers(),r},b=(0,o.md)(c.T,v,g,m);y=void 0!==y?(0,o.qC)(b,y):b,this.store=(0,o.MT)(this.reducer,this.initialState,y),i||(i=p),this.transport=i({transportDataCallback:t=>this.receiveTransportData(t),gameKey:t,game:this.game,matchID:s,playerID:u,credentials:h,gameName:this.game.name,numPlayers:r}),this.createDispatchers(),this.chatMessages=[],this.sendChatMessage=t=>{this.transport.sendChatMessage(this.matchID,{id:n(7),sender:this.playerID,payload:t})}}receiveMatchData(t){this.matchData=t,this.notifySubscribers()}receiveChatMessage(t){this.chatMessages=[...this.chatMessages,t],this.notifySubscribers()}receiveTransportData(t){let[e]=t.args;if(e===this.matchID)switch(t.type){case"sync":{let[,r]=t.args,n=(0,a.s)(r);this.receiveMatchData(r.filteredMetadata),this.store.dispatch(n);break}case"update":{let[,i,s]=t.args,o=this.store.getState();if(i._stateID>=o._stateID){let c=(0,a.z)(i,s);this.store.dispatch(c)}break}case"patch":{let[,l,u,h,p]=t.args,f=this.store.getState()._stateID;if(l!==f)break;let d=(0,a.y)(l,u,h,p);this.store.dispatch(d),this.store.getState()._stateID===f&&this.transport.requestSync();break}case"matchData":{let[,y]=t.args;this.receiveMatchData(y);break}case"chat":{let[,m]=t.args;this.receiveChatMessage(m)}}}notifySubscribers(){Object.values(this.subscribers).forEach(t=>t(this.getState()))}overrideGameState(t){this.gameStateOverride=t,this.notifySubscribers()}start(){this.transport.connect(),this._running=!0,this.manager.register(this)}stop(){this.transport.disconnect(),this._running=!1,this.manager.unregister(this)}subscribe(t){let e=Object.keys(this.subscribers).length;return this.subscribers[e]=t,this.transport.subscribeToConnectionStatus(()=>this.notifySubscribers()),(this._running||!this.multiplayer)&&t(this.getState()),()=>{delete this.subscribers[e]}}getInitialState(){return this.initialState}getState(){let t=this.store.getState();if(null!==this.gameStateOverride&&(t=this.gameStateOverride),null===t)return t;let e=!0,r=this.game.flow.isPlayerActive(t.G,t.ctx,this.playerID);return this.multiplayer&&!r&&(e=!1),this.multiplayer||null===this.playerID||void 0===this.playerID||r||(e=!1),void 0!==t.ctx.gameover&&(e=!1),this.multiplayer||(t={...t,G:this.game.playerView({G:t.G,ctx:t.ctx,playerID:this.playerID}),plugins:(0,a.x)(t,this)}),{...t,log:this.log,isActive:e,isConnected:this.transport.isConnected}}createDispatchers(){this.moves=m(this.game.moveNames,this.store,this.playerID,this.credentials,this.multiplayer),this.events=g(this.game.flow.enabledEventNames,this.store,this.playerID,this.credentials,this.multiplayer),this.plugins=v(this.game.pluginNames,this.store,this.playerID,this.credentials,this.multiplayer)}updatePlayerID(t){this.playerID=t,this.createDispatchers(),this.transport.updatePlayerID(t),this.notifySubscribers()}updateMatchID(t){this.matchID=t,this.createDispatchers(),this.transport.updateMatchID(t),this.notifySubscribers()}updateCredentials(t){this.credentials=t,this.createDispatchers(),this.transport.updateCredentials(t),this.notifySubscribers()}}/*! (c) 2020 Andrea Giammarchi */ let{parse:w,stringify:E}=JSON,{keys:O}=Object,P=String,x={},I=(t,e,r,n)=>{let i=[];for(let s=O(r),{length:o}=s,a=0;a<o;a++){let c=s[a],l=r[c];if(l instanceof P){let u=t[l];"object"!=typeof u||e.has(u)?r[c]=n.call(r,c,u):(e.add(u),r[c]=x,i.push({k:c,a:[t,e,u,n]}))}else r[c]!==x&&(r[c]=n.call(r,c,l))}for(let{length:h}=i,p=0;p<h;p++){let{k:f,a:d}=i[p];r[f]=n.call(r,f,I.apply(null,d))}return r};r(9382);var S=r(1831);let _=(t,e)=>{if(!t||"string"!=typeof t)throw Error(`Expected ${e} string, got "${t}".`)},k=t=>_(t,"game name"),A=t=>_(t,"match ID"),C=(t,e)=>{if(!t)throw Error(`Expected body, got “${t}”.`);for(let r in e){let n=e[r],i=Array.isArray(n)?n:[n],s=t[r];if(!i.includes(typeof s)){let o=i.join("|");throw TypeError(`Expected body.${r} to be of type ${o}, got “${s}”.`)}}};class N extends Error{constructor(t,e){super(t),this.details=e}}class D{constructor({server:t=""}={}){this.server=t.replace(/\/$/,"")}async request(t,e){let r=await fetch(this.server+t,e);if(!r.ok){let n;try{n=await r.clone().json()}catch{try{n=await r.text()}catch(i){n=i.message}}throw new N(`HTTP status ${r.status}`,n)}return r.json()}async post(t,e){let r={method:"post",body:JSON.stringify(e.body),headers:{"Content-Type":"application/json"}};return e.init&&(r={...r,...e.init,headers:{...r.headers,...e.init.headers}}),this.request(t,r)}async listGames(t){return this.request("/games",t)}async listMatches(t,e,r){k(t);let n="";if(e){let i=[],{isGameover:s,updatedBefore:o,updatedAfter:a}=e;void 0!==s&&i.push(`isGameover=${s}`),o&&i.push(`updatedBefore=${o}`),a&&i.push(`updatedAfter=${a}`),i.length>0&&(n="?"+i.join("&"))}return this.request(`/games/${t}${n}`,r)}async getMatch(t,e,r){return k(t),A(e),this.request(`/games/${t}/${e}`,r)}async createMatch(t,e,r){return k(t),C(e,{numPlayers:"number"}),this.post(`/games/${t}/create`,{body:e,init:r})}async joinMatch(t,e,r,n){return k(t),A(e),C(r,{playerID:["string","undefined"],playerName:"string"}),this.post(`/games/${t}/${e}/join`,{body:r,init:n})}async leaveMatch(t,e,r,n){k(t),A(e),C(r,{playerID:"string",credentials:"string"}),await this.post(`/games/${t}/${e}/leave`,{body:r,init:n})}async updatePlayer(t,e,r,n){k(t),A(e),C(r,{playerID:"string",credentials:"string"}),await this.post(`/games/${t}/${e}/update`,{body:r,init:n})}async playAgain(t,e,r,n){return k(t),A(e),C(r,{playerID:"string",credentials:"string"}),this.post(`/games/${t}/${e}/playAgain`,{body:r,init:n})}}var M=r(7378),T=r(3615),R=r.n(T),j=r(1877),B=r(9762);function L(t){var e;let{game:r,numPlayers:n,board:i,multiplayer:s,enhancer:o}=t,{loading:a,debug:c}=t;if(void 0===a){let l=()=>M.createElement("div",{className:"bgio-loading"},"connecting...");a=l}return(e=class extends M.Component{constructor(t){var e;super(t),void 0===c&&(c=t.debug),this.client=(e={game:r,debug:c,numPlayers:n,multiplayer:s,matchID:t.matchID,playerID:t.playerID,credentials:t.credentials,enhancer:o},new b(e))}componentDidMount(){this.unsubscribe=this.client.subscribe(()=>this.forceUpdate()),this.client.start()}componentWillUnmount(){this.client.stop(),this.unsubscribe()}componentDidUpdate(t){this.props.matchID!=t.matchID&&this.client.updateMatchID(this.props.matchID),this.props.playerID!=t.playerID&&this.client.updatePlayerID(this.props.playerID),this.props.credentials!=t.credentials&&this.client.updateCredentials(this.props.credentials)}render(){let t=this.client.getState();if(null===t)return M.createElement(a);let e=null;return i&&(e=M.createElement(i,{...t,...this.props,isMultiplayer:!!s,moves:this.client.moves,events:this.client.events,matchID:this.client.matchID,playerID:this.client.playerID,reset:this.client.reset,undo:this.client.undo,redo:this.client.redo,log:this.client.log,matchData:this.client.matchData,sendChatMessage:this.client.sendChatMessage,chatMessages:this.client.chatMessages})),M.createElement("div",{className:"bgio-client"},e)}}).propTypes={matchID:R().string,playerID:R().string,credentials:R().string,debug:R().any},e.defaultProps={matchID:"default",playerID:null,credentials:null,debug:!0},e}r(9650);class U{constructor({server:t,gameComponents:e,playerName:r,playerCredentials:n}){this.client=new D({server:t}),this.gameComponents=e,this.playerName=r||"Visitor",this.playerCredentials=n,this.matches=[]}async refresh(){try{this.matches=[];let t=await this.client.listGames();for(let e of t){if(!this._getGameComponents(e))continue;let{matches:r}=await this.client.listMatches(e);this.matches.push(...r)}}catch(n){throw Error("failed to retrieve list of matches ("+n+")")}}_getMatchInstance(t){for(let e of this.matches)if(e.matchID===t)return e}_getGameComponents(t){for(let e of this.gameComponents)if(e.game.name===t)return e}_findPlayer(t){for(let e of this.matches)if(e.players.some(e=>e.name===t))return e}async join(t,e,r){try{let n=this._findPlayer(this.playerName);if(n)throw Error("player has already joined "+n.matchID);if(!(n=this._getMatchInstance(e)))throw Error("game instance "+e+" not found");let i=await this.client.joinMatch(t,e,{playerID:r,playerName:this.playerName});n.players[Number.parseInt(r)].name=this.playerName,this.playerCredentials=i.playerCredentials}catch(s){throw Error("failed to join match "+e+" ("+s+")")}}async leave(t,e){try{let r=this._getMatchInstance(e);if(!r)throw Error("match instance not found");for(let n of r.players)if(n.name===this.playerName){await this.client.leaveMatch(t,e,{playerID:n.id.toString(),credentials:this.playerCredentials}),delete n.name,delete this.playerCredentials;return}throw Error("player not found in match")}catch(i){throw Error("failed to leave match "+e+" ("+i+")")}}async disconnect(){let t=this._findPlayer(this.playerName);t&&await this.leave(t.gameName,t.matchID),this.matches=[],this.playerName="Visitor"}async create(t,e){try{let r=this._getGameComponents(t);if(!r)throw Error("game not found");if(e<r.game.minPlayers||e>r.game.maxPlayers)throw Error("invalid number of players "+e);await this.client.createMatch(t,{numPlayers:e})}catch(n){throw Error("failed to create match for "+t+" ("+n+")")}}}class $ extends M.Component{constructor(){super(...arguments),this.state={playerName:this.props.playerName,nameErrorMsg:""},this.onClickEnter=()=>{""!==this.state.playerName&&this.props.onEnter(this.state.playerName)},this.onKeyPress=t=>{"Enter"===t.key&&this.onClickEnter()},this.onChangePlayerName=t=>{let e=t.target.value.trim();this.setState({playerName:e,nameErrorMsg:e.length>0?"":"empty player name"})}}render(){return M.createElement("div",null,M.createElement("p",{className:"phase-title"},"Choose a player name:"),M.createElement("input",{type:"text",value:this.state.playerName,onChange:this.onChangePlayerName,onKeyPress:this.onKeyPress}),M.createElement("span",{className:"buttons"},M.createElement("button",{className:"buttons",onClick:this.onClickEnter},"Enter")),M.createElement("br",null),M.createElement("span",{className:"error-msg"},this.state.nameErrorMsg,M.createElement("br",null)))}}$.defaultProps={playerName:""};class G extends M.Component{constructor(){super(...arguments),this._createSeat=t=>t.name||"[free]",this._createButtonJoin=(t,e)=>M.createElement("button",{key:"button-join-"+t.matchID,onClick:()=>this.props.onClickJoin(t.gameName,t.matchID,""+e)},"Join"),this._createButtonLeave=t=>M.createElement("button",{key:"button-leave-"+t.matchID,onClick:()=>this.props.onClickLeave(t.gameName,t.matchID)},"Leave"),this._createButtonPlay=(t,e)=>M.createElement("button",{key:"button-play-"+t.matchID,onClick:()=>this.props.onClickPlay(t.gameName,{matchID:t.matchID,playerID:""+e,numPlayers:t.players.length})},"Play"),this._createButtonSpectate=t=>M.createElement("button",{key:"button-spectate-"+t.matchID,onClick:()=>this.props.onClickPlay(t.gameName,{matchID:t.matchID,numPlayers:t.players.length})},"Spectate"),this._createInstanceButtons=t=>{let e=t.players.find(t=>t.name===this.props.playerName),r=t.players.find(t=>!t.name);return e&&r?this._createButtonLeave(t):r?this._createButtonJoin(t,r.id):e?M.createElement("div",null,[this._createButtonPlay(t,e.id),this._createButtonLeave(t)]):this._createButtonSpectate(t)}}render(){let t=this.props.match,e="OPEN";return t.players.some(t=>!t.name)||(e="RUNNING"),M.createElement("tr",{key:"line-"+t.matchID},M.createElement("td",{key:"cell-name-"+t.matchID},t.gameName),M.createElement("td",{key:"cell-status-"+t.matchID},e),M.createElement("td",{key:"cell-seats-"+t.matchID},t.players.map(t=>this._createSeat(t)).join(", ")),M.createElement("td",{key:"cell-buttons-"+t.matchID},this._createInstanceButtons(t)))}}class F extends M.Component{constructor(t){for(let e of(super(t),this.state={selectedGame:0,numPlayers:2},this._createGameNameOption=(t,e)=>M.createElement("option",{key:"name-option-"+e,value:e},t.game.name),this._createNumPlayersOption=t=>M.createElement("option",{key:"num-option-"+t,value:t},t),this._createNumPlayersRange=t=>Array.from({length:t.maxPlayers+1}).map((t,e)=>e).slice(t.minPlayers),this.onChangeNumPlayers=t=>{this.setState({numPlayers:Number.parseInt(t.target.value)})},this.onChangeSelectedGame=t=>{let e=Number.parseInt(t.target.value);this.setState({selectedGame:e,numPlayers:this.props.games[e].game.minPlayers})},this.onClickCreate=()=>{this.props.createMatch(this.props.games[this.state.selectedGame].game.name,this.state.numPlayers)},t.games)){let r=e.game;r.minPlayers||(r.minPlayers=1),r.maxPlayers||(r.maxPlayers=4),console.assert(r.maxPlayers>=r.minPlayers)}this.state={selectedGame:0,numPlayers:t.games[0].game.minPlayers}}render(){return M.createElement("div",null,M.createElement("select",{value:this.state.selectedGame,onChange:t=>this.onChangeSelectedGame(t)},this.props.games.map((t,e)=>this._createGameNameOption(t,e))),M.createElement("span",null,"Players:"),M.createElement("select",{value:this.state.numPlayers,onChange:this.onChangeNumPlayers},this._createNumPlayersRange(this.props.games[this.state.selectedGame].game).map(t=>this._createNumPlayersOption(t))),M.createElement("span",{className:"buttons"},M.createElement("button",{onClick:this.onClickCreate},"Create")))}}(i=s||(s={})).ENTER="enter",i.PLAY="play",i.LIST="list";class q extends M.Component{constructor(t){super(t),this.state={phase:s.ENTER,playerName:"Visitor",runningMatch:null,errorMsg:"",credentialStore:{}},this._createConnection=t=>{var e;let r=this.state.playerName;this.connection=(e={server:t.lobbyServer,gameComponents:t.gameComponents,playerName:r,playerCredentials:this.state.credentialStore[r]},new U(e))},this._updateCredentials=(t,e)=>{this.setState(r=>{let n=Object.assign({},r.credentialStore);return n[t]=e,{credentialStore:n}})},this._updateConnection=async()=>{await this.connection.refresh(),this.forceUpdate()},this._enterLobby=t=>{this._startRefreshInterval(),this.setState({playerName:t,phase:s.LIST})},this._exitLobby=async()=>{this._clearRefreshInterval(),await this.connection.disconnect(),this.setState({phase:s.ENTER,errorMsg:""})},this._createMatch=async(t,e)=>{try{await this.connection.create(t,e),await this.connection.refresh(),this.setState({})}catch(r){this.setState({errorMsg:r.message})}},this._joinMatch=async(t,e,r)=>{try{await this.connection.join(t,e,r),await this.connection.refresh(),this._updateCredentials(this.connection.playerName,this.connection.playerCredentials)}catch(n){this.setState({errorMsg:n.message})}},this._leaveMatch=async(t,e)=>{try{await this.connection.leave(t,e),await this.connection.refresh(),this._updateCredentials(this.connection.playerName,this.connection.playerCredentials)}catch(r){this.setState({errorMsg:r.message})}},this._startMatch=(t,e)=>{let r;let n=this.connection._getGameComponents(t);if(!n){this.setState({errorMsg:"game "+t+" not supported"});return}if(e.numPlayers>1&&(r=this.props.gameServer?(0,B.S)({server:this.props.gameServer}):(0,B.S)()),1==e.numPlayers){let i=n.game.maxPlayers,o={};for(let a=1;a<i;a++)o[a+""]=S.M;r=(0,B.L)({bots:o})}let c=this.props.clientFactory({game:n.game,board:n.board,debug:this.props.debug,multiplayer:r}),l={app:c,matchID:e.matchID,playerID:e.numPlayers>1?e.playerID:"0",credentials:this.connection.playerCredentials};this._clearRefreshInterval(),this.setState({phase:s.PLAY,runningMatch:l})},this._exitMatch=()=>{this._startRefreshInterval(),this.setState({phase:s.LIST,runningMatch:null})},this._getPhaseVisibility=t=>this.state.phase!==t?"hidden":"phase",this.renderMatches=(t,e)=>t.map(t=>{let{matchID:r,gameName:n,players:i}=t;return M.createElement(G,{key:"instance-"+r,match:{matchID:r,gameName:n,players:Object.values(i)},playerName:e,onClickJoin:this._joinMatch,onClickLeave:this._leaveMatch,onClickPlay:this._startMatch})}),this._createConnection(this.props)}componentDidMount(){let t=j.ZP.load("lobbyState")||{};t.phase&&t.phase===s.PLAY&&(t.phase=s.LIST),t.phase&&t.phase!==s.ENTER&&this._startRefreshInterval(),this.setState({phase:t.phase||s.ENTER,playerName:t.playerName||"Visitor",credentialStore:t.credentialStore||{}})}componentDidUpdate(t,e){let r=this.state.playerName,n=this.state.credentialStore[r];if(e.phase!==this.state.phase||e.credentialStore[r]!==n||e.playerName!==r){this._createConnection(this.props),this._updateConnection();let i={phase:this.state.phase,playerName:r,credentialStore:this.state.credentialStore};j.ZP.save("lobbyState",i,{path:"/"})}t.refreshInterval!==this.props.refreshInterval&&this._startRefreshInterval()}componentWillUnmount(){this._clearRefreshInterval()}_startRefreshInterval(){this._clearRefreshInterval(),this._currentInterval=setInterval(this._updateConnection,this.props.refreshInterval)}_clearRefreshInterval(){clearInterval(this._currentInterval)}render(){let{gameComponents:t,renderer:e}=this.props,{errorMsg:r,playerName:n,phase:i,runningMatch:o}=this.state;return e?e({errorMsg:r,gameComponents:t,matches:this.connection.matches,phase:i,playerName:n,runningMatch:o,handleEnterLobby:this._enterLobby,handleExitLobby:this._exitLobby,handleCreateMatch:this._createMatch,handleJoinMatch:this._joinMatch,handleLeaveMatch:this._leaveMatch,handleExitMatch:this._exitMatch,handleRefreshMatches:this._updateConnection,handleStartMatch:this._startMatch}):M.createElement("div",{id:"lobby-view",style:{padding:50}},M.createElement("div",{className:this._getPhaseVisibility(s.ENTER)},M.createElement($,{key:n,playerName:n,onEnter:this._enterLobby})),M.createElement("div",{className:this._getPhaseVisibility(s.LIST)},M.createElement("p",null,"Welcome, ",n),M.createElement("div",{className:"phase-title",id:"match-creation"},M.createElement("span",null,"Create a match:"),M.createElement(F,{games:t,createMatch:this._createMatch})),M.createElement("p",{className:"phase-title"},"Join a match:"),M.createElement("div",{id:"instances"},M.createElement("table",null,M.createElement("tbody",null,this.renderMatches(this.connection.matches,n))),M.createElement("span",{className:"error-msg"},r,M.createElement("br",null))),M.createElement("p",{className:"phase-title"},"Matches that become empty are automatically deleted.")),M.createElement("div",{className:this._getPhaseVisibility(s.PLAY)},o&&M.createElement(o.app,{matchID:o.matchID,playerID:o.playerID,credentials:o.credentials}),M.createElement("div",{className:"buttons",id:"match-exit"},M.createElement("button",{onClick:this._exitMatch},"Exit match"))),M.createElement("div",{className:"buttons",id:"lobby-exit"},M.createElement("button",{onClick:this._exitLobby},"Exit lobby")))}}q.propTypes={gameComponents:R().array.isRequired,lobbyServer:R().string,gameServer:R().string,debug:R().bool,clientFactory:R().func,refreshInterval:R().number},q.defaultProps={debug:!1,clientFactory:L,refreshInterval:2e3}},8754:function(t,e,r){"use strict";r.d(e,{C:function(){return b},I:function(){return u},P:function(){return l},T:function(){return v}});var n,i,s,o,a=r(5488),c=r(3979);function l(t){if(void 0!==t.processMove)return t;if(void 0===t.name&&(t.name="default"),void 0===t.deltaState&&(t.deltaState=!1),void 0===t.disableUndo&&(t.disableUndo=!1),void 0===t.setup&&(t.setup=()=>({})),void 0===t.moves&&(t.moves={}),void 0===t.playerView&&(t.playerView=({G:t})=>t),void 0===t.plugins&&(t.plugins=[]),t.plugins.forEach(t=>{if(void 0===t.name)throw Error("Plugin missing name attribute");if(t.name.includes(" "))throw Error(t.name+": Plugin name must not include spaces")}),t.name.includes(" "))throw Error(t.name+": Game name must not include spaces");let e=function({moves:t,phases:e,endIf:r,onEnd:n,turn:i,events:s,plugins:o}){void 0===t&&(t={}),void 0===s&&(s={}),void 0===o&&(o=[]),void 0===e&&(e={}),r||(r=()=>void 0),n||(n=({G:t})=>t),i||(i={});let c={...e};""in c&&(0,a.e)("cannot specify phase with empty name"),c[""]={};let l={},u=new Set,h=null;Object.keys(t).forEach(t=>u.add(t));let p=(t,e)=>{let r=(0,a.F)(t,e,o);return t=>{let e=(0,a.a)(t);return r({...e,G:t.G,ctx:t.ctx,playerID:t.playerID})}},f=t=>e=>{let r=(0,a.a)(e);return t({...r,G:e.G,ctx:e.ctx})},d={onEnd:p(n,a.G.GAME_ON_END),endIf:f(r)};for(let y in c){let m=c[y];if(!0===m.start&&(h=y),void 0!==m.moves)for(let g of Object.keys(m.moves))l[y+"."+g]=m.moves[g],u.add(g);for(let v in void 0===m.endIf&&(m.endIf=()=>void 0),void 0===m.onBegin&&(m.onBegin=({G:t})=>t),void 0===m.onEnd&&(m.onEnd=({G:t})=>t),void 0===m.turn&&(m.turn=i),void 0===m.turn.order&&(m.turn.order=a.T.DEFAULT),void 0===m.turn.onBegin&&(m.turn.onBegin=({G:t})=>t),void 0===m.turn.onEnd&&(m.turn.onEnd=({G:t})=>t),void 0===m.turn.endIf&&(m.turn.endIf=()=>!1),void 0===m.turn.onMove&&(m.turn.onMove=({G:t})=>t),void 0===m.turn.stages&&(m.turn.stages={}),(0,a.b)(m.turn,!0),m.turn.stages){let b=m.turn.stages[v],w=b.moves||{};for(let E of Object.keys(w)){let O=y+"."+v+"."+E;l[O]=w[E],u.add(E)}}if(m.wrapped={onBegin:p(m.onBegin,a.G.PHASE_ON_BEGIN),onEnd:p(m.onEnd,a.G.PHASE_ON_END),endIf:f(m.endIf)},m.turn.wrapped={onMove:p(m.turn.onMove,a.G.TURN_ON_MOVE),onBegin:p(m.turn.onBegin,a.G.TURN_ON_BEGIN),onEnd:p(m.turn.onEnd,a.G.TURN_ON_END),endIf:f(m.turn.endIf)},"function"!=typeof m.next){let{next:P}=m;m.next=()=>P||null}m.wrapped.next=f(m.next)}function x(t){return t.phase?c[t.phase]:c[""]}function I(t){return t}function S(t,e){let r=new Set,n=new Set;for(let i=0;i<e.length;i++){var s;let{fn:o,arg:a,...c}=e[i];if(o===R){n.clear();let l=t.ctx.phase;if(r.has(l)){let u={...t.ctx,phase:null};return{...t,ctx:u}}r.add(l)}let h=[];if(t=o(t,{...c,arg:a,next:h}),o===T)break;let p=(s=t,d.endIf(s));if(p){e.push({fn:T,arg:p,turn:t.ctx.turn,phase:t.ctx.phase,automatic:!0});continue}let f=function(t){let e=x(t.ctx);return e.wrapped.endIf(t)}(t);if(f){e.push({fn:R,arg:f,turn:t.ctx.turn,phase:t.ctx.phase,automatic:!0});continue}if([I,D,M].includes(o)){let y=function(t){let e=x(t.ctx),r=t.ctx.numMoves||0;return!!e.turn.maxMoves&&r>=e.turn.maxMoves||e.turn.wrapped.endIf(t)}(t);if(y){e.push({fn:j,arg:y,turn:t.ctx.turn,phase:t.ctx.phase,automatic:!0});continue}}e.push(...h)}return t}function _(t,{next:e}){return e.push({fn:k}),t}function k(t,{next:e}){let{G:r,ctx:n}=t,i=x(n);return r=i.wrapped.onBegin(t),e.push({fn:A}),{...t,G:r,ctx:n}}function A(t,{currentPlayer:e}){let{ctx:r}=t,n=x(r);e?(r={...r,currentPlayer:e},n.turn.activePlayers&&(r=(0,a.c)(r,n.turn.activePlayers))):r=(0,a.I)(t,n.turn);let i=r.turn+1;r={...r,turn:i,numMoves:0,_prevActivePlayers:[]};let s=n.turn.wrapped.onBegin({...t,ctx:r});return{...t,G:s,ctx:r,_undo:[],_redo:[]}}function C(t,{arg:e,next:r,phase:n}){let i=x({phase:n}),{ctx:s}=t;if(e&&e.next){if(!(e.next in c))return(0,a.e)("invalid phase: "+e.next),t;s={...s,phase:e.next}}else s={...s,phase:i.wrapped.next(t)||null};return t={...t,ctx:s},r.push({fn:k}),t}function N(t,{arg:e,currentPlayer:r,next:n}){let{G:i,ctx:s}=t,o=x(s),{endPhase:c,ctx:l}=(0,a.U)(t,r,o.turn,e);return s=l,t={...t,G:i,ctx:s},c?n.push({fn:R,turn:s.turn,phase:s.phase}):n.push({fn:A,currentPlayer:s.currentPlayer}),t}function D(t,{arg:e,playerID:r}){if(("string"==typeof e||e===a.S.NULL)&&(e={stage:e}),"object"!=typeof e)return t;(0,a.b)(e);let{ctx:n}=t,{activePlayers:i,_activePlayersMinMoves:s,_activePlayersMaxMoves:o,_activePlayersNumMoves:c}=n;return void 0!==e.stage&&(null===i&&(i={}),i[r]=e.stage,c[r]=0,e.minMoves&&(null===s&&(s={}),s[r]=e.minMoves),e.maxMoves&&(null===o&&(o={}),o[r]=e.maxMoves)),n={...n,activePlayers:i,_activePlayersMinMoves:s,_activePlayersMaxMoves:o,_activePlayersNumMoves:c},{...t,ctx:n}}function M(t,{arg:e}){return{...t,ctx:(0,a.c)(t.ctx,e)}}function T(t,{arg:e,phase:r}){t=R(t,{phase:r}),void 0===e&&(e=!0),t={...t,ctx:{...t.ctx,gameover:e}};let n=d.onEnd(t);return{...t,G:n}}function R(t,{arg:e,next:r,turn:n,automatic:i}){t=j(t,{turn:n,force:!0,automatic:!0});let{phase:s,turn:o}=t.ctx;if(r&&r.push({fn:C,arg:e,phase:s}),null===s)return t;let c=x(t.ctx),l=c.wrapped.onEnd(t),u={...t.ctx,phase:null},h=(0,a.g)("endPhase",e),{_stateID:p}=t,f={action:h,_stateID:p,turn:o,phase:s};i&&(f.automatic=!0);let d=[...t.deltalog||[],f];return{...t,G:l,ctx:u,deltalog:d}}function j(t,{arg:e,next:r,turn:n,force:i,automatic:s,playerID:o}){if(n!==t.ctx.turn)return t;let{currentPlayer:c,numMoves:l,phase:u,turn:h}=t.ctx,p=x(t.ctx);if(!i&&p.turn.minMoves&&(l||0)<p.turn.minMoves)return(0,a.i)(`cannot end turn before making ${p.turn.minMoves} moves`),t;let f=p.turn.wrapped.onEnd(t);r&&r.push({fn:N,arg:e,currentPlayer:c});let d={...t.ctx,activePlayers:null};if(e&&e.remove){o=o||c;let y=d.playOrder.filter(t=>t!=o),m=d.playOrderPos>y.length-1?0:d.playOrderPos;if(d={...d,playOrder:y,playOrderPos:m},0===y.length)return r.push({fn:R,turn:h,phase:u}),t}let g=(0,a.g)("endTurn",e),{_stateID:v}=t,b={action:g,_stateID:v,turn:h,phase:u};s&&(b.automatic=!0);let w=[...t.deltalog||[],b];return{...t,G:f,ctx:d,deltalog:w,_undo:[],_redo:[]}}function B(t,{arg:e,next:r,automatic:n,playerID:i}){i=i||t.ctx.currentPlayer;let{ctx:s,_stateID:o}=t,{activePlayers:c,_activePlayersNumMoves:l,_activePlayersMinMoves:u,_activePlayersMaxMoves:h,phase:p,turn:f}=s,d=null!==c&&i in c,y=x(s);if(!e&&d){let m=y.turn.stages[c[i]];m&&m.next&&(e=m.next)}if(r&&r.push({fn:D,arg:e,playerID:i}),!d)return t;let g=l[i]||0;if(u&&u[i]&&g<u[i])return(0,a.i)(`cannot end stage before making ${u[i]} moves`),t;delete(c={...c})[i],u&&delete(u={...u})[i],h&&delete(h={...h})[i],s=(0,a.d)({...s,activePlayers:c,_activePlayersMinMoves:u,_activePlayersMaxMoves:h});let v=(0,a.g)("endStage",e),b={action:v,_stateID:o,turn:f,phase:p};n&&(b.automatic=!0);let w=[...t.deltalog||[],b];return{...t,ctx:s,deltalog:w}}function L(e,r,n){let i=x(e),s=i.turn.stages,{activePlayers:o}=e;if(o&&void 0!==o[n]&&o[n]!==a.S.NULL&&void 0!==s[o[n]]&&void 0!==s[o[n]].moves){let c=s[o[n]],l=c.moves;if(r in l)return l[r]}else if(i.moves){if(r in i.moves)return i.moves[r]}else if(r in t)return t[r];return null}let U={endStage:function(t,e){return S(t,[{fn:B,playerID:e}])},setStage:function(t,e,r){return S(t,[{fn:B,arg:r,playerID:e}])},endTurn:function(t,e,r){return S(t,[{fn:j,turn:t.ctx.turn,phase:t.ctx.phase,arg:r}])},pass:function(t,e,r){return S(t,[{fn:j,turn:t.ctx.turn,phase:t.ctx.phase,force:!0,arg:r}])},endPhase:function(t){return S(t,[{fn:R,phase:t.ctx.phase,turn:t.ctx.turn}])},setPhase:function(t,e,r){return S(t,[{fn:R,phase:t.ctx.phase,turn:t.ctx.turn,arg:{next:r}}])},endGame:function(t,e,r){return S(t,[{fn:T,turn:t.ctx.turn,phase:t.ctx.phase,arg:r}])},setActivePlayers:function(t,e,r){return S(t,[{fn:M,arg:r}])}},$=[];return!1!==s.endTurn&&$.push("endTurn"),!1!==s.pass&&$.push("pass"),!1!==s.endPhase&&$.push("endPhase"),!1!==s.setPhase&&$.push("setPhase"),!1!==s.endGame&&$.push("endGame"),!1!==s.setActivePlayers&&$.push("setActivePlayers"),!1!==s.endStage&&$.push("endStage"),!1!==s.setStage&&$.push("setStage"),{ctx:t=>({numPlayers:t,turn:0,currentPlayer:"0",playOrder:[...Array.from({length:t})].map((t,e)=>e+""),playOrderPos:0,phase:h,activePlayers:null}),init:t=>S(t,[{fn:_}]),isPlayerActive:function(t,e,r){return e.activePlayers?r in e.activePlayers:e.currentPlayer===r},eventHandlers:U,eventNames:Object.keys(U),enabledEventNames:$,moveMap:l,moveNames:[...u.values()],processMove:function(t,e){let{playerID:r,type:n}=e,{currentPlayer:i,activePlayers:s,_activePlayersMaxMoves:o}=t.ctx,a=L(t.ctx,n,r),c=!a||"function"==typeof a||!0!==a.noLimit,{numMoves:l,_activePlayersNumMoves:u}=t.ctx;c&&(r===i&&l++,s&&u[r]++),t={...t,ctx:{...t.ctx,numMoves:l,_activePlayersNumMoves:u}},o&&u[r]>=o[r]&&(t=B(t,{playerID:r,automatic:!0}));let h=x(t.ctx),p=h.turn.wrapped.onMove({...t,playerID:r});return S(t={...t,G:p},[{fn:I}])},processEvent:function(t,e){let{type:r,playerID:n,args:i}=e.payload;return"function"!=typeof U[r]?t:U[r](t,n,...Array.isArray(i)?i:[i])},getMove:L}}(t);return{...t,flow:e,moveNames:e.moveNames,pluginNames:t.plugins.map(t=>t.name),processMove(r,n){let i=e.getMove(r.ctx,n.type,n.playerID);if(u(i)&&(i=i.move),i instanceof Function){let s=(0,a.F)(i,a.G.MOVE,t.plugins),o=[];void 0!==n.args&&(o=Array.isArray(n.args)?n.args:[n.args]);let c={...(0,a.a)(r),G:r.G,ctx:r.ctx,playerID:n.playerID};return s(c,...o)}return(0,a.e)(`invalid move object: ${n.type}`),r.G}}}function u(t){return t instanceof Object&&void 0!==t.move}(n=s||(s={})).UnauthorizedAction="update/unauthorized_action",n.MatchNotFound="update/match_not_found",n.PatchFailed="update/patch_failed",(i=o||(o={})).StaleStateId="action/stale_state_id",i.UnavailableMove="action/unavailable_move",i.InvalidMove="action/invalid_move",i.InactivePlayer="action/inactive_player",i.GameOver="action/gameover",i.ActionDisabled="action/action_disabled",i.ActionInvalid="action/action_invalid",i.PluginActionInvalid="action/plugin_invalid";let h=t=>null!==t.payload.playerID&&void 0!==t.payload.playerID,p=(t,e,r)=>void 0===r.undoable||(r.undoable instanceof Function?r.undoable({G:t,ctx:e}):r.undoable);function f(t,e){if(e.game.disableUndo)return t;let r={G:t.G,ctx:t.ctx,plugins:t.plugins,playerID:e.action.payload.playerID||t.ctx.currentPlayer};return"MAKE_MOVE"===e.action.type&&(r.moveType=e.action.payload.type),{...t,_undo:[...t._undo,r],_redo:[]}}function d(t,e,r){let n={action:e,_stateID:t._stateID,turn:t.ctx.turn,phase:t.ctx.phase},i=t.plugins.log.data.metadata;return void 0!==i&&(n.metadata=i),"object"==typeof r&&!0===r.redact?n.redact=!0:"object"==typeof r&&r.redact instanceof Function&&(n.redact=r.redact({G:t.G,ctx:t.ctx})),{...t,deltalog:[n]}}function y(t,e,r){let[n,i]=(0,a.q)(t,r);return i?[n,g(e,o.PluginActionInvalid,i)]:[n]}function m(t){if(!t)return[null,void 0];let{transients:e,...r}=t;return[r,e]}function g(t,e,r){return{...t,transients:{error:{type:e,payload:r}}}}let v=t=>e=>r=>{let n=e(r);if(r.type===a.p)return n;{let[,i]=m(t.getState());return void 0!==i?(t.dispatch((0,a.r)()),{...n,transients:i}):n}};function b({game:t,isClient:e}){return t=l(t),(r=null,n)=>{let[i]=m(r);switch(n.type){case a.p:return i;case a.o:{let l;if(i={...i,deltalog:[]},e)return i;if(void 0!==i.ctx.gameover)return(0,a.e)("cannot call event after game end"),g(i,o.GameOver);if(h(n)&&!t.flow.isPlayerActive(i.G,i.ctx,n.payload.playerID))return(0,a.e)(`disallowed event: ${n.payload.type}`),g(i,o.InactivePlayer);i=(0,a.E)(i,{game:t,isClient:!1,playerID:n.payload.playerID});let u=t.flow.processEvent(i,n);if([u,l]=y(u,i,{game:t,isClient:!1}),l)return l;return{...u=f(u,{game:t,action:n}),_stateID:i._stateID+1}}case a.M:{let v;let b=i={...i,deltalog:[]},w=t.flow.getMove(i.ctx,n.payload.type,n.payload.playerID||i.ctx.currentPlayer);if(null===w)return(0,a.e)(`disallowed move: ${n.payload.type}`),g(i,o.UnavailableMove);if(e&&!1===w.client)return i;if(void 0!==i.ctx.gameover)return(0,a.e)("cannot make move after game end"),g(i,o.GameOver);if(h(n)&&!t.flow.isPlayerActive(i.G,i.ctx,n.payload.playerID))return(0,a.e)(`disallowed move: ${n.payload.type}`),g(i,o.InactivePlayer);i=(0,a.E)(i,{game:t,isClient:e,playerID:n.payload.playerID});let E=t.processMove(i,n.payload);if(E===a.n)return(0,a.e)(`invalid move: ${n.payload.type} args: ${n.payload.args}`),g(i,o.InvalidMove);let O={...i,G:E};if(e&&(0,a.N)(O,{game:t}))return i;if(i=O,e){let P;if([i,P]=y(i,b,{game:t,isClient:!0}),P)return P;return{...i,_stateID:i._stateID+1}}if(i=d(i,n,w),i=t.flow.processMove(i,n.payload),[i,v]=y(i,b,{game:t}),v)return v;return{...i=f(i,{game:t,action:n}),_stateID:i._stateID+1}}case a.m:case a.l:case a.k:return n.state;case a.j:{if(i={...i,deltalog:[]},t.disableUndo)return(0,a.e)("Undo is not enabled"),g(i,o.ActionDisabled);let{G:x,ctx:I,_undo:S,_redo:_,_stateID:k}=i;if(S.length<2)return(0,a.e)("No moves to undo"),g(i,o.ActionInvalid);let A=S[S.length-1],C=S[S.length-2];if(h(n)&&n.payload.playerID!==A.playerID)return(0,a.e)("Cannot undo other players' moves"),g(i,o.ActionInvalid);if(A.moveType){let N=t.flow.getMove(C.ctx,A.moveType,A.playerID);if(!p(x,I,N))return(0,a.e)("Move cannot be undone"),g(i,o.ActionInvalid)}return{...i=d(i,n),G:C.G,ctx:C.ctx,plugins:C.plugins,_stateID:k+1,_undo:S.slice(0,-1),_redo:[A,..._]}}case a.R:{if(i={...i,deltalog:[]},t.disableUndo)return(0,a.e)("Redo is not enabled"),g(i,o.ActionDisabled);let{_undo:D,_redo:M,_stateID:T}=i;if(0===M.length)return(0,a.e)("No moves to redo"),g(i,o.ActionInvalid);let R=M[0];if(h(n)&&n.payload.playerID!==R.playerID)return(0,a.e)("Cannot redo other players' moves"),g(i,o.ActionInvalid);return{...i=d(i,n),G:R.G,ctx:R.ctx,plugins:R.plugins,_stateID:T+1,_undo:[...D,R],_redo:M.slice(1)}}case a.f:return(0,a.h)(i,n,{game:t});case a.P:{let j=i,B=JSON.parse(JSON.stringify(j)),L=(0,c.af)(B,n.patch),U=L.some(t=>null!==t);if(U)return(0,a.e)(`Patch ${JSON.stringify(n.patch)} apply failed`),g(j,s.PatchFailed,L);return B}default:return i}}}},9762:function(t,e,r){"use strict";r.d(e,{L:function(){return k},S:function(){return N}});var n,i,s=r(4958),o=r(3243);function a(t){return t.type()===i.SYNC}(n=i||(i={}))[n.SYNC=0]="SYNC",n[n.ASYNC=1]="ASYNC";class c{type(){return i.SYNC}connect(){}createMatch(t,e){if(this.createGame)return console.warn("The database connector does not implement a createMatch method.","\nUsing the deprecated createGame method instead."),this.createGame(t,e);console.error("The database connector does not implement a createMatch method.")}listMatches(t){if(this.listGames)return console.warn("The database connector does not implement a listMatches method.","\nUsing the deprecated listGames method instead."),this.listGames(t);console.error("The database connector does not implement a listMatches method.")}}let l=({game:t,unlisted:e,setupData:r,numPlayers:n})=>{let i={gameName:t.name,unlisted:!!e,players:{},createdAt:Date.now(),updatedAt:Date.now()};void 0!==r&&(i.setupData=r);for(let s=0;s<n;s++)i.players[s]={id:s};return i},u=({game:t,numPlayers:e,setupData:r,unlisted:n})=>{e&&"number"==typeof e||(e=2);let i=t.validateSetupData&&t.validateSetupData(r,e);if(void 0!==i)return{setupDataError:i};let s=l({game:t,numPlayers:e,setupData:r,unlisted:n}),a=(0,o.I)({game:t,numPlayers:e,setupData:r});return{metadata:s,initialState:a}};var h=r(5240),p=r(5488),f=r(8754);let d=t=>Object.values(t.players).map(t=>{let{credentials:e,...r}=t;return r}),y=t=>{let{credentials:e,...r}=t.payload;return{...t,payload:r}};class m{constructor(t,e,r,n){this.game=(0,f.P)(t),this.storageAPI=e,this.transportAPI=r,this.subscribeCallback=()=>{},this.auth=n}subscribe(t){this.subscribeCallback=t}async onUpdate(t,e,r,n){let i,s,o;if(!t||!t.payload)return{error:"missing action or action payload"};if(a(this.storageAPI)?{metadata:i}=this.storageAPI.fetch(r,{metadata:!0}):{metadata:i}=await this.storageAPI.fetch(r,{metadata:!0}),this.auth){let c=await this.auth.authenticateCredentials({playerID:n,credentials:t.payload.credentials,metadata:i});if(!c)return{error:"unauthorized action"}}let l=y(t);if(a(this.storageAPI)?{state:s}=this.storageAPI.fetch(r,{state:!0}):{state:s}=await this.storageAPI.fetch(r,{state:!0}),void 0===s)return(0,p.e)(`game not found, matchID=[${r}]`),{error:"game not found"};if(void 0!==s.ctx.gameover){(0,p.e)(`game over - matchID=[${r}] - playerID=[${n}] - action[${l.payload.type}]`);return}let u=(0,f.C)({game:this.game}),d=(0,h.md)(f.T),m=(0,h.MT)(u,s,d);if(l.type==p.j||l.type==p.R){let g=null!==s.ctx.activePlayers,v=s.ctx.currentPlayer===n;if(!g&&!v||g&&(void 0===s.ctx.activePlayers[n]||Object.keys(s.ctx.activePlayers).length>1)){(0,p.e)(`playerID=[${n}] cannot undo / redo right now`);return}}if(!this.game.flow.isPlayerActive(s.G,s.ctx,n)){(0,p.e)(`player not active - playerID=[${n}] - action[${l.payload.type}]`);return}let b=l.type==p.M?this.game.flow.getMove(s.ctx,l.payload.type,n):null;if(l.type==p.M&&!b){(0,p.e)(`move not processed - canPlayerMakeMove=false - playerID=[${n}] - action[${l.payload.type}]`);return}if(s._stateID!==e&&!(b&&(0,f.I)(b)&&b.ignoreStaleStateID)){(0,p.e)(`invalid stateID, was=[${e}], expected=[${s._stateID}] - playerID=[${n}] - action[${l.payload.type}]`);return}let w=m.getState();m.dispatch(l),s=m.getState(),this.subscribeCallback({state:s,action:l,matchID:r}),this.game.deltaState?this.transportAPI.sendAll({type:"patch",args:[r,e,w,s]}):this.transportAPI.sendAll({type:"update",args:[r,s]});let{deltalog:E,...O}=s;if(i&&(void 0===i.gameover||null===i.gameover)&&(o={...i,updatedAt:Date.now()},void 0!==s.ctx.gameover&&(o.gameover=s.ctx.gameover)),a(this.storageAPI))this.storageAPI.setState(r,O,E),o&&this.storageAPI.setMetadata(r,o);else{let P=[this.storageAPI.setState(r,O,E)];o&&P.push(this.storageAPI.setMetadata(r,o)),await Promise.all(P)}}async onSync(t,e,r,n=2){let i={state:!0,metadata:!0,log:!0,initialState:!0},s=a(this.storageAPI)?this.storageAPI.fetch(t,i):await this.storageAPI.fetch(t,i),{state:o,initialState:c,log:l,metadata:h}=s;if(this.auth&&null!=e){let p=await this.auth.authenticateCredentials({playerID:e,credentials:r,metadata:h});if(!p)return{error:"unauthorized"}}if(void 0===o){let f=u({game:this.game,unlisted:!0,numPlayers:n,setupData:void 0});if("setupDataError"in f)return{error:"game requires setupData"};c=o=f.initialState,h=f.metadata,this.subscribeCallback({state:o,matchID:t}),a(this.storageAPI)?this.storageAPI.createMatch(t,{initialState:c,metadata:h}):await this.storageAPI.createMatch(t,{initialState:c,metadata:h})}let y=h?d(h):void 0,m={state:o,log:l,filteredMetadata:y,initialState:c};this.transportAPI.send({playerID:e,type:"sync",args:[t,m]})}async onConnectionChange(t,e,r,n){let i;if(null==e)return;if(a(this.storageAPI)?{metadata:i}=this.storageAPI.fetch(t,{metadata:!0}):{metadata:i}=await this.storageAPI.fetch(t,{metadata:!0}),void 0===i)return(0,p.e)(`metadata not found for matchID=[${t}]`),{error:"metadata not found"};if(void 0===i.players[e])return(0,p.e)(`Player not in the match, matchID=[${t}] playerID=[${e}]`),{error:"player not in the match"};if(this.auth){let s=await this.auth.authenticateCredentials({playerID:e,credentials:r,metadata:i});if(!s)return{error:"unauthorized"}}i.players[e].isConnected=n;let o=d(i);this.transportAPI.sendAll({type:"matchData",args:[t,o]}),a(this.storageAPI)?this.storageAPI.setMetadata(t,i):await this.storageAPI.setMetadata(t,i)}async onChatMessage(t,e,r){if(this.auth){let{metadata:n}=await this.storageAPI.fetch(t,{metadata:!0});if(!(e&&"string"==typeof e.sender))return{error:"unauthorized"};let i=await this.auth.authenticateCredentials({playerID:e.sender,credentials:r,metadata:n});if(!i)return{error:"unauthorized"}}this.transportAPI.sendAll({type:"chat",args:[t,e]})}}var g=r(3979);let v=(t,e,r)=>({...r,G:t.playerView({G:r.G,ctx:r.ctx,playerID:e}),plugins:(0,p.x)(r,{playerID:e,game:t}),deltalog:void 0,_undo:[],_redo:[]}),b=t=>(e,r)=>{switch(r.type){case"patch":{let[n,i,s,o]=r.args,a=w(o.deltalog,e),c=v(t,e,o),l=o._stateID,u=v(t,e,s),h=(0,g.rh)(u,c);return{type:"patch",args:[n,i,l,h,a]}}case"update":{let[p,f]=r.args,d=w(f.deltalog,e),y=v(t,e,f);return{type:"update",args:[p,y,d]}}case"sync":{let[m,b]=r.args,E=v(t,e,b.state),O=w(b.log,e),P={...b,state:E,log:O};return{type:"sync",args:[m,P]}}default:return r}};function w(t,e){return void 0===t?t:t.map(t=>{if(null!==e&&+e==+t.action.payload.playerID||!0!==t.redact)return t;let r={...t.action.payload,args:null},n={...t,action:{...t.action,payload:r}},{redact:i,...s}=n;return s})}var E=r(9650);class O extends c{constructor(){super(),this.state=new Map,this.initial=new Map,this.metadata=new Map,this.log=new Map}createMatch(t,e){this.initial.set(t,e.initialState),this.setState(t,e.initialState),this.setMetadata(t,e.metadata)}setMetadata(t,e){this.metadata.set(t,e)}setState(t,e,r){if(r&&r.length>0){let n=this.log.get(t)||[];this.log.set(t,[...n,...r])}this.state.set(t,e)}fetch(t,e){let r={};return e.state&&(r.state=this.state.get(t)),e.metadata&&(r.metadata=this.metadata.get(t)),e.log&&(r.log=this.log.get(t)||[]),e.initialState&&(r.initialState=this.initial.get(t)),r}wipe(t){this.state.delete(t),this.metadata.delete(t)}listMatches(t){return[...this.metadata.entries()].filter(([,e])=>{if(!t)return!0;if(void 0!==t.gameName&&e.gameName!==t.gameName)return!1;if(void 0!==t.where){if(void 0!==t.where.isGameover){let r=void 0!==e.gameover;if(r!==t.where.isGameover)return!1}if(void 0!==t.where.updatedBefore&&e.updatedAt>=t.where.updatedBefore||void 0!==t.where.updatedAfter&&e.updatedAt<=t.where.updatedAfter)return!1}return!0}).map(([t])=>t)}}class P extends Map{constructor(t){super(),this.key=t;let e=JSON.parse(localStorage.getItem(this.key))||[];e.forEach(t=>this.set(...t))}sync(){let t=[...this.entries()];localStorage.setItem(this.key,JSON.stringify(t))}set(t,e){return super.set(t,e),this.sync(),this}delete(t){let e=super.delete(t);return this.sync(),e}}class x extends O{constructor(t="bgio"){super();let e=e=>new P(`${t}_${e}`);this.state=e("state"),this.initial=e("initial"),this.metadata=e("metadata"),this.log=e("log")}}class I extends m{constructor({game:t,bots:e,storageKey:r,persist:n}){let i={},s={};if(t&&t.ai&&e)for(let o in e){let a=e[o];s[o]=new a({game:t,enumerate:t.ai.enumerate,seed:t.seed})}let c=({playerID:t,...e})=>{let r=i[t];void 0!==r&&r(l(t,e))},l=b(t),u=n?new x(r):new O;super(t,u,{send:c,sendAll(t){for(let e in i)c({playerID:e,...t})}}),this.connect=(t,e)=>{i[t]=e},this.subscribe(({state:t,matchID:r})=>{if(!e)return;let n=function(t,e){if(void 0!==t.ctx.gameover)return null;if(t.ctx.activePlayers){for(let r of Object.keys(e))if(r in t.ctx.activePlayers)return r}else if(t.ctx.currentPlayer in e)return t.ctx.currentPlayer;return null}(t,s);null!==n&&setTimeout(async()=>{let e=await s[n].play(t,n);await this.onUpdate(e.action,t._stateID,r,e.action.payload.playerID)},100)})}}class S extends s.T{constructor({master:t,...e}){super(e),this.master=t}sendChatMessage(t,e){let r=[t,e,this.credentials];this.master.onChatMessage(...r)}sendAction(t,e){this.master.onUpdate(e,t._stateID,this.matchID,this.playerID)}requestSync(){this.master.onSync(this.matchID,this.playerID,this.credentials,this.numPlayers)}connect(){this.setConnectionStatus(!0),this.master.connect(this.playerID,t=>this.notifyClient(t)),this.requestSync()}disconnect(){this.setConnectionStatus(!1)}updateMatchID(t){this.matchID=t,this.connect()}updatePlayerID(t){this.playerID=t,this.connect()}updateCredentials(t){this.credentials=t,this.connect()}}let _=new Map;function k({bots:t,persist:e,storageKey:r}={}){return n=>{let i;let{gameKey:s,game:o}=n,a=_.get(s);return a&&a.bots===t&&a.storageKey===r&&a.persist===e&&(i=a.master),i||(i=new I({game:o,bots:t,persist:e,storageKey:r}),_.set(s,{master:i,bots:t,persist:e,storageKey:r})),new S({master:i,...n})}}let A=E.ZP;class C extends s.T{constructor({socket:t,socketOpts:e,server:r,...n}){super(n),this.server=r,this.socket=t,this.socketOpts=e}sendAction(t,e){let r=[e,t._stateID,this.matchID,this.playerID];this.socket.emit("update",...r)}sendChatMessage(t,e){let r=[t,e,this.credentials];this.socket.emit("chat",...r)}connect(){if(!this.socket){if(this.server){let t=this.server;-1==t.search(/^https?:\/\//)&&(t="http://"+this.server),"/"!=t.slice(-1)&&(t+="/"),this.socket=A(t+this.gameName,this.socketOpts)}else this.socket=A("/"+this.gameName,this.socketOpts)}this.socket.on("patch",(t,e,r,n,i)=>{this.notifyClient({type:"patch",args:[t,e,r,n,i]})}),this.socket.on("update",(t,e,r)=>{this.notifyClient({type:"update",args:[t,e,r]})}),this.socket.on("sync",(t,e)=>{this.notifyClient({type:"sync",args:[t,e]})}),this.socket.on("matchData",(t,e)=>{this.notifyClient({type:"matchData",args:[t,e]})}),this.socket.on("chat",(t,e)=>{this.notifyClient({type:"chat",args:[t,e]})}),this.socket.on("connect",()=>{this.requestSync(),this.setConnectionStatus(!0)}),this.socket.on("disconnect",()=>{this.setConnectionStatus(!1)})}disconnect(){this.socket.close(),this.socket=null,this.setConnectionStatus(!1)}requestSync(){if(this.socket){let t=[this.matchID,this.playerID,this.credentials,this.numPlayers];this.socket.emit("sync",...t)}}updateMatchID(t){this.matchID=t,this.requestSync()}updatePlayerID(t){this.playerID=t,this.requestSync()}updateCredentials(t){this.credentials=t,this.requestSync()}}function N({server:t,socketOpts:e}={}){return r=>new C({server:t,socketOpts:e,...r})}},4958:function(t,e,r){"use strict";r.d(e,{T:function(){return n}});class n{constructor({transportDataCallback:t,gameName:e,playerID:r,matchID:n,credentials:i,numPlayers:s}){this.connectionStatusCallback=()=>{},this.isConnected=!1,this.transportDataCallback=t,this.gameName=e||"default",this.playerID=r||null,this.matchID=n||"default",this.credentials=i,this.numPlayers=s||2}subscribeToConnectionStatus(t){this.connectionStatusCallback=t}setConnectionStatus(t){this.isConnected=t,this.connectionStatusCallback()}notifyClient(t){this.transportDataCallback(t)}}},5488:function(t,e,r){"use strict";function n(t){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];throw Error("[Immer] minified error nr: "+t+(r.length?" "+r.map(function(t){return"'"+t+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function i(t){return!!t&&!!t[Z]}function s(t){return!!t&&(function(t){if(!t||"object"!=typeof t)return!1;var e=Object.getPrototypeOf(t);if(null===e)return!0;var r=Object.hasOwnProperty.call(e,"constructor")&&e.constructor;return r===Object||"function"==typeof r&&Function.toString.call(r)===z}(t)||Array.isArray(t)||!!t[V]||!!t.constructor[V]||u(t)||h(t))}function o(t,e,r){void 0===r&&(r=!1),0===a(t)?(r?Object.keys:H)(t).forEach(function(n){r&&"symbol"==typeof n||e(n,t[n],t)}):t.forEach(function(r,n){return e(n,r,t)})}function a(t){var e=t[Z];return e?e.i>3?e.i-4:e.i:Array.isArray(t)?1:u(t)?2:h(t)?3:0}function c(t,e){return 2===a(t)?t.has(e):Object.prototype.hasOwnProperty.call(t,e)}function l(t,e,r){var n=a(t);2===n?t.set(e,r):3===n?(t.delete(e),t.add(r)):t[e]=r}function u(t){return $&&t instanceof Map}function h(t){return G&&t instanceof Set}function p(t){return t.o||t.t}function f(t){if(Array.isArray(t))return Array.prototype.slice.call(t);var e=J(t);delete e[Z];for(var r=H(e),n=0;n<r.length;n++){var i=r[n],s=e[i];!1===s.writable&&(s.writable=!0,s.configurable=!0),(s.get||s.set)&&(e[i]={configurable:!0,writable:!0,enumerable:s.enumerable,value:t[i]})}return Object.create(Object.getPrototypeOf(t),e)}function d(t,e){return void 0===e&&(e=!1),m(t)||i(t)||!s(t)||(a(t)>1&&(t.set=t.add=t.clear=t.delete=y),Object.freeze(t),e&&o(t,function(t,e){return d(e,!0)},!0)),t}function y(){n(2)}function m(t){return null==t||"object"!=typeof t||Object.isFrozen(t)}function g(t){var e=Y[t];return e||n(18,t),e}function v(t,e){e&&(g("Patches"),t.u=[],t.s=[],t.v=e)}function b(t){w(t),t.p.forEach(O),t.p=null}function w(t){t===L&&(L=t.l)}function E(t){return L={p:[],l:L,h:t,m:!0,_:0}}function O(t){var e=t[Z];0===e.i||1===e.i?e.j():e.O=!0}function P(t,e){e._=e.p.length;var r=e.p[0],i=void 0!==t&&t!==r;return e.h.g||g("ES5").S(e,t,i),i?(r[Z].P&&(b(e),n(4)),s(t)&&(t=x(e,t),e.l||S(e,t)),e.u&&g("Patches").M(r[Z].t,t,e.u,e.s)):t=x(e,r,[]),b(e),e.u&&e.v(e.u,e.s),t!==q?t:void 0}function x(t,e,r){if(m(e))return e;var n=e[Z];if(!n)return o(e,function(i,s){return I(t,n,e,i,s,r)},!0),e;if(n.A!==t)return e;if(!n.P)return S(t,n.t,!0),n.t;if(!n.I){n.I=!0,n.A._--;var i=4===n.i||5===n.i?n.o=f(n.k):n.o;o(3===n.i?new Set(i):i,function(e,s){return I(t,n,i,e,s,r)}),S(t,i,!1),r&&t.u&&g("Patches").R(n,r,t.u,t.s)}return n.o}function I(t,e,r,n,o,a){if(i(o)){var u=x(t,o,a&&e&&3!==e.i&&!c(e.D,n)?a.concat(n):void 0);if(l(r,n,u),!i(u))return;t.m=!1}if(s(o)&&!m(o)){if(!t.h.F&&t._<1)return;x(t,o),e&&e.A.l||S(t,o)}}function S(t,e,r){void 0===r&&(r=!1),t.h.F&&t.m&&d(e,r)}function _(t,e){var r=t[Z];return(r?p(r):t)[e]}function k(t,e){if(e in t)for(var r=Object.getPrototypeOf(t);r;){var n=Object.getOwnPropertyDescriptor(r,e);if(n)return n;r=Object.getPrototypeOf(r)}}function A(t){t.P||(t.P=!0,t.l&&A(t.l))}function C(t){t.o||(t.o=f(t.t))}function N(t,e,r){var n,i,s,o,a,c,l,p=u(e)?g("MapSet").N(e,r):h(e)?g("MapSet").T(e,r):t.g?(s=i={i:(n=Array.isArray(e))?1:0,A:r?r.A:L,P:!1,I:!1,D:{},l:r,t:e,k:null,o:null,j:null,C:!1},o=K,n&&(s=[i],o=W),c=(a=Proxy.revocable(s,o)).revoke,l=a.proxy,i.k=l,i.j=c,l):g("ES5").J(e,r);return(r?r.A:L).p.push(p),p}function D(t,e){switch(e){case 2:return new Map(t);case 3:return Array.from(t)}return f(t)}r.d(e,{A:function(){return tO},B:function(){return th},E:function(){return tj},F:function(){return tT},G:function(){return R},I:function(){return tz},M:function(){return te},N:function(){return tL},P:function(){return tc},R:function(){return tn},S:function(){return tY},T:function(){return tJ},U:function(){return tH},a:function(){return tM},b:function(){return tF},c:function(){return tq},d:function(){return tV},e:function(){return tA},f:function(){return tl},g:function(){return tp},h:function(){return tD},i:function(){return tk},j:function(){return to},k:function(){return ts},l:function(){return ta},m:function(){return ti},n:function(){return tP},o:function(){return tr},p:function(){return tu},q:function(){return t$},r:function(){return tE},s:function(){return td},t:function(){return tR},u:function(){return tg},v:function(){return tv},w:function(){return tb},x:function(){return tG},y:function(){return ty},z:function(){return tm}});var M,T,R,j,B,L,U="undefined"!=typeof Symbol&&"symbol"==typeof Symbol("x"),$="undefined"!=typeof Map,G="undefined"!=typeof Set,F="undefined"!=typeof Proxy&&void 0!==Proxy.revocable&&"undefined"!=typeof Reflect,q=U?Symbol.for("immer-nothing"):((B={})["immer-nothing"]=!0,B),V=U?Symbol.for("immer-draftable"):"__$immer_draftable",Z=U?Symbol.for("immer-state"):"__$immer_state",z=""+Object.prototype.constructor,H="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Object.getOwnPropertyNames,J=Object.getOwnPropertyDescriptors||function(t){var e={};return H(t).forEach(function(r){e[r]=Object.getOwnPropertyDescriptor(t,r)}),e},Y={},K={get:function(t,e){if(e===Z)return t;var r,n,i=p(t);if(!c(i,e))return(n=k(i,e))?"value"in n?n.value:null===(r=n.get)||void 0===r?void 0:r.call(t.k):void 0;var o=i[e];return t.I||!s(o)?o:o===_(t.t,e)?(C(t),t.o[e]=N(t.A.h,o,t)):o},has:function(t,e){return e in p(t)},ownKeys:function(t){return Reflect.ownKeys(p(t))},set:function(t,e,r){var n=k(p(t),e);if(null==n?void 0:n.set)return n.set.call(t.k,r),!0;if(!t.P){var i=_(p(t),e),s=null==i?void 0:i[Z];if(s&&s.t===r)return t.o[e]=r,t.D[e]=!1,!0;if((r===i?0!==r||1/r==1/i:r!=r&&i!=i)&&(void 0!==r||c(t.t,e)))return!0;C(t),A(t)}return t.o[e]===r&&"number"!=typeof r&&(void 0!==r||e in t.o)||(t.o[e]=r,t.D[e]=!0,!0)},deleteProperty:function(t,e){return void 0!==_(t.t,e)||e in t.t?(t.D[e]=!1,C(t),A(t)):delete t.D[e],t.o&&delete t.o[e],!0},getOwnPropertyDescriptor:function(t,e){var r=p(t),n=Reflect.getOwnPropertyDescriptor(r,e);return n?{writable:!0,configurable:1!==t.i||"length"!==e,enumerable:n.enumerable,value:r[e]}:n},defineProperty:function(){n(11)},getPrototypeOf:function(t){return Object.getPrototypeOf(t.t)},setPrototypeOf:function(){n(12)}},W={};o(K,function(t,e){W[t]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}}),W.deleteProperty=function(t,e){return W.set.call(this,t,e,void 0)},W.set=function(t,e,r){return K.set.call(this,t[0],e,r,t[0])};var X=new(function(){function t(t){var e=this;this.g=F,this.F=!0,this.produce=function(t,r,i){if("function"==typeof t&&"function"!=typeof r){var o,a=r;return r=t,function(t){var n=this;void 0===t&&(t=a);for(var i=arguments.length,s=Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];return e.produce(t,function(t){var e;return(e=r).call.apply(e,[n,t].concat(s))})}}if("function"!=typeof r&&n(6),void 0!==i&&"function"!=typeof i&&n(7),s(t)){var c=E(e),l=N(e,t,void 0),u=!0;try{o=r(l),u=!1}finally{u?b(c):w(c)}return"undefined"!=typeof Promise&&o instanceof Promise?o.then(function(t){return v(c,i),P(t,c)},function(t){throw b(c),t}):(v(c,i),P(o,c))}if(!t||"object"!=typeof t){if(void 0===(o=r(t))&&(o=t),o===q&&(o=void 0),e.F&&d(o,!0),i){var h=[],p=[];g("Patches").M(t,o,h,p),i(h,p)}return o}n(21,t)},this.produceWithPatches=function(t,r){if("function"==typeof t)return function(r){for(var n=arguments.length,i=Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];return e.produceWithPatches(r,function(e){return t.apply(void 0,[e].concat(i))})};var n,i,s=e.produce(t,r,function(t,e){n=t,i=e});return"undefined"!=typeof Promise&&s instanceof Promise?s.then(function(t){return[t,n,i]}):[s,n,i]},"boolean"==typeof(null==t?void 0:t.useProxies)&&this.setUseProxies(t.useProxies),"boolean"==typeof(null==t?void 0:t.autoFreeze)&&this.setAutoFreeze(t.autoFreeze)}var e=t.prototype;return e.createDraft=function(t){s(t)||n(8),i(t)&&(i(e=t)||n(22,e),t=function t(e){if(!s(e))return e;var r,n=e[Z],i=a(e);if(n){if(!n.P&&(n.i<4||!g("ES5").K(n)))return n.t;n.I=!0,r=D(e,i),n.I=!1}else r=D(e,i);return o(r,function(e,i){var s;n&&(2===a(s=n.t)?s.get(e):s[e])===i||l(r,e,t(i))}),3===i?new Set(r):r}(e));var e,r=E(this),c=N(this,t,void 0);return c[Z].C=!0,w(r),c},e.finishDraft=function(t,e){var r=(t&&t[Z]).A;return v(r,e),P(void 0,r)},e.setAutoFreeze=function(t){this.F=t},e.setUseProxies=function(t){t&&!F&&n(20),this.g=t},e.applyPatches=function(t,e){for(r=e.length-1;r>=0;r--){var r,n=e[r];if(0===n.path.length&&"replace"===n.op){t=n.value;break}}r>-1&&(e=e.slice(r+1));var s=g("Patches").$;return i(t)?s(t,e):this.produce(t,function(t){return s(t,e)})},t}()),Q=X.produce;X.produceWithPatches.bind(X),X.setAutoFreeze.bind(X),X.setUseProxies.bind(X),X.applyPatches.bind(X),X.createDraft.bind(X),X.finishDraft.bind(X);var tt=r(4460);r(3261);let te="MAKE_MOVE",tr="GAME_EVENT",tn="REDO",ti="RESET",ts="SYNC",to="UNDO",ta="UPDATE",tc="PATCH",tl="PLUGIN",tu="STRIP_TRANSIENTS",th=(t,e,r,n)=>({type:te,payload:{type:t,args:e,playerID:r,credentials:n}}),tp=(t,e,r,n)=>({type:tr,payload:{type:t,args:e,playerID:r,credentials:n}}),tf=(t,e,r,n)=>({type:tr,payload:{type:t,args:e,playerID:r,credentials:n},automatic:!0}),td=t=>({type:ts,state:t.state,log:t.log,initialState:t.initialState,clientOnly:!0}),ty=(t,e,r,n)=>({type:tc,prevStateID:t,stateID:e,patch:r,deltalog:n,clientOnly:!0}),tm=(t,e)=>({type:ta,state:t,deltalog:e,clientOnly:!0}),tg=t=>({type:ti,state:t,clientOnly:!0}),tv=(t,e)=>({type:to,payload:{type:null,args:null,playerID:t,credentials:e}}),tb=(t,e)=>({type:tn,payload:{type:null,args:null,playerID:t,credentials:e}}),tw=(t,e,r,n)=>({type:tl,payload:{type:t,args:e,playerID:r,credentials:n}}),tE=()=>({type:tu});var tO=Object.freeze({__proto__:null,makeMove:th,gameEvent:tp,automaticGameEvent:tf,sync:td,patch:ty,update:tm,reset:tg,undo:tv,redo:tb,plugin:tw,stripTransients:tE});let tP="INVALID_MOVE";(M=R||(R={})).MOVE="MOVE",M.GAME_ON_END="GAME_ON_END",M.PHASE_ON_BEGIN="PHASE_ON_BEGIN",M.PHASE_ON_END="PHASE_ON_END",M.TURN_ON_BEGIN="TURN_ON_BEGIN",M.TURN_ON_MOVE="TURN_ON_MOVE",M.TURN_ON_END="TURN_ON_END",(T=j||(j={})).CalledOutsideHook="Events must be called from moves or the `onBegin`, `onEnd`, and `onMove` hooks.\nThis error probably means you called an event from other game code, like an `endIf` trigger or one of the `turn.order` methods.",T.EndTurnInOnEnd="`endTurn` is disallowed in `onEnd` hooks — the turn is already ending.",T.MaxTurnEndings="Maximum number of turn endings exceeded for this update.\nThis likely means game code is triggering an infinite loop.",T.PhaseEventInOnEnd="`setPhase` & `endPhase` are disallowed in a phase’s `onEnd` hook — the phase is already ending.\nIf you’re trying to dynamically choose the next phase when a phase ends, use the phase’s `next` trigger.",T.StageEventInOnEnd="`setStage`, `endStage` & `setActivePlayers` are disallowed in `onEnd` hooks.",T.StageEventInPhaseBegin="`setStage`, `endStage` & `setActivePlayers` are disallowed in a phase’s `onBegin` hook.\nUse `setActivePlayers` in a `turn.onBegin` hook or declare stages with `turn.activePlayers` instead.",T.StageEventInTurnBegin="`setStage` & `endStage` are disallowed in `turn.onBegin`.\nUse `setActivePlayers` or declare stages with `turn.activePlayers` instead.";class tx{constructor(t,e,r){this.flow=t,this.playerID=r,this.dispatch=[],this.initialTurn=e.turn,this.updateTurnContext(e,void 0),this.maxEndedTurnsPerAction=100*e.numPlayers}api(){let t={_private:this};for(let e of this.flow.eventNames)t[e]=(...t)=>{this.dispatch.push({type:e,args:t,phase:this.currentPhase,turn:this.currentTurn,calledFrom:this.currentMethod,error:Error("Events Plugin Error")})};return t}isUsed(){return this.dispatch.length>0}updateTurnContext(t,e){this.currentPhase=t.phase,this.currentTurn=t.turn,this.currentMethod=e}unsetCurrentMethod(){this.currentMethod=void 0}update(t){let e=t,r=({stack:t},r)=>({...e,plugins:{...e.plugins,events:{...e.plugins.events,data:{error:r+"\n"+t}}}});t:for(let n=0;n<this.dispatch.length;n++){let i=this.dispatch[n],s=i.turn!==t.ctx.turn,o=this.currentTurn-this.initialTurn;if(o>=this.maxEndedTurnsPerAction)return r(i.error,j.MaxTurnEndings);if(void 0===i.calledFrom)return r(i.error,j.CalledOutsideHook);if(t.ctx.gameover)break t;switch(i.type){case"endStage":case"setStage":case"setActivePlayers":switch(i.calledFrom){case R.TURN_ON_END:case R.PHASE_ON_END:return r(i.error,j.StageEventInOnEnd);case R.PHASE_ON_BEGIN:return r(i.error,j.StageEventInPhaseBegin);case R.TURN_ON_BEGIN:if("setActivePlayers"===i.type)break;return r(i.error,j.StageEventInTurnBegin)}if(s)continue t;break;case"endTurn":if(i.calledFrom===R.TURN_ON_END||i.calledFrom===R.PHASE_ON_END)return r(i.error,j.EndTurnInOnEnd);if(s)continue t;break;case"endPhase":case"setPhase":if(i.calledFrom===R.PHASE_ON_END)return r(i.error,j.PhaseEventInOnEnd);if(i.phase!==t.ctx.phase)continue t}let a=tf(i.type,i.args,this.playerID);t=this.flow.processEvent(t,a)}return t}}let tI={name:"events",noClient:({api:t})=>t._private.isUsed(),isInvalid:({data:t})=>t.error||!1,fnWrap:(t,e)=>(r,...n)=>{let i=r.events;i&&i._private.updateTurnContext(r.ctx,e);let s=t(r,...n);return i&&i._private.unsetCurrentMethod(),s},dangerouslyFlushRawState:({state:t,api:e})=>e._private.update(t),api:({game:t,ctx:e,playerID:r})=>new tx(t.flow,e,r).api()},tS=()=>{},t_=(...t)=>console.error(...t);function tk(t){tS(`INFO: ${t}`)}function tA(t){t_("ERROR:",t)}let tC=[{name:"plugin-immer",fnWrap:t=>(e,...r)=>{let n=!1,i=Q(e.G,i=>{let s=t({...e,G:i},...r);if(s===tP){n=!0;return}return s});return n?tP:i}},tt.R,{name:"log",flush:()=>({}),api:({data:t})=>({setMetadata(e){t.metadata=e}}),setup:()=>({})},{name:"plugin-serializable",fnWrap:t=>(e,...r)=>{let n=t(e,...r);return n}}],tN=[...tC,tI],tD=(t,e,r)=>(r.game.plugins.filter(t=>void 0!==t.action).filter(t=>t.name===e.payload.type).forEach(r=>{let n=r.name,i=t.plugins[n]||{data:{}},s=r.action(i.data,e.payload);t={...t,plugins:{...t.plugins,[n]:{...i,data:s}}}}),t),tM=({plugins:t})=>Object.entries(t||{}).reduce((t,[e,{api:r}])=>(t[e]=r,t),{}),tT=(t,e,r)=>[...tC,...r,tI].filter(t=>void 0!==t.fnWrap).reduce((t,{fnWrap:r})=>r(t,e),t),tR=(t,e)=>([...tN,...e.game.plugins].filter(t=>void 0!==t.setup).forEach(r=>{let n=r.name,i=r.setup({G:t.G,ctx:t.ctx,game:e.game});t={...t,plugins:{...t.plugins,[n]:{data:i}}}}),t),tj=(t,e)=>([...tN,...e.game.plugins].filter(t=>void 0!==t.api).forEach(r=>{let n=r.name,i=t.plugins[n]||{data:{}},s=r.api({G:t.G,ctx:t.ctx,data:i.data,game:e.game,playerID:e.playerID});t={...t,plugins:{...t.plugins,[n]:{...i,api:s}}}}),t),tB=(t,e)=>([...tC,...e.game.plugins,tI].reverse().forEach(r=>{let n=r.name,i=t.plugins[n]||{data:{}};if(r.flush){let s=r.flush({G:t.G,ctx:t.ctx,game:e.game,api:i.api,data:i.data});t={...t,plugins:{...t.plugins,[r.name]:{data:s}}}}else if(r.dangerouslyFlushRawState){t=r.dangerouslyFlushRawState({state:t,game:e.game,api:i.api,data:i.data});let o=t.plugins[n].data;t={...t,plugins:{...t.plugins,[r.name]:{data:o}}}}}),t),tL=(t,e)=>[...tN,...e.game.plugins].filter(t=>void 0!==t.noClient).map(r=>{let n=r.name,i=t.plugins[n];return!!i&&r.noClient({G:t.G,ctx:t.ctx,game:e.game,api:i.api,data:i.data})}).includes(!0),tU=(t,e)=>{let r=[...tN,...e.game.plugins].filter(t=>void 0!==t.isInvalid).map(r=>{let{name:n}=r,i=t.plugins[n],s=r.isInvalid({G:t.G,ctx:t.ctx,game:e.game,data:i&&i.data});return!!s&&{plugin:n,message:s}}).find(t=>t);return r||!1},t$=(t,e)=>{let r=tB(t,e),n=tU(r,e);if(!n)return[r];let{plugin:i,message:s}=n;return tA(`${i} plugin declared action invalid:
${s}`),[t,n]},tG=({G:t,ctx:e,plugins:r={}},{game:n,playerID:i})=>([...tN,...n.plugins].forEach(({name:s,playerView:o})=>{if(!o)return;let{data:a}=r[s]||{data:{}},c=o({G:t,ctx:e,game:n,data:a,playerID:i});r={...r,[s]:{data:c}}}),r);function tF(t,e=!1){t.moveLimit&&(e&&(t.minMoves=t.moveLimit),t.maxMoves=t.moveLimit,delete t.moveLimit)}function tq(t,e){let r={},n=[],i=null,s={},o={};if(Array.isArray(e)){let a={};e.forEach(t=>a[t]=tY.NULL),r=a}else{if(tF(e),e.next&&(i=e.next),e.revert&&(n=[...t._prevActivePlayers,{activePlayers:t.activePlayers,_activePlayersMinMoves:t._activePlayersMinMoves,_activePlayersMaxMoves:t._activePlayersMaxMoves,_activePlayersNumMoves:t._activePlayersNumMoves}]),void 0!==e.currentPlayer&&tZ(r,s,o,t.currentPlayer,e.currentPlayer),void 0!==e.others)for(let c=0;c<t.playOrder.length;c++){let l=t.playOrder[c];l!==t.currentPlayer&&tZ(r,s,o,l,e.others)}if(void 0!==e.all)for(let u=0;u<t.playOrder.length;u++){let h=t.playOrder[u];tZ(r,s,o,h,e.all)}if(e.value)for(let p in e.value)tZ(r,s,o,p,e.value[p]);if(e.minMoves)for(let f in r)void 0===s[f]&&(s[f]=e.minMoves);if(e.maxMoves)for(let d in r)void 0===o[d]&&(o[d]=e.maxMoves)}0===Object.keys(r).length&&(r=null),0===Object.keys(s).length&&(s=null),0===Object.keys(o).length&&(o=null);let y={};for(let m in r)y[m]=0;return{...t,activePlayers:r,_activePlayersMinMoves:s,_activePlayersMaxMoves:o,_activePlayersNumMoves:y,_prevActivePlayers:n,_nextActivePlayers:i}}function tV(t){let{activePlayers:e,_activePlayersMinMoves:r,_activePlayersMaxMoves:n,_activePlayersNumMoves:i,_prevActivePlayers:s,_nextActivePlayers:o}=t;if(e&&0===Object.keys(e).length){if(o)t=tq(t,o),{activePlayers:e,_activePlayersMinMoves:r,_activePlayersMaxMoves:n,_activePlayersNumMoves:i,_prevActivePlayers:s}=t;else if(s.length>0){let a=s.length-1;({activePlayers:e,_activePlayersMinMoves:r,_activePlayersMaxMoves:n,_activePlayersNumMoves:i}=s[a]),s=s.slice(0,a)}else e=null,r=null,n=null}return{...t,activePlayers:e,_activePlayersMinMoves:r,_activePlayersMaxMoves:n,_activePlayersNumMoves:i,_prevActivePlayers:s}}function tZ(t,e,r,n,i){("object"!=typeof i||i===tY.NULL)&&(i={stage:i}),void 0!==i.stage&&(tF(i),t[n]=i.stage,i.minMoves&&(e[n]=i.minMoves),i.maxMoves&&(r[n]=i.maxMoves))}function tz(t,e){let{G:r,ctx:n}=t,{numPlayers:i}=n,s=tM(t),o={...s,G:r,ctx:n},a=e.order,c=[...Array.from({length:i})].map((t,e)=>e+"");void 0!==a.playOrder&&(c=a.playOrder(o));let l=a.first(o),u=typeof l;"number"!==u&&tA(`invalid value returned by turn.order.first — expected number got ${u} “${l}”.`);let h=c[l]+"";return tq(n={...n,currentPlayer:h,playOrderPos:l,playOrder:c},e.activePlayers||{})}function tH(t,e,r,n){let i=r.order,{G:s,ctx:o}=t,a=o.playOrderPos,c=!1;if(n&&!0!==n)"object"!=typeof n&&tA(`invalid argument to endTurn: ${n}`),Object.keys(n).forEach(t=>{switch(t){case"remove":e=o.playOrder[a]+"";break;case"next":a=o.playOrder.indexOf(n.next),e=n.next;break;default:tA(`invalid argument to endTurn: ${t}`)}});else{let l=tM(t),u={...l,G:s,ctx:o},h=i.next(u),p=typeof h;(void 0!==h&&"number"!==p&&tA(`invalid value returned by turn.order.next — expected number or undefined got ${p} “${h}”.`),void 0===h)?c=!0:(a=h,e=o.playOrder[a]+"")}return o={...o,playOrderPos:a,currentPlayer:e},{endPhase:c,ctx:o}}let tJ={DEFAULT:{first:({ctx:t})=>0===t.turn?t.playOrderPos:(t.playOrderPos+1)%t.playOrder.length,next:({ctx:t})=>(t.playOrderPos+1)%t.playOrder.length},RESET:{first:()=>0,next:({ctx:t})=>(t.playOrderPos+1)%t.playOrder.length},CONTINUE:{first:({ctx:t})=>t.playOrderPos,next:({ctx:t})=>(t.playOrderPos+1)%t.playOrder.length},ONCE:{first:()=>0,next({ctx:t}){if(t.playOrderPos<t.playOrder.length-1)return t.playOrderPos+1}},CUSTOM:t=>({playOrder:()=>t,first:()=>0,next:({ctx:t})=>(t.playOrderPos+1)%t.playOrder.length}),CUSTOM_FROM:t=>({playOrder:({G:e})=>e[t],first:()=>0,next:({ctx:t})=>(t.playOrderPos+1)%t.playOrder.length})},tY={NULL:null};tY.NULL,tY.NULL,tY.NULL,tY.NULL},4275:function(t,e){"use strict";e.E=function(){var t=[],e=t;function r(){e===t&&(e=t.slice())}return{listen:function(t){if("function"!=typeof t)throw Error("Expected listener to be a function.");var n=!0;return r(),e.push(t),function(){if(n){n=!1,r();var i=e.indexOf(t);e.splice(i,1)}}},emit:function(){for(var r=t=e,n=0;n<r.length;n++)r[n].apply(r,arguments)}}}},4366:function(t){"use strict";var e=Object.prototype.hasOwnProperty;function r(t,e){return t===e?0!==t||0!==e||1/t==1/e:t!=t&&e!=e}t.exports=function(t,n){if(r(t,n))return!0;if("object"!=typeof t||null===t||"object"!=typeof n||null===n)return!1;var i=Object.keys(t),s=Object.keys(n);if(i.length!==s.length)return!1;for(var o=0;o<i.length;o++)if(!e.call(n,i[o])||!r(t[i[o]],n[i[o]]))return!1;return!0}},3261:function(t){var e,r,n=Object.prototype,i=Function.prototype.toString,s=n.hasOwnProperty,o=i.call(Object),a=n.toString,c=(e=Object.getPrototypeOf,r=Object,function(t){return e(r(t))});t.exports=function(t){if(!(t&&"object"==typeof t)||"[object Object]"!=a.call(t)||function(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(r){}return e}(t))return!1;var e=c(t);if(null===e)return!0;var r=s.call(e,"constructor")&&e.constructor;return"function"==typeof r&&r instanceof r&&i.call(r)==o}},6493:function(t){"use strict";var e=Object.assign.bind(Object);t.exports=e,t.exports.default=t.exports},4284:function(t,e,r){"use strict";var n,i;t.exports=(null==(n=r.g.process)?void 0:n.env)&&"object"==typeof(null==(i=r.g.process)?void 0:i.env)?r.g.process:r(6118)},2241:function(t){!function(){var e={675:function(t,e){"use strict";e.byteLength=function(t){var e=c(t),r=e[0],n=e[1];return(r+n)*3/4-n},e.toByteArray=function(t){var e,r,s=c(t),o=s[0],a=s[1],l=new i((o+a)*3/4-a),u=0,h=a>0?o-4:o;for(r=0;r<h;r+=4)e=n[t.charCodeAt(r)]<<18|n[t.charCodeAt(r+1)]<<12|n[t.charCodeAt(r+2)]<<6|n[t.charCodeAt(r+3)],l[u++]=e>>16&255,l[u++]=e>>8&255,l[u++]=255&e;return 2===a&&(e=n[t.charCodeAt(r)]<<2|n[t.charCodeAt(r+1)]>>4,l[u++]=255&e),1===a&&(e=n[t.charCodeAt(r)]<<10|n[t.charCodeAt(r+1)]<<4|n[t.charCodeAt(r+2)]>>2,l[u++]=e>>8&255,l[u++]=255&e),l},e.fromByteArray=function(t){for(var e,n=t.length,i=n%3,s=[],o=0,a=n-i;o<a;o+=16383)s.push(function(t,e,n){for(var i,s=[],o=e;o<n;o+=3)s.push(r[(i=(t[o]<<16&16711680)+(t[o+1]<<8&65280)+(255&t[o+2]))>>18&63]+r[i>>12&63]+r[i>>6&63]+r[63&i]);return s.join("")}(t,o,o+16383>a?a:o+16383));return 1===i?s.push(r[(e=t[n-1])>>2]+r[e<<4&63]+"=="):2===i&&s.push(r[(e=(t[n-2]<<8)+t[n-1])>>10]+r[e>>4&63]+r[e<<2&63]+"="),s.join("")};for(var r=[],n=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,a=s.length;o<a;++o)r[o]=s[o],n[s.charCodeAt(o)]=o;function c(t){var e=t.length;if(e%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");-1===r&&(r=e);var n=r===e?0:4-r%4;return[r,n]}n["-".charCodeAt(0)]=62,n["_".charCodeAt(0)]=63},72:function(t,e,r){"use strict";/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */ var n=r(675),i=r(783),s="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function o(t){if(t>2147483647)throw RangeError('The value "'+t+'" is invalid for option "size"');var e=new Uint8Array(t);return Object.setPrototypeOf(e,a.prototype),e}function a(t,e,r){if("number"==typeof t){if("string"==typeof e)throw TypeError('The "string" argument must be of type string. Received type number');return u(t)}return c(t,e,r)}function c(t,e,r){if("string"==typeof t)return function(t,e){if(("string"!=typeof e||""===e)&&(e="utf8"),!a.isEncoding(e))throw TypeError("Unknown encoding: "+e);var r=0|f(t,e),n=o(r),i=n.write(t,e);return i!==r&&(n=n.slice(0,i)),n}(t,e);if(ArrayBuffer.isView(t))return h(t);if(null==t)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(A(t,ArrayBuffer)||t&&A(t.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(A(t,SharedArrayBuffer)||t&&A(t.buffer,SharedArrayBuffer)))return function(t,e,r){var n;if(e<0||t.byteLength<e)throw RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(r||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(n=void 0===e&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,e):new Uint8Array(t,e,r),a.prototype),n}(t,e,r);if("number"==typeof t)throw TypeError('The "value" argument must not be of type number. Received type number');var n=t.valueOf&&t.valueOf();if(null!=n&&n!==t)return a.from(n,e,r);var i=function(t){if(a.isBuffer(t)){var e,r=0|p(t.length),n=o(r);return 0===n.length||t.copy(n,0,0,r),n}return void 0!==t.length?"number"!=typeof t.length||(e=t.length)!=e?o(0):h(t):"Buffer"===t.type&&Array.isArray(t.data)?h(t.data):void 0}(t);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return a.from(t[Symbol.toPrimitive]("string"),e,r);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function l(t){if("number"!=typeof t)throw TypeError('"size" argument must be of type number');if(t<0)throw RangeError('The value "'+t+'" is invalid for option "size"')}function u(t){return l(t),o(t<0?0:0|p(t))}function h(t){for(var e=t.length<0?0:0|p(t.length),r=o(e),n=0;n<e;n+=1)r[n]=255&t[n];return r}function p(t){if(t>=2147483647)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+2147483647..toString(16)+" bytes");return 0|t}function f(t,e){if(a.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||A(t,ArrayBuffer))return t.byteLength;if("string"!=typeof t)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);var r=t.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;for(var i=!1;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return I(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return _(t).length;default:if(i)return n?-1:I(t).length;e=(""+e).toLowerCase(),i=!0}}function d(t,e,r){var i,s,o=!1;if((void 0===e||e<0)&&(e=0),e>this.length||((void 0===r||r>this.length)&&(r=this.length),r<=0||(r>>>=0)<=(e>>>=0)))return"";for(t||(t="utf8");;)switch(t){case"hex":return function(t,e,r){var n=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>n)&&(r=n);for(var i="",s=e;s<r;++s)i+=C[t[s]];return i}(this,e,r);case"utf8":case"utf-8":return v(this,e,r);case"ascii":return function(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(127&t[i]);return n}(this,e,r);case"latin1":case"binary":return function(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(t[i]);return n}(this,e,r);case"base64":return i=e,s=r,0===i&&s===this.length?n.fromByteArray(this):n.fromByteArray(this.slice(i,s));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(t,e,r){for(var n=t.slice(e,r),i="",s=0;s<n.length;s+=2)i+=String.fromCharCode(n[s]+256*n[s+1]);return i}(this,e,r);default:if(o)throw TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),o=!0}}function y(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function m(t,e,r,n,i){var s;if(0===t.length)return -1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),(s=r=+r)!=s&&(r=i?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(i)return -1;r=t.length-1}else if(r<0){if(!i)return -1;r=0}if("string"==typeof e&&(e=a.from(e,n)),a.isBuffer(e))return 0===e.length?-1:g(t,e,r,n,i);if("number"==typeof e)return(e&=255,"function"==typeof Uint8Array.prototype.indexOf)?i?Uint8Array.prototype.indexOf.call(t,e,r):Uint8Array.prototype.lastIndexOf.call(t,e,r):g(t,[e],r,n,i);throw TypeError("val must be string, number or Buffer")}function g(t,e,r,n,i){var s,o=1,a=t.length,c=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return -1;o=2,a/=2,c/=2,r/=2}function l(t,e){return 1===o?t[e]:t.readUInt16BE(e*o)}if(i){var u=-1;for(s=r;s<a;s++)if(l(t,s)===l(e,-1===u?0:s-u)){if(-1===u&&(u=s),s-u+1===c)return u*o}else -1!==u&&(s-=s-u),u=-1}else for(r+c>a&&(r=a-c),s=r;s>=0;s--){for(var h=!0,p=0;p<c;p++)if(l(t,s+p)!==l(e,p)){h=!1;break}if(h)return s}return -1}function v(t,e,r){r=Math.min(t.length,r);for(var n=[],i=e;i<r;){var s,o,a,c,l=t[i],u=null,h=l>239?4:l>223?3:l>191?2:1;if(i+h<=r)switch(h){case 1:l<128&&(u=l);break;case 2:(192&(s=t[i+1]))==128&&(c=(31&l)<<6|63&s)>127&&(u=c);break;case 3:s=t[i+1],o=t[i+2],(192&s)==128&&(192&o)==128&&(c=(15&l)<<12|(63&s)<<6|63&o)>2047&&(c<55296||c>57343)&&(u=c);break;case 4:s=t[i+1],o=t[i+2],a=t[i+3],(192&s)==128&&(192&o)==128&&(192&a)==128&&(c=(15&l)<<18|(63&s)<<12|(63&o)<<6|63&a)>65535&&c<1114112&&(u=c)}null===u?(u=65533,h=1):u>65535&&(u-=65536,n.push(u>>>10&1023|55296),u=56320|1023&u),n.push(u),i+=h}return function(t){var e=t.length;if(e<=4096)return String.fromCharCode.apply(String,t);for(var r="",n=0;n<e;)r+=String.fromCharCode.apply(String,t.slice(n,n+=4096));return r}(n)}function b(t,e,r){if(t%1!=0||t<0)throw RangeError("offset is not uint");if(t+e>r)throw RangeError("Trying to access beyond buffer length")}function w(t,e,r,n,i,s){if(!a.isBuffer(t))throw TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<s)throw RangeError('"value" argument is out of bounds');if(r+n>t.length)throw RangeError("Index out of range")}function E(t,e,r,n,i,s){if(r+n>t.length||r<0)throw RangeError("Index out of range")}function O(t,e,r,n,s){return e=+e,r>>>=0,s||E(t,e,r,4,34028234663852886e22,-34028234663852886e22),i.write(t,e,r,n,23,4),r+4}function P(t,e,r,n,s){return e=+e,r>>>=0,s||E(t,e,r,8,17976931348623157e292,-17976931348623157e292),i.write(t,e,r,n,52,8),r+8}e.Buffer=a,e.SlowBuffer=function(t){return+t!=t&&(t=0),a.alloc(+t)},e.INSPECT_MAX_BYTES=50,e.kMaxLength=2147483647,a.TYPED_ARRAY_SUPPORT=function(){try{var t=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(t,e),42===t.foo()}catch(r){return!1}}(),a.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.byteOffset}}),a.poolSize=8192,a.from=function(t,e,r){return c(t,e,r)},Object.setPrototypeOf(a.prototype,Uint8Array.prototype),Object.setPrototypeOf(a,Uint8Array),a.alloc=function(t,e,r){return(l(t),t<=0)?o(t):void 0!==e?"string"==typeof r?o(t).fill(e,r):o(t).fill(e):o(t)},a.allocUnsafe=function(t){return u(t)},a.allocUnsafeSlow=function(t){return u(t)},a.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==a.prototype},a.compare=function(t,e){if(A(t,Uint8Array)&&(t=a.from(t,t.offset,t.byteLength)),A(e,Uint8Array)&&(e=a.from(e,e.offset,e.byteLength)),!a.isBuffer(t)||!a.isBuffer(e))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===e)return 0;for(var r=t.length,n=e.length,i=0,s=Math.min(r,n);i<s;++i)if(t[i]!==e[i]){r=t[i],n=e[i];break}return r<n?-1:n<r?1:0},a.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(t,e){if(!Array.isArray(t))throw TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return a.alloc(0);if(void 0===e)for(r=0,e=0;r<t.length;++r)e+=t[r].length;var r,n=a.allocUnsafe(e),i=0;for(r=0;r<t.length;++r){var s=t[r];if(A(s,Uint8Array)&&(s=a.from(s)),!a.isBuffer(s))throw TypeError('"list" argument must be an Array of Buffers');s.copy(n,i),i+=s.length}return n},a.byteLength=f,a.prototype._isBuffer=!0,a.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)y(this,e,e+1);return this},a.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)y(this,e,e+3),y(this,e+1,e+2);return this},a.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)y(this,e,e+7),y(this,e+1,e+6),y(this,e+2,e+5),y(this,e+3,e+4);return this},a.prototype.toString=function(){var t=this.length;return 0===t?"":0==arguments.length?v(this,0,t):d.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function(t){if(!a.isBuffer(t))throw TypeError("Argument must be a Buffer");return this===t||0===a.compare(this,t)},a.prototype.inspect=function(){var t="",r=e.INSPECT_MAX_BYTES;return t=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(t+=" ... "),"<Buffer "+t+">"},s&&(a.prototype[s]=a.prototype.inspect),a.prototype.compare=function(t,e,r,n,i){if(A(t,Uint8Array)&&(t=a.from(t,t.offset,t.byteLength)),!a.isBuffer(t))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(void 0===e&&(e=0),void 0===r&&(r=t?t.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),e<0||r>t.length||n<0||i>this.length)throw RangeError("out of range index");if(n>=i&&e>=r)return 0;if(n>=i)return -1;if(e>=r)return 1;if(e>>>=0,r>>>=0,n>>>=0,i>>>=0,this===t)return 0;for(var s=i-n,o=r-e,c=Math.min(s,o),l=this.slice(n,i),u=t.slice(e,r),h=0;h<c;++h)if(l[h]!==u[h]){s=l[h],o=u[h];break}return s<o?-1:o<s?1:0},a.prototype.includes=function(t,e,r){return -1!==this.indexOf(t,e,r)},a.prototype.indexOf=function(t,e,r){return m(this,t,e,r,!0)},a.prototype.lastIndexOf=function(t,e,r){return m(this,t,e,r,!1)},a.prototype.write=function(t,e,r,n){if(void 0===e)n="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)n=e,r=this.length,e=0;else if(isFinite(e))e>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var i,s,o,a,c,l,u,h,p,f,d,y,m=this.length-e;if((void 0===r||r>m)&&(r=m),t.length>0&&(r<0||e<0)||e>this.length)throw RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var g=!1;;)switch(n){case"hex":return function(t,e,r,n){r=Number(r)||0;var i=t.length-r;n?(n=Number(n))>i&&(n=i):n=i;var s=e.length;n>s/2&&(n=s/2);for(var o=0;o<n;++o){var a=parseInt(e.substr(2*o,2),16);if(a!=a)break;t[r+o]=a}return o}(this,t,e,r);case"utf8":case"utf-8":return c=e,l=r,k(I(t,this.length-c),this,c,l);case"ascii":return u=e,h=r,k(S(t),this,u,h);case"latin1":case"binary":return i=this,s=t,o=e,a=r,k(S(s),i,o,a);case"base64":return p=e,f=r,k(_(t),this,p,f);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return d=e,y=r,k(function(t,e){for(var r,n,i=[],s=0;s<t.length&&!((e-=2)<0);++s)n=(r=t.charCodeAt(s))>>8,i.push(r%256),i.push(n);return i}(t,this.length-d),this,d,y);default:if(g)throw TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),g=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},a.prototype.slice=function(t,e){var r=this.length;t=~~t,e=void 0===e?r:~~e,t<0?(t+=r)<0&&(t=0):t>r&&(t=r),e<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t);var n=this.subarray(t,e);return Object.setPrototypeOf(n,a.prototype),n},a.prototype.readUIntLE=function(t,e,r){t>>>=0,e>>>=0,r||b(t,e,this.length);for(var n=this[t],i=1,s=0;++s<e&&(i*=256);)n+=this[t+s]*i;return n},a.prototype.readUIntBE=function(t,e,r){t>>>=0,e>>>=0,r||b(t,e,this.length);for(var n=this[t+--e],i=1;e>0&&(i*=256);)n+=this[t+--e]*i;return n},a.prototype.readUInt8=function(t,e){return t>>>=0,e||b(t,1,this.length),this[t]},a.prototype.readUInt16LE=function(t,e){return t>>>=0,e||b(t,2,this.length),this[t]|this[t+1]<<8},a.prototype.readUInt16BE=function(t,e){return t>>>=0,e||b(t,2,this.length),this[t]<<8|this[t+1]},a.prototype.readUInt32LE=function(t,e){return t>>>=0,e||b(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},a.prototype.readUInt32BE=function(t,e){return t>>>=0,e||b(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},a.prototype.readIntLE=function(t,e,r){t>>>=0,e>>>=0,r||b(t,e,this.length);for(var n=this[t],i=1,s=0;++s<e&&(i*=256);)n+=this[t+s]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*e)),n},a.prototype.readIntBE=function(t,e,r){t>>>=0,e>>>=0,r||b(t,e,this.length);for(var n=e,i=1,s=this[t+--n];n>0&&(i*=256);)s+=this[t+--n]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*e)),s},a.prototype.readInt8=function(t,e){return(t>>>=0,e||b(t,1,this.length),128&this[t])?-((255-this[t]+1)*1):this[t]},a.prototype.readInt16LE=function(t,e){t>>>=0,e||b(t,2,this.length);var r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},a.prototype.readInt16BE=function(t,e){t>>>=0,e||b(t,2,this.length);var r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},a.prototype.readInt32LE=function(t,e){return t>>>=0,e||b(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},a.prototype.readInt32BE=function(t,e){return t>>>=0,e||b(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},a.prototype.readFloatLE=function(t,e){return t>>>=0,e||b(t,4,this.length),i.read(this,t,!0,23,4)},a.prototype.readFloatBE=function(t,e){return t>>>=0,e||b(t,4,this.length),i.read(this,t,!1,23,4)},a.prototype.readDoubleLE=function(t,e){return t>>>=0,e||b(t,8,this.length),i.read(this,t,!0,52,8)},a.prototype.readDoubleBE=function(t,e){return t>>>=0,e||b(t,8,this.length),i.read(this,t,!1,52,8)},a.prototype.writeUIntLE=function(t,e,r,n){if(t=+t,e>>>=0,r>>>=0,!n){var i=Math.pow(2,8*r)-1;w(this,t,e,r,i,0)}var s=1,o=0;for(this[e]=255&t;++o<r&&(s*=256);)this[e+o]=t/s&255;return e+r},a.prototype.writeUIntBE=function(t,e,r,n){if(t=+t,e>>>=0,r>>>=0,!n){var i=Math.pow(2,8*r)-1;w(this,t,e,r,i,0)}var s=r-1,o=1;for(this[e+s]=255&t;--s>=0&&(o*=256);)this[e+s]=t/o&255;return e+r},a.prototype.writeUInt8=function(t,e,r){return t=+t,e>>>=0,r||w(this,t,e,1,255,0),this[e]=255&t,e+1},a.prototype.writeUInt16LE=function(t,e,r){return t=+t,e>>>=0,r||w(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},a.prototype.writeUInt16BE=function(t,e,r){return t=+t,e>>>=0,r||w(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},a.prototype.writeUInt32LE=function(t,e,r){return t=+t,e>>>=0,r||w(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},a.prototype.writeUInt32BE=function(t,e,r){return t=+t,e>>>=0,r||w(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},a.prototype.writeIntLE=function(t,e,r,n){if(t=+t,e>>>=0,!n){var i=Math.pow(2,8*r-1);w(this,t,e,r,i-1,-i)}var s=0,o=1,a=0;for(this[e]=255&t;++s<r&&(o*=256);)t<0&&0===a&&0!==this[e+s-1]&&(a=1),this[e+s]=(t/o>>0)-a&255;return e+r},a.prototype.writeIntBE=function(t,e,r,n){if(t=+t,e>>>=0,!n){var i=Math.pow(2,8*r-1);w(this,t,e,r,i-1,-i)}var s=r-1,o=1,a=0;for(this[e+s]=255&t;--s>=0&&(o*=256);)t<0&&0===a&&0!==this[e+s+1]&&(a=1),this[e+s]=(t/o>>0)-a&255;return e+r},a.prototype.writeInt8=function(t,e,r){return t=+t,e>>>=0,r||w(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},a.prototype.writeInt16LE=function(t,e,r){return t=+t,e>>>=0,r||w(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},a.prototype.writeInt16BE=function(t,e,r){return t=+t,e>>>=0,r||w(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},a.prototype.writeInt32LE=function(t,e,r){return t=+t,e>>>=0,r||w(this,t,e,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},a.prototype.writeInt32BE=function(t,e,r){return t=+t,e>>>=0,r||w(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},a.prototype.writeFloatLE=function(t,e,r){return O(this,t,e,!0,r)},a.prototype.writeFloatBE=function(t,e,r){return O(this,t,e,!1,r)},a.prototype.writeDoubleLE=function(t,e,r){return P(this,t,e,!0,r)},a.prototype.writeDoubleBE=function(t,e,r){return P(this,t,e,!1,r)},a.prototype.copy=function(t,e,r,n){if(!a.isBuffer(t))throw TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),e>=t.length&&(e=t.length),e||(e=0),n>0&&n<r&&(n=r),n===r||0===t.length||0===this.length)return 0;if(e<0)throw RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw RangeError("Index out of range");if(n<0)throw RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-r&&(n=t.length-e+r);var i=n-r;if(this===t&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(e,r,n);else if(this===t&&r<e&&e<n)for(var s=i-1;s>=0;--s)t[s+e]=this[s+r];else Uint8Array.prototype.set.call(t,this.subarray(r,n),e);return i},a.prototype.fill=function(t,e,r,n){if("string"==typeof t){if("string"==typeof e?(n=e,e=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw TypeError("encoding must be a string");if("string"==typeof n&&!a.isEncoding(n))throw TypeError("Unknown encoding: "+n);if(1===t.length){var i,s=t.charCodeAt(0);("utf8"===n&&s<128||"latin1"===n)&&(t=s)}}else"number"==typeof t?t&=255:"boolean"==typeof t&&(t=Number(t));if(e<0||this.length<e||this.length<r)throw RangeError("Out of range index");if(r<=e)return this;if(e>>>=0,r=void 0===r?this.length:r>>>0,t||(t=0),"number"==typeof t)for(i=e;i<r;++i)this[i]=t;else{var o=a.isBuffer(t)?t:a.from(t,n),c=o.length;if(0===c)throw TypeError('The value "'+t+'" is invalid for argument "value"');for(i=0;i<r-e;++i)this[i+e]=o[i%c]}return this};var x=/[^+/0-9A-Za-z-_]/g;function I(t,e){e=e||1/0;for(var r,n=t.length,i=null,s=[],o=0;o<n;++o){if((r=t.charCodeAt(o))>55295&&r<57344){if(!i){if(r>56319||o+1===n){(e-=3)>-1&&s.push(239,191,189);continue}i=r;continue}if(r<56320){(e-=3)>-1&&s.push(239,191,189),i=r;continue}r=(i-55296<<10|r-56320)+65536}else i&&(e-=3)>-1&&s.push(239,191,189);if(i=null,r<128){if((e-=1)<0)break;s.push(r)}else if(r<2048){if((e-=2)<0)break;s.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;s.push(r>>12|224,r>>6&63|128,63&r|128)}else if(r<1114112){if((e-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}else throw Error("Invalid code point")}return s}function S(t){for(var e=[],r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}function _(t){return n.toByteArray(function(t){if((t=(t=t.split("=")[0]).trim().replace(x,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function k(t,e,r,n){for(var i=0;i<n&&!(i+r>=e.length)&&!(i>=t.length);++i)e[i+r]=t[i];return i}function A(t,e){return t instanceof e||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===e.name}var C=function(){for(var t="0123456789abcdef",e=Array(256),r=0;r<16;++r)for(var n=16*r,i=0;i<16;++i)e[n+i]=t[r]+t[i];return e}()},783:function(t,e){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */ e.read=function(t,e,r,n,i){var s,o,a=8*i-n-1,c=(1<<a)-1,l=c>>1,u=-7,h=r?i-1:0,p=r?-1:1,f=t[e+h];for(h+=p,s=f&(1<<-u)-1,f>>=-u,u+=a;u>0;s=256*s+t[e+h],h+=p,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=n;u>0;o=256*o+t[e+h],h+=p,u-=8);if(0===s)s=1-l;else{if(s===c)return o?NaN:(f?-1:1)*(1/0);o+=Math.pow(2,n),s-=l}return(f?-1:1)*o*Math.pow(2,s-n)},e.write=function(t,e,r,n,i,s){var o,a,c,l=8*s-i-1,u=(1<<l)-1,h=u>>1,p=23===i?5960464477539062e-23:0,f=n?0:s-1,d=n?1:-1,y=e<0||0===e&&1/e<0?1:0;for(isNaN(e=Math.abs(e))||e===1/0?(a=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+h>=1?e+=p/c:e+=p*Math.pow(2,1-h),e*c>=2&&(o++,c/=2),o+h>=u?(a=0,o=u):o+h>=1?(a=(e*c-1)*Math.pow(2,i),o+=h):(a=e*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;t[r+f]=255&a,f+=d,a/=256,i-=8);for(o=o<<i|a,l+=i;l>0;t[r+f]=255&o,f+=d,o/=256,l-=8);t[r+f-d]|=128*y}}},r={};function n(t){var i=r[t];if(void 0!==i)return i.exports;var s=r[t]={exports:{}},o=!0;try{e[t](s,s.exports,n),o=!1}finally{o&&delete r[t]}return s.exports}n.ab="//";var i=n(72);t.exports=i}()},6118:function(t){!function(){var e={229:function(t){var e,r,n,i=t.exports={};function s(){throw Error("setTimeout has not been defined")}function o(){throw Error("clearTimeout has not been defined")}function a(t){if(e===setTimeout)return setTimeout(t,0);if((e===s||!e)&&setTimeout)return e=setTimeout,setTimeout(t,0);try{return e(t,0)}catch(n){try{return e.call(null,t,0)}catch(r){return e.call(this,t,0)}}}!function(){try{e="function"==typeof setTimeout?setTimeout:s}catch(t){e=s}try{r="function"==typeof clearTimeout?clearTimeout:o}catch(n){r=o}}();var c=[],l=!1,u=-1;function h(){l&&n&&(l=!1,n.length?c=n.concat(c):u=-1,c.length&&p())}function p(){if(!l){var t=a(h);l=!0;for(var e=c.length;e;){for(n=c,c=[];++u<e;)n&&n[u].run();u=-1,e=c.length}n=null,l=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(n){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function f(t,e){this.fun=t,this.array=e}function d(){}i.nextTick=function(t){var e=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];c.push(new f(t,e)),1!==c.length||l||a(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=d,i.addListener=d,i.once=d,i.off=d,i.removeListener=d,i.removeAllListeners=d,i.emit=d,i.prependListener=d,i.prependOnceListener=d,i.listeners=function(t){return[]},i.binding=function(t){throw Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw Error("process.chdir is not supported")},i.umask=function(){return 0}}},r={};function n(t){var i=r[t];if(void 0!==i)return i.exports;var s=r[t]={exports:{}},o=!0;try{e[t](s,s.exports,n),o=!1}finally{o&&delete r[t]}return s.exports}n.ab="//";var i=n(229);t.exports=i}()},9382:function(t,e,r){var n=r(4284);"undefined"!=typeof __nccwpck_require__&&(__nccwpck_require__.ab="//"),({189:function(){!function(t,e){"use strict";if(!t.setImmediate){var r,i,s,o,a,c=1,l={},u=!1,h=t.document,p=Object.getPrototypeOf&&Object.getPrototypeOf(t);(p=p&&p.setTimeout?p:t,"[object process]"===({}).toString.call(t.process))?a=function(t){n.nextTick(function(){d(t)})}:function(){if(t.postMessage&&!t.importScripts){var e=!0,r=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=r,e}}()?(r="setImmediate$"+Math.random()+"$",i=function(e){e.source===t&&"string"==typeof e.data&&0===e.data.indexOf(r)&&d(+e.data.slice(r.length))},t.addEventListener?t.addEventListener("message",i,!1):t.attachEvent("onmessage",i),a=function(e){t.postMessage(r+e,"*")}):t.MessageChannel?((s=new MessageChannel).port1.onmessage=function(t){d(t.data)},a=function(t){s.port2.postMessage(t)}):h&&"onreadystatechange"in h.createElement("script")?(o=h.documentElement,a=function(t){var e=h.createElement("script");e.onreadystatechange=function(){d(t),e.onreadystatechange=null,o.removeChild(e),e=null},o.appendChild(e)}):a=function(t){setTimeout(d,0,t)},p.setImmediate=function(t){"function"!=typeof t&&(t=Function(""+t));for(var e=Array(arguments.length-1),r=0;r<e.length;r++)e[r]=arguments[r+1];var n={callback:t,args:e};return l[c]=n,a(c),c++},p.clearImmediate=f}function f(t){delete l[t]}function d(t){if(u)setTimeout(d,0,t);else{var e=l[t];if(e){u=!0;try{!function(t){var e=t.callback,r=t.args;switch(r.length){case 0:e();break;case 1:e(r[0]);break;case 2:e(r[0],r[1]);break;case 3:e(r[0],r[1],r[2]);break;default:e.apply(void 0,r)}}(e)}finally{f(t),u=!1}}}}}("undefined"==typeof self?void 0===r.g?this:r.g:self)}})[189](),t.exports={}},6677:function(t,e,r){t.exports=r(7895)},8772:function(t,e,r){"use strict";var n=r(331);function i(){}function s(){}s.resetWarningCache=i,t.exports=function(){function t(t,e,r,i,s,o){if(o!==n){var a=Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw a.name="Invariant Violation",a}}function e(){return t}t.isRequired=t;var r={array:t,bigint:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,elementType:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:s,resetWarningCache:i};return r.PropTypes=r,r}},3615:function(t,e,r){t.exports=r(8772)()},331:function(t){"use strict";t.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},1877:function(t,e,r){"use strict";var n=r(4284),i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s=a(r(8292)),o=a(r(6493));function a(t){return t&&t.__esModule?t:{default:t}}var c="undefined"==typeof document||void 0!==n&&n.env&&!1,l={},u=void 0;function h(){return u&&!u.headersSent}function p(t){l=t?s.default.parse(t):{}}e.ZP={setRawCookie:p,load:function(t,e){var r=c?l:s.default.parse(document.cookie),n=r&&r[t];if(void 0===e&&(e=!n||"{"!==n[0]&&"["!==n[0]),!e)try{n=JSON.parse(n)}catch(i){}return n},loadAll:function(t){var e=c?l:s.default.parse(document.cookie);if(void 0===t&&(t=!e||"{"!==e[0]&&"["!==e[0]),!t)try{e=JSON.parse(e)}catch(r){}return e},select:function(t){var e=c?l:s.default.parse(document.cookie);return e?t?Object.keys(e).reduce(function(r,n){if(!t.test(n))return r;var i={};return i[n]=e[n],(0,o.default)({},r,i)},{}):e:{}},save:function(t,e,r){l[t]=e,(void 0===e?"undefined":i(e))==="object"&&(l[t]=JSON.stringify(e)),c||(document.cookie=s.default.serialize(t,l[t],r)),h()&&u.cookie&&u.cookie(t,e,r)},remove:function(t,e){delete l[t],e=void 0===e?{}:"string"==typeof e?{path:e}:(0,o.default)({},e),"undefined"!=typeof document&&(e.expires=new Date(1970,1,1,0,0,1),e.maxAge=0,document.cookie=s.default.serialize(t,"",e)),h()&&u.clearCookie&&u.clearCookie(t,e)},plugToRequest:function(t,e){return t.cookie?l=t.cookie:t.cookies?l=t.cookies:t.headers&&t.headers.cookie?p(t.headers.cookie):l={},u=e,function(){u=null,l={}}}}},8292:function(t,e){"use strict";/*!
 * cookie
 * Copyright(c) 2012-2014 Roman Shtylman
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */ e.parse=function(t,e){if("string"!=typeof t)throw TypeError("argument str must be a string");for(var n={},s=t.split(i),o=(e||{}).decode||r,a=0;a<s.length;a++){var c=s[a],l=c.indexOf("=");if(!(l<0)){var u=c.substr(0,l).trim(),h=c.substr(++l,c.length).trim();'"'==h[0]&&(h=h.slice(1,-1)),void 0==n[u]&&(n[u]=function(t,e){try{return e(t)}catch(r){return t}}(h,o))}}return n},e.serialize=function(t,e,r){var i=r||{},o=i.encode||n;if("function"!=typeof o)throw TypeError("option encode is invalid");if(!s.test(t))throw TypeError("argument name is invalid");var a=o(e);if(a&&!s.test(a))throw TypeError("argument val is invalid");var c=t+"="+a;if(null!=i.maxAge){var l=i.maxAge-0;if(isNaN(l))throw Error("maxAge should be a Number");c+="; Max-Age="+Math.floor(l)}if(i.domain){if(!s.test(i.domain))throw TypeError("option domain is invalid");c+="; Domain="+i.domain}if(i.path){if(!s.test(i.path))throw TypeError("option path is invalid");c+="; Path="+i.path}if(i.expires){if("function"!=typeof i.expires.toUTCString)throw TypeError("option expires is invalid");c+="; Expires="+i.expires.toUTCString()}if(i.httpOnly&&(c+="; HttpOnly"),i.secure&&(c+="; Secure"),i.sameSite){var u="string"==typeof i.sameSite?i.sameSite.toLowerCase():i.sameSite;switch(u){case!0:case"strict":c+="; SameSite=Strict";break;case"lax":c+="; SameSite=Lax";break;default:throw TypeError("option sameSite is invalid")}}return c};var r=decodeURIComponent,n=encodeURIComponent,i=/; */,s=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/},4153:function(t,e,r){"use strict";r.d(e,{qC:function(){return s},hC:function(){return i}});var n=r(7378);r(4366),r(3219),r(9599),r(4275),r(4632);var i=function(t){return function(e){return e.displayName=t,e}};n.Component;var s=function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return e.reduce(function(t,e){return function(){return t(e.apply(void 0,arguments))}},function(t){return t})}},9599:function(t){"use strict";var e={childContextTypes:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},r={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},n=Object.defineProperty,i=Object.getOwnPropertyNames,s=Object.getOwnPropertySymbols,o=Object.getOwnPropertyDescriptor,a=Object.getPrototypeOf,c=a&&a(Object);t.exports=function t(l,u,h){if("string"!=typeof u){if(c){var p=a(u);p&&p!==c&&t(l,p,h)}var f=i(u);s&&(f=f.concat(s(u)));for(var d=0;d<f.length;++d){var y=f[d];if(!e[y]&&!r[y]&&(!h||!h[y])){var m=o(u,y);try{n(l,y,m)}catch(g){}}}}return l}},5240:function(t,e,r){"use strict";r.d(e,{md:function(){return p},qC:function(){return h},MT:function(){return u}});var n=r(4649);function i(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function s(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?i(Object(r),!0).forEach(function(e){(0,n.Z)(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function o(t){return"Minified Redux error #"+t+"; visit https://redux.js.org/Errors?code="+t+" for the full message or use the non-minified dev environment for full errors. "}var a="function"==typeof Symbol&&Symbol.observable||"@@observable",c=function(){return Math.random().toString(36).substring(7).split("").join(".")},l={INIT:"@@redux/INIT"+c(),REPLACE:"@@redux/REPLACE"+c(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+c()}};function u(t,e,r){if("function"==typeof e&&"function"==typeof r||"function"==typeof r&&"function"==typeof arguments[3])throw Error(o(0));if("function"==typeof e&&void 0===r&&(r=e,e=void 0),void 0!==r){if("function"!=typeof r)throw Error(o(1));return r(u)(t,e)}if("function"!=typeof t)throw Error(o(2));var n,i=t,s=e,c=[],h=c,p=!1;function f(){h===c&&(h=c.slice())}function d(){if(p)throw Error(o(3));return s}function y(t){if("function"!=typeof t)throw Error(o(4));if(p)throw Error(o(5));var e=!0;return f(),h.push(t),function(){if(e){if(p)throw Error(o(6));e=!1,f();var r=h.indexOf(t);h.splice(r,1),c=null}}}function m(t){if(!function(t){if("object"!=typeof t||null===t)return!1;for(var e=t;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e}(t))throw Error(o(7));if(void 0===t.type)throw Error(o(8));if(p)throw Error(o(9));try{p=!0,s=i(s,t)}finally{p=!1}for(var e=c=h,r=0;r<e.length;r++)(0,e[r])();return t}return m({type:l.INIT}),(n={dispatch:m,subscribe:y,getState:d,replaceReducer:function(t){if("function"!=typeof t)throw Error(o(10));i=t,m({type:l.REPLACE})}})[a]=function(){var t;return(t={subscribe:function(t){if("object"!=typeof t||null===t)throw Error(o(11));function e(){t.next&&t.next(d())}return e(),{unsubscribe:y(e)}}})[a]=function(){return this},t},n}function h(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return 0===e.length?function(t){return t}:1===e.length?e[0]:e.reduce(function(t,e){return function(){return t(e.apply(void 0,arguments))}})}function p(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return function(t){return function(){var r=t.apply(void 0,arguments),n=function(){throw Error(o(15))},i={getState:r.getState,dispatch:function(){return n.apply(void 0,arguments)}},a=e.map(function(t){return t(i)});return n=h.apply(void 0,a)(r.dispatch),s(s({},r),{},{dispatch:n})}}}},9040:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.diffAny=e.diffObjects=e.diffArrays=e.intersection=e.subtract=e.isDestructive=void 0;var n=r(99);function i(t,e){var r={};for(var i in t)n.hasOwnProperty.call(t,i)&&void 0!==t[i]&&(r[i]=1);for(var s in e)n.hasOwnProperty.call(e,s)&&void 0!==e[s]&&delete r[s];return Object.keys(r)}function s(t){for(var e=t.length,r={},i=0;i<e;i++){var s=t[i];for(var o in s)n.hasOwnProperty.call(s,o)&&void 0!==s[o]&&(r[o]=(r[o]||0)+1)}for(var o in r)r[o]<e&&delete r[o];return Object.keys(r)}function o(t,e){return{operations:t.operations.concat(e),cost:t.cost+1}}function a(t,e,r,n){void 0===n&&(n=l);var i={"0,0":{operations:[],cost:0}},s=isNaN(t.length)||t.length<=0?0:t.length;return(function s(a,c){var l=a+","+c,u=i[l];if(void 0===u){if(a>0&&c>0&&!n(t[a-1],e[c-1],r.add(String(a-1))).length)u=s(a-1,c-1);else{var h=[];if(a>0){var p=s(a-1,c);h.push(o(p,{op:"remove",index:a-1}))}if(c>0){var f=s(a,c-1),d={op:"add",index:a-1,value:e[c-1]};h.push(o(f,d))}if(a>0&&c>0){var y=s(a-1,c-1),m={op:"replace",index:a-1,original:t[a-1],value:e[c-1]};h.push(o(y,m))}u=h.sort(function(t,e){return t.cost-e.cost})[0]}i[l]=u}return u})(s,isNaN(e.length)||e.length<=0?0:e.length).operations.reduce(function(t,e){var i=t[0],o=t[1];if("add"===e.op){var a=e.index+1+o,c=a<s+o?String(a):"-",l={op:e.op,path:r.add(c).toString(),value:e.value};return[i.concat(l),o+1]}if("remove"===e.op){var l={op:e.op,path:r.add(String(e.index+o)).toString()};return[i.concat(l),o-1]}var u=r.add(String(e.index+o)),h=n(e.original,e.value,u);return[i.concat.apply(i,h),o]},[[],0])[0]}function c(t,e,r,n){void 0===n&&(n=l);var o=[];return i(t,e).forEach(function(t){o.push({op:"remove",path:r.add(t).toString()})}),i(e,t).forEach(function(t){o.push({op:"add",path:r.add(t).toString(),value:e[t]})}),s([t,e]).forEach(function(i){o.push.apply(o,n(t[i],e[i],r.add(i)))}),o}function l(t,e,r,i){if(void 0===i&&(i=l),t===e)return[];var s=n.objectType(t),o=n.objectType(e);return"array"==s&&"array"==o?a(t,e,r,i):"object"==s&&"object"==o?c(t,e,r,i):[{op:"replace",path:r.toString(),value:e}]}e.isDestructive=function(t){var e=t.op;return"remove"===e||"replace"===e||"copy"===e||"move"===e},e.subtract=i,e.intersection=s,e.diffArrays=a,e.diffObjects=c,e.diffAny=l},3979:function(t,e,r){"use strict";e.rh=e.af=void 0;var n=r(2399),i=r(5064),s=r(9040);e.af=function(t,e){return e.map(function(e){return i.apply(t,e)})},e.rh=function(t,e,r){var i=new n.Pointer;return(r?function t(e,n,i){var o=r(e,n,i);return Array.isArray(o)?o:s.diffAny(e,n,i,t)}:s.diffAny)(t,e,i)}},5064:function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0}),e.apply=e.InvalidOperationError=e.test=e.copy=e.move=e.replace=e.remove=e.add=e.TestError=e.MissingError=void 0;var s=r(2399),o=r(99),a=r(9040),c=function(t){function e(e){var r=t.call(this,"Value required at path: "+e)||this;return r.path=e,r.name="MissingError",r}return i(e,t),e}(Error);e.MissingError=c;var l=function(t){function e(e,r){var n=t.call(this,"Test failed: "+e+" != "+r)||this;return n.actual=e,n.expected=r,n.name="TestError",n}return i(e,t),e}(Error);function u(t,e,r){if(Array.isArray(t)){if("-"==e)t.push(r);else{var n=parseInt(e,10);t.splice(n,0,r)}}else t[e]=r}function h(t,e){if(Array.isArray(t)){var r=parseInt(e,10);t.splice(r,1)}else delete t[e]}function p(t,e){var r=s.Pointer.fromJSON(e.path).evaluate(t);return void 0===r.parent?new c(e.path):(u(r.parent,r.key,o.clone(e.value)),null)}function f(t,e){var r=s.Pointer.fromJSON(e.path).evaluate(t);return void 0===r.value?new c(e.path):(h(r.parent,r.key),null)}function d(t,e){var r=s.Pointer.fromJSON(e.path).evaluate(t);if(null===r.parent)return new c(e.path);if(Array.isArray(r.parent)){if(parseInt(r.key,10)>=r.parent.length)return new c(e.path)}else if(void 0===r.value)return new c(e.path);return r.parent[r.key]=e.value,null}function y(t,e){var r=s.Pointer.fromJSON(e.from).evaluate(t);if(void 0===r.value)return new c(e.from);var n=s.Pointer.fromJSON(e.path).evaluate(t);return void 0===n.parent?new c(e.path):(h(r.parent,r.key),u(n.parent,n.key,r.value),null)}function m(t,e){var r=s.Pointer.fromJSON(e.from).evaluate(t);if(void 0===r.value)return new c(e.from);var n=s.Pointer.fromJSON(e.path).evaluate(t);return void 0===n.parent?new c(e.path):(u(n.parent,n.key,o.clone(r.value)),null)}function g(t,e){var r=s.Pointer.fromJSON(e.path).evaluate(t);return a.diffAny(r.value,e.value,new s.Pointer).length?new l(r.value,e.value):null}e.TestError=l,e.add=p,e.remove=f,e.replace=d,e.move=y,e.copy=m,e.test=g;var v=function(t){function e(e){var r=t.call(this,"Invalid operation: "+e.op)||this;return r.operation=e,r.name="InvalidOperationError",r}return i(e,t),e}(Error);e.InvalidOperationError=v,e.apply=function(t,e){switch(e.op){case"add":return p(t,e);case"remove":return f(t,e);case"replace":return d(t,e);case"move":return y(t,e);case"copy":return m(t,e);case"test":return g(t,e)}return new v(e)}},2399:function(t,e){"use strict";function r(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function n(t){return t.replace(/~/g,"~0").replace(/\//g,"~1")}Object.defineProperty(e,"__esModule",{value:!0}),e.Pointer=void 0;var i=function(){function t(t){void 0===t&&(t=[""]),this.tokens=t}return t.fromJSON=function(e){var n=e.split("/").map(r);if(""!==n[0])throw Error("Invalid JSON Pointer: "+e);return new t(n)},t.prototype.toString=function(){return this.tokens.map(n).join("/")},t.prototype.evaluate=function(t){for(var e=null,r="",n=t,i=1,s=this.tokens.length;i<s;i++)e=n,"__proto__"!=(r=this.tokens[i])&&"constructor"!=r&&"prototype"!=r&&(n=(e||{})[r]);return{parent:e,key:r,value:n}},t.prototype.get=function(t){return this.evaluate(t).value},t.prototype.set=function(t,e){for(var r=t,n=1,i=this.tokens.length-1,s=this.tokens[n];n<i;n++)r=(r||{})[s];r&&(r[this.tokens[this.tokens.length-1]]=e)},t.prototype.push=function(t){this.tokens.push(t)},t.prototype.add=function(e){var r=this.tokens.concat(String(e));return new t(r)},t}();e.Pointer=i},99:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.clone=e.objectType=e.hasOwnProperty=void 0,e.hasOwnProperty=Object.prototype.hasOwnProperty,e.objectType=function(t){return void 0===t?"undefined":null===t?"null":Array.isArray(t)?"array":typeof t},e.clone=function t(r){if(!(null!=r&&"object"==typeof r))return r;if(r.constructor==Array){for(var n=r.length,i=Array(n),s=0;s<n;s++)i[s]=t(r[s]);return i}if(r.constructor==Date)return new Date(+r);var o={};for(var a in r)e.hasOwnProperty.call(r,a)&&(o[a]=t(r[a]));return o}},4632:function(t,e,r){"use strict";r.d(e,{Z:function(){return o}}),t=r.hmd(t);var n,i,s,o=("function"==typeof(i=("undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==r.g?r.g:t).Symbol)?i.observable?n=i.observable:(n=i("observable"),i.observable=n):n="@@observable",n)},9650:function(t,e,r){"use strict";r.d(e,{ZP:function(){return tv}});var n,i,s={};r.r(s),r.d(s,{Decoder:function(){return tu},Encoder:function(){return tl},PacketType:function(){return i},protocol:function(){return tc}});let o=Object.create(null);o.open="0",o.close="1",o.ping="2",o.pong="3",o.message="4",o.upgrade="5",o.noop="6";let a=Object.create(null);Object.keys(o).forEach(t=>{a[o[t]]=t});let c={type:"error",data:"parser error"},l="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),u="function"==typeof ArrayBuffer,h=t=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer,p=({type:t,data:e},r,n)=>l&&e instanceof Blob?r?n(e):f(e,n):u&&(e instanceof ArrayBuffer||h(e))?r?n(e):f(new Blob([e]),n):n(o[t]+(e||"")),f=(t,e)=>{let r=new FileReader;return r.onload=function(){let t=r.result.split(",")[1];e("b"+t)},r.readAsDataURL(t)},d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",y="undefined"==typeof Uint8Array?[]:new Uint8Array(256);for(let m=0;m<d.length;m++)y[d.charCodeAt(m)]=m;let g=t=>{let e=.75*t.length,r=t.length,n,i=0,s,o,a,c;"="===t[t.length-1]&&(e--,"="===t[t.length-2]&&e--);let l=new ArrayBuffer(e),u=new Uint8Array(l);for(n=0;n<r;n+=4)s=y[t.charCodeAt(n)],o=y[t.charCodeAt(n+1)],a=y[t.charCodeAt(n+2)],c=y[t.charCodeAt(n+3)],u[i++]=s<<2|o>>4,u[i++]=(15&o)<<4|a>>2,u[i++]=(3&a)<<6|63&c;return l},v="function"==typeof ArrayBuffer,b=(t,e)=>{if("string"!=typeof t)return{type:"message",data:E(t,e)};let r=t.charAt(0);if("b"===r)return{type:"message",data:w(t.substring(1),e)};let n=a[r];return n?t.length>1?{type:a[r],data:t.substring(1)}:{type:a[r]}:c},w=(t,e)=>{if(!v)return{base64:!0,data:t};{let r=g(t);return E(r,e)}},E=(t,e)=>"blob"===e&&t instanceof ArrayBuffer?new Blob([t]):t,O=(t,e)=>{let r=t.length,n=Array(r),i=0;t.forEach((t,s)=>{p(t,!1,t=>{n[s]=t,++i===r&&e(n.join("\x1e"))})})},P=(t,e)=>{let r=t.split("\x1e"),n=[];for(let i=0;i<r.length;i++){let s=b(r[i],e);if(n.push(s),"error"===s.type)break}return n};function x(t){if(t)return function(t){for(var e in x.prototype)t[e]=x.prototype[e];return t}(t)}x.prototype.on=x.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},x.prototype.once=function(t,e){function r(){this.off(t,r),e.apply(this,arguments)}return r.fn=e,this.on(t,r),this},x.prototype.off=x.prototype.removeListener=x.prototype.removeAllListeners=x.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r,n=this._callbacks["$"+t];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var i=0;i<n.length;i++)if((r=n[i])===e||r.fn===e){n.splice(i,1);break}return 0===n.length&&delete this._callbacks["$"+t],this},x.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=Array(arguments.length-1),r=this._callbacks["$"+t],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(r){r=r.slice(0);for(var n=0,i=r.length;n<i;++n)r[n].apply(this,e)}return this},x.prototype.emitReserved=x.prototype.emit,x.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},x.prototype.hasListeners=function(t){return!!this.listeners(t).length};let I="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function S(t,...e){return e.reduce((e,r)=>(t.hasOwnProperty(r)&&(e[r]=t[r]),e),{})}let _=setTimeout,k=clearTimeout;function A(t,e){e.useNativeTimers?(t.setTimeoutFn=_.bind(I),t.clearTimeoutFn=k.bind(I)):(t.setTimeoutFn=setTimeout.bind(I),t.clearTimeoutFn=clearTimeout.bind(I))}class C extends Error{constructor(t,e,r){super(t),this.description=e,this.context=r,this.type="TransportError"}}class N extends x{constructor(t){super(),this.writable=!1,A(this,t),this.opts=t,this.query=t.query,this.readyState="",this.socket=t.socket}onError(t,e,r){return super.emitReserved("error",new C(t,e,r)),this}open(){return("closed"===this.readyState||""===this.readyState)&&(this.readyState="opening",this.doOpen()),this}close(){return("opening"===this.readyState||"open"===this.readyState)&&(this.doClose(),this.onClose()),this}send(t){"open"===this.readyState&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){let e=b(t,this.socket.binaryType);this.onPacket(e)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}}let D="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),M={},T=0,R=0,j;function B(t){let e="";do e=D[t%64]+e,t=Math.floor(t/64);while(t>0);return e}function L(){let t=B(+new Date);return t!==j?(T=0,j=t):t+"."+B(T++)}for(;R<64;R++)M[D[R]]=R;function U(t){let e="";for(let r in t)t.hasOwnProperty(r)&&(e.length&&(e+="&"),e+=encodeURIComponent(r)+"="+encodeURIComponent(t[r]));return e}let $=!1;try{$="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(G){}let F=$;function q(t){let e=t.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!e||F))return new XMLHttpRequest}catch(r){}if(!e)try{return new I[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch(n){}}function V(){}let Z=function(){let t=new q({xdomain:!1});return null!=t.responseType}();class z extends x{constructor(t,e){super(),A(this,e),this.opts=e,this.method=e.method||"GET",this.uri=t,this.async=!1!==e.async,this.data=void 0!==e.data?e.data:null,this.create()}create(){let t=S(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this.opts.xd,t.xscheme=!!this.opts.xs;let e=this.xhr=new q(t);try{e.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders)for(let r in e.setDisableHeaderCheck&&e.setDisableHeaderCheck(!0),this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(r)&&e.setRequestHeader(r,this.opts.extraHeaders[r])}catch(n){}if("POST"===this.method)try{e.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(i){}try{e.setRequestHeader("Accept","*/*")}catch(s){}"withCredentials"in e&&(e.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(e.timeout=this.opts.requestTimeout),e.onreadystatechange=()=>{4===e.readyState&&(200===e.status||1223===e.status?this.onLoad():this.setTimeoutFn(()=>{this.onError("number"==typeof e.status?e.status:0)},0))},e.send(this.data)}catch(o){this.setTimeoutFn(()=>{this.onError(o)},0);return}"undefined"!=typeof document&&(this.index=z.requestsCount++,z.requests[this.index]=this)}onError(t){this.emitReserved("error",t,this.xhr),this.cleanup(!0)}cleanup(t){if(void 0!==this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=V,t)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete z.requests[this.index],this.xhr=null}}onLoad(){let t=this.xhr.responseText;null!==t&&(this.emitReserved("data",t),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}function H(){for(let t in z.requests)z.requests.hasOwnProperty(t)&&z.requests[t].abort()}z.requestsCount=0,z.requests={},"undefined"!=typeof document&&("function"==typeof attachEvent?attachEvent("onunload",H):"function"==typeof addEventListener&&addEventListener("onpagehide"in I?"pagehide":"unload",H,!1));let J=(()=>{let t="function"==typeof Promise&&"function"==typeof Promise.resolve;return t?t=>Promise.resolve().then(t):(t,e)=>e(t,0)})(),Y=I.WebSocket||I.MozWebSocket;r(2241).Buffer;let K="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),W={websocket:class extends N{constructor(t){super(t),this.supportsBinary=!t.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;let t=this.uri(),e=this.opts.protocols,r=K?{}:S(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=K?new Y(t,e,r):e?new Y(t,e):new Y(t)}catch(n){return this.emitReserved("error",n)}this.ws.binaryType=this.socket.binaryType||"arraybuffer",this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let e=0;e<t.length;e++){let r=t[e],n=e===t.length-1;p(r,this.supportsBinary,t=>{try{this.ws.send(t)}catch(e){}n&&J(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}uri(){let t=this.query||{},e=this.opts.secure?"wss":"ws",r="";this.opts.port&&("wss"===e&&443!==Number(this.opts.port)||"ws"===e&&80!==Number(this.opts.port))&&(r=":"+this.opts.port),this.opts.timestampRequests&&(t[this.opts.timestampParam]=L()),this.supportsBinary||(t.b64=1);let n=U(t),i=-1!==this.opts.hostname.indexOf(":");return e+"://"+(i?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(n.length?"?"+n:"")}check(){return!!Y}},polling:class extends N{constructor(t){if(super(t),this.polling=!1,"undefined"!=typeof location){let e="https:"===location.protocol,r=location.port;r||(r=e?"443":"80"),this.xd="undefined"!=typeof location&&t.hostname!==location.hostname||r!==t.port,this.xs=t.secure!==e}let n=t&&t.forceBase64;this.supportsBinary=Z&&!n}get name(){return"polling"}doOpen(){this.poll()}pause(t){this.readyState="pausing";let e=()=>{this.readyState="paused",t()};if(this.polling||!this.writable){let r=0;this.polling&&(r++,this.once("pollComplete",function(){--r||e()})),this.writable||(r++,this.once("drain",function(){--r||e()}))}else e()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){let e=t=>{if("opening"===this.readyState&&"open"===t.type&&this.onOpen(),"close"===t.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(t)};P(t,this.socket.binaryType).forEach(e),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){let t=()=>{this.write([{type:"close"}])};"open"===this.readyState?t():this.once("open",t)}write(t){this.writable=!1,O(t,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let t=this.query||{},e=this.opts.secure?"https":"http",r="";!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=L()),this.supportsBinary||t.sid||(t.b64=1),this.opts.port&&("https"===e&&443!==Number(this.opts.port)||"http"===e&&80!==Number(this.opts.port))&&(r=":"+this.opts.port);let n=U(t),i=-1!==this.opts.hostname.indexOf(":");return e+"://"+(i?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(n.length?"?"+n:"")}request(t={}){return Object.assign(t,{xd:this.xd,xs:this.xs},this.opts),new z(this.uri(),t)}doWrite(t,e){let r=this.request({method:"POST",data:t});r.on("success",e),r.on("error",(t,e)=>{this.onError("xhr post error",t,e)})}doPoll(){let t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(t,e)=>{this.onError("xhr poll error",t,e)}),this.pollXhr=t}}},X=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Q=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function tt(t){let e=t,r=t.indexOf("["),n=t.indexOf("]");-1!=r&&-1!=n&&(t=t.substring(0,r)+t.substring(r,n).replace(/:/g,";")+t.substring(n,t.length));let i=X.exec(t||""),s={},o=14;for(;o--;)s[Q[o]]=i[o]||"";return -1!=r&&-1!=n&&(s.source=e,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=function(t,e){let r=e.replace(/\/{2,9}/g,"/").split("/");return("/"==e.substr(0,1)||0===e.length)&&r.splice(0,1),"/"==e.substr(e.length-1,1)&&r.splice(r.length-1,1),r}(0,s.path),s.queryKey=function(t,e){let r={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(t,e,n){e&&(r[e]=n)}),r}(0,s.query),s}class te extends x{constructor(t,e={}){super(),t&&"object"==typeof t&&(e=t,t=null),t?(t=tt(t),e.hostname=t.host,e.secure="https"===t.protocol||"wss"===t.protocol,e.port=t.port,t.query&&(e.query=t.query)):e.host&&(e.hostname=tt(e.host).host),A(this,e),this.secure=null!=e.secure?e.secure:"undefined"!=typeof location&&"https:"===location.protocol,e.hostname&&!e.port&&(e.port=this.secure?"443":"80"),this.hostname=e.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=e.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=e.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},e),this.opts.path=this.opts.path.replace(/\/$/,"")+"/","string"==typeof this.opts.query&&(this.opts.query=function(t){let e={},r=t.split("&");for(let n=0,i=r.length;n<i;n++){let s=r[n].split("=");e[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return e}(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&addEventListener("beforeunload",()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},!1),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(t){let e=Object.assign({},this.opts.query);e.EIO=4,e.transport=t,this.id&&(e.sid=this.id);let r=Object.assign({},this.opts.transportOptions[t],this.opts,{query:e,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new W[t](r)}open(){let t;if(this.opts.rememberUpgrade&&te.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))t="websocket";else if(0===this.transports.length){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else t=this.transports[0];this.readyState="opening";try{t=this.createTransport(t)}catch(e){this.transports.shift(),this.open();return}t.open(),this.setTransport(t)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",t=>this.onClose("transport close",t))}probe(t){let e=this.createTransport(t),r=!1;te.priorWebsocketSuccess=!1;let n=()=>{r||(e.send([{type:"ping",data:"probe"}]),e.once("packet",t=>{if(!r){if("pong"===t.type&&"probe"===t.data)this.upgrading=!0,this.emitReserved("upgrading",e),e&&(te.priorWebsocketSuccess="websocket"===e.name,this.transport.pause(()=>{r||"closed"===this.readyState||(l(),this.setTransport(e),e.send([{type:"upgrade"}]),this.emitReserved("upgrade",e),e=null,this.upgrading=!1,this.flush())}));else{let n=Error("probe error");n.transport=e.name,this.emitReserved("upgradeError",n)}}}))};function i(){r||(r=!0,l(),e.close(),e=null)}let s=t=>{let r=Error("probe error: "+t);r.transport=e.name,i(),this.emitReserved("upgradeError",r)};function o(){s("transport closed")}function a(){s("socket closed")}function c(t){e&&t.name!==e.name&&i()}let l=()=>{e.removeListener("open",n),e.removeListener("error",s),e.removeListener("close",o),this.off("close",a),this.off("upgrading",c)};e.once("open",n),e.once("error",s),e.once("close",o),this.once("close",a),this.once("upgrading",c),e.open()}onOpen(){if(this.readyState="open",te.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade&&this.transport.pause){let t=0,e=this.upgrades.length;for(;t<e;t++)this.probe(this.upgrades[t])}}onPacket(t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":let e=Error("server error");e.code=t.data,this.onError(e);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data)}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.maxPayload=t.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){let t=this.getWritablePackets();this.transport.send(t),this.prevBufferLen=t.length,this.emitReserved("flush")}}getWritablePackets(){let t=this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1;if(!t)return this.writeBuffer;let e=1;for(let r=0;r<this.writeBuffer.length;r++){let n=this.writeBuffer[r].data;if(n&&(e+="string"==typeof n?function(t){let e=0,r=0;for(let n=0,i=t.length;n<i;n++)(e=t.charCodeAt(n))<128?r+=1:e<2048?r+=2:e<55296||e>=57344?r+=3:(n++,r+=4);return r}(n):Math.ceil(1.33*(n.byteLength||n.size))),r>0&&e>this.maxPayload)return this.writeBuffer.slice(0,r);e+=2}return this.writeBuffer}write(t,e,r){return this.sendPacket("message",t,e,r),this}send(t,e,r){return this.sendPacket("message",t,e,r),this}sendPacket(t,e,r,n){if("function"==typeof e&&(n=e,e=void 0),"function"==typeof r&&(n=r,r=null),"closing"===this.readyState||"closed"===this.readyState)return;(r=r||{}).compress=!1!==r.compress;let i={type:t,data:e,options:r};this.emitReserved("packetCreate",i),this.writeBuffer.push(i),n&&this.once("flush",n),this.flush()}close(){let t=()=>{this.onClose("forced close"),this.transport.close()},e=()=>{this.off("upgrade",e),this.off("upgradeError",e),t()},r=()=>{this.once("upgrade",e),this.once("upgradeError",e)};return("opening"===this.readyState||"open"===this.readyState)&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():t()}):this.upgrading?r():t()),this}onError(t){te.priorWebsocketSuccess=!1,this.emitReserved("error",t),this.onClose("transport error",t)}onClose(t,e){("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&removeEventListener("offline",this.offlineEventListener,!1),this.readyState="closed",this.id=null,this.emitReserved("close",t,e),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(t){let e=[],r=0,n=t.length;for(;r<n;r++)~this.transports.indexOf(t[r])&&e.push(t[r]);return e}}te.protocol=4,te.protocol;let tr="function"==typeof ArrayBuffer,tn=t=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer,ti=Object.prototype.toString,ts="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===ti.call(Blob),to="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===ti.call(File);function ta(t){return tr&&(t instanceof ArrayBuffer||tn(t))||ts&&t instanceof Blob||to&&t instanceof File}let tc=5;(n=i||(i={}))[n.CONNECT=0]="CONNECT",n[n.DISCONNECT=1]="DISCONNECT",n[n.EVENT=2]="EVENT",n[n.ACK=3]="ACK",n[n.CONNECT_ERROR=4]="CONNECT_ERROR",n[n.BINARY_EVENT=5]="BINARY_EVENT",n[n.BINARY_ACK=6]="BINARY_ACK";class tl{constructor(t){this.replacer=t}encode(t){return(t.type===i.EVENT||t.type===i.ACK)&&function t(e,r){if(!e||"object"!=typeof e)return!1;if(Array.isArray(e)){for(let n=0,i=e.length;n<i;n++)if(t(e[n]))return!0;return!1}if(ta(e))return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1==arguments.length)return t(e.toJSON(),!0);for(let s in e)if(Object.prototype.hasOwnProperty.call(e,s)&&t(e[s]))return!0;return!1}(t)?(t.type=t.type===i.EVENT?i.BINARY_EVENT:i.BINARY_ACK,this.encodeAsBinary(t)):[this.encodeAsString(t)]}encodeAsString(t){let e=""+t.type;return(t.type===i.BINARY_EVENT||t.type===i.BINARY_ACK)&&(e+=t.attachments+"-"),t.nsp&&"/"!==t.nsp&&(e+=t.nsp+","),null!=t.id&&(e+=t.id),null!=t.data&&(e+=JSON.stringify(t.data,this.replacer)),e}encodeAsBinary(t){let e=function(t){let e=[],r=t.data,n=t;return n.data=function t(e,r){if(!e)return e;if(ta(e)){let n={_placeholder:!0,num:r.length};return r.push(e),n}if(Array.isArray(e)){let i=Array(e.length);for(let s=0;s<e.length;s++)i[s]=t(e[s],r);return i}if("object"==typeof e&&!(e instanceof Date)){let o={};for(let a in e)Object.prototype.hasOwnProperty.call(e,a)&&(o[a]=t(e[a],r));return o}return e}(r,e),n.attachments=e.length,{packet:n,buffers:e}}(t),r=this.encodeAsString(e.packet),n=e.buffers;return n.unshift(r),n}}class tu extends x{constructor(t){super(),this.reviver=t}add(t){let e;if("string"==typeof t){if(this.reconstructor)throw Error("got plaintext data when reconstructing a packet");(e=this.decodeString(t)).type===i.BINARY_EVENT||e.type===i.BINARY_ACK?(this.reconstructor=new th(e),0===e.attachments&&super.emitReserved("decoded",e)):super.emitReserved("decoded",e)}else if(ta(t)||t.base64){if(this.reconstructor)(e=this.reconstructor.takeBinaryData(t))&&(this.reconstructor=null,super.emitReserved("decoded",e));else throw Error("got binary data when not reconstructing a packet")}else throw Error("Unknown type: "+t)}decodeString(t){let e=0,r={type:Number(t.charAt(0))};if(void 0===i[r.type])throw Error("unknown packet type "+r.type);if(r.type===i.BINARY_EVENT||r.type===i.BINARY_ACK){let n=e+1;for(;"-"!==t.charAt(++e)&&e!=t.length;);let s=t.substring(n,e);if(s!=Number(s)||"-"!==t.charAt(e))throw Error("Illegal attachments");r.attachments=Number(s)}if("/"===t.charAt(e+1)){let o=e+1;for(;++e;){let a=t.charAt(e);if(","===a||e===t.length)break}r.nsp=t.substring(o,e)}else r.nsp="/";let c=t.charAt(e+1);if(""!==c&&Number(c)==c){let l=e+1;for(;++e;){let u=t.charAt(e);if(null==u||Number(u)!=u){--e;break}if(e===t.length)break}r.id=Number(t.substring(l,e+1))}if(t.charAt(++e)){let h=this.tryParse(t.substr(e));if(tu.isPayloadValid(r.type,h))r.data=h;else throw Error("invalid payload")}return r}tryParse(t){try{return JSON.parse(t,this.reviver)}catch(e){return!1}}static isPayloadValid(t,e){switch(t){case i.CONNECT:return"object"==typeof e;case i.DISCONNECT:return void 0===e;case i.CONNECT_ERROR:return"string"==typeof e||"object"==typeof e;case i.EVENT:case i.BINARY_EVENT:return Array.isArray(e)&&e.length>0;case i.ACK:case i.BINARY_ACK:return Array.isArray(e)}}destroy(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}class th{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){var e,r;let n=(e=this.reconPack,r=this.buffers,e.data=function t(e,r){if(!e)return e;if(e&&!0===e._placeholder){let n="number"==typeof e.num&&e.num>=0&&e.num<r.length;if(n)return r[e.num];throw Error("illegal attachments")}if(Array.isArray(e))for(let i=0;i<e.length;i++)e[i]=t(e[i],r);else if("object"==typeof e)for(let s in e)Object.prototype.hasOwnProperty.call(e,s)&&(e[s]=t(e[s],r));return e}(e.data,r),e.attachments=void 0,e);return this.finishedReconstruction(),n}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function tp(t,e,r){return t.on(e,r),function(){t.off(e,r)}}let tf=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class td extends x{constructor(t,e,r){super(),this.connected=!1,this.receiveBuffer=[],this.sendBuffer=[],this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=e,r&&r.auth&&(this.auth=r.auth),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;let t=this.io;this.subs=[tp(t,"open",this.onopen.bind(this)),tp(t,"packet",this.onpacket.bind(this)),tp(t,"error",this.onerror.bind(this)),tp(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...e){if(tf.hasOwnProperty(t))throw Error('"'+t+'" is a reserved event name');e.unshift(t);let r={type:i.EVENT,data:e};if(r.options={},r.options.compress=!1!==this.flags.compress,"function"==typeof e[e.length-1]){let n=this.ids++,s=e.pop();this._registerAckCallback(n,s),r.id=n}let o=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable,a=this.flags.volatile&&(!o||!this.connected);return a||(this.connected?(this.notifyOutgoingListeners(r),this.packet(r)):this.sendBuffer.push(r)),this.flags={},this}_registerAckCallback(t,e){let r=this.flags.timeout;if(void 0===r){this.acks[t]=e;return}let n=this.io.setTimeoutFn(()=>{delete this.acks[t];for(let r=0;r<this.sendBuffer.length;r++)this.sendBuffer[r].id===t&&this.sendBuffer.splice(r,1);e.call(this,Error("operation has timed out"))},r);this.acks[t]=(...t)=>{this.io.clearTimeoutFn(n),e.apply(this,[null,...t])}}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){"function"==typeof this.auth?this.auth(t=>{this.packet({type:i.CONNECT,data:t})}):this.packet({type:i.CONNECT,data:this.auth})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,e){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,e)}onpacket(t){let e=t.nsp===this.nsp;if(e)switch(t.type){case i.CONNECT:if(t.data&&t.data.sid){let r=t.data.sid;this.onconnect(r)}else this.emitReserved("connect_error",Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case i.EVENT:case i.BINARY_EVENT:this.onevent(t);break;case i.ACK:case i.BINARY_ACK:this.onack(t);break;case i.DISCONNECT:this.ondisconnect();break;case i.CONNECT_ERROR:this.destroy();let n=Error(t.data.message);n.data=t.data.data,this.emitReserved("connect_error",n)}}onevent(t){let e=t.data||[];null!=t.id&&e.push(this.ack(t.id)),this.connected?this.emitEvent(e):this.receiveBuffer.push(Object.freeze(e))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){let e=this._anyListeners.slice();for(let r of e)r.apply(this,t)}super.emit.apply(this,t)}ack(t){let e=this,r=!1;return function(...n){r||(r=!0,e.packet({type:i.ACK,id:t,data:n}))}}onack(t){let e=this.acks[t.id];"function"==typeof e&&(e.apply(this,t.data),delete this.acks[t.id])}onconnect(t){this.id=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach(t=>this.emitEvent(t)),this.receiveBuffer=[],this.sendBuffer.forEach(t=>{this.notifyOutgoingListeners(t),this.packet(t)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(t=>t()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:i.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){let e=this._anyListeners;for(let r=0;r<e.length;r++)if(t===e[r]){e.splice(r,1);break}}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){let e=this._anyOutgoingListeners;for(let r=0;r<e.length;r++)if(t===e[r]){e.splice(r,1);break}}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){let e=this._anyOutgoingListeners.slice();for(let r of e)r.apply(this,t.data)}}}function ty(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}ty.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),r=Math.floor(e*this.jitter*t);t=(1&Math.floor(10*e))==0?t-r:t+r}return 0|Math.min(t,this.max)},ty.prototype.reset=function(){this.attempts=0},ty.prototype.setMin=function(t){this.ms=t},ty.prototype.setMax=function(t){this.max=t},ty.prototype.setJitter=function(t){this.jitter=t};class tm extends x{constructor(t,e){var r;super(),this.nsps={},this.subs=[],t&&"object"==typeof t&&(e=t,t=void 0),(e=e||{}).path=e.path||"/socket.io",this.opts=e,A(this,e),this.reconnection(!1!==e.reconnection),this.reconnectionAttempts(e.reconnectionAttempts||1/0),this.reconnectionDelay(e.reconnectionDelay||1e3),this.reconnectionDelayMax(e.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(r=e.randomizationFactor)&&void 0!==r?r:.5),this.backoff=new ty({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==e.timeout?2e4:e.timeout),this._readyState="closed",this.uri=t;let n=e.parser||s;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this._autoConnect=!1!==e.autoConnect,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,this):this._reconnection}reconnectionAttempts(t){return void 0===t?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var e;return void 0===t?this._reconnectionDelay:(this._reconnectionDelay=t,null===(e=this.backoff)||void 0===e||e.setMin(t),this)}randomizationFactor(t){var e;return void 0===t?this._randomizationFactor:(this._randomizationFactor=t,null===(e=this.backoff)||void 0===e||e.setJitter(t),this)}reconnectionDelayMax(t){var e;return void 0===t?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,null===(e=this.backoff)||void 0===e||e.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new te(this.uri,this.opts);let e=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;let n=tp(e,"open",function(){r.onopen(),t&&t()}),i=tp(e,"error",e=>{r.cleanup(),r._readyState="closed",this.emitReserved("error",e),t?t(e):r.maybeReconnectOnOpen()});if(!1!==this._timeout){let s=this._timeout;0===s&&n();let o=this.setTimeoutFn(()=>{n(),e.close(),e.emit("error",Error("timeout"))},s);this.opts.autoUnref&&o.unref(),this.subs.push(function(){clearTimeout(o)})}return this.subs.push(n),this.subs.push(i),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");let t=this.engine;this.subs.push(tp(t,"ping",this.onping.bind(this)),tp(t,"data",this.ondata.bind(this)),tp(t,"error",this.onerror.bind(this)),tp(t,"close",this.onclose.bind(this)),tp(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){this.decoder.add(t)}ondecoded(t){this.emitReserved("packet",t)}onerror(t){this.emitReserved("error",t)}socket(t,e){let r=this.nsps[t];return r||(r=new td(this,t,e),this.nsps[t]=r),r}_destroy(t){let e=Object.keys(this.nsps);for(let r of e){let n=this.nsps[r];if(n.active)return}this._close()}_packet(t){let e=this.encoder.encode(t);for(let r=0;r<e.length;r++)this.engine.write(e[r],t.options)}cleanup(){this.subs.forEach(t=>t()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(t,e){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,e),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;let t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{let e=this.backoff.duration();this._reconnecting=!0;let r=this.setTimeoutFn(()=>{!t.skipReconnect&&(this.emitReserved("reconnect_attempt",t.backoff.attempts),t.skipReconnect||t.open(e=>{e?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",e)):t.onreconnect()}))},e);this.opts.autoUnref&&r.unref(),this.subs.push(function(){clearTimeout(r)})}}onreconnect(){let t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}let tg={};function tv(t,e){let r;"object"==typeof t&&(e=t,t=void 0),e=e||{};let n=function(t,e="",r){let n=t;r=r||"undefined"!=typeof location&&location,null==t&&(t=r.protocol+"//"+r.host),"string"==typeof t&&("/"===t.charAt(0)&&(t="/"===t.charAt(1)?r.protocol+t:r.host+t),/^(https?|wss?):\/\//.test(t)||(t=void 0!==r?r.protocol+"//"+t:"https://"+t),n=tt(t)),!n.port&&(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";let i=-1!==n.host.indexOf(":"),s=i?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+s+":"+n.port+e,n.href=n.protocol+"://"+s+(r&&r.port===n.port?"":":"+n.port),n}(t,e.path||"/socket.io"),i=n.source,s=n.id,o=n.path,a=tg[s]&&o in tg[s].nsps,c=e.forceNew||e["force new connection"]||!1===e.multiplex||a;return c?r=new tm(i,e):(tg[s]||(tg[s]=new tm(i,e)),r=tg[s]),n.query&&!e.query&&(e.query=n.queryKey),r.socket(n.path,e)}Object.assign(tv,{Manager:tm,Socket:td,io:tv,connect:tv})}}]);